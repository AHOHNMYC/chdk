#include "lolevel.h"
#include "platform.h"
#include "core.h"

// debug
//#define CAPTSEQ_DEBUG_LOG 1

extern int active_raw_buffer;
// debug
extern void _LogCameraEvent(int id,const char *fmt,...);

#define USE_STUBS_NRFLAG 1
#define NR_AUTO (-1) // default value if NRTBL.SetDarkSubType not used is -1 (0 probalby works the same), set to enable auto

#ifdef CAPTSEQ_DEBUG_LOG
extern char *hook_raw_image_addr(void);

void log_capt_seq(int m)
{
    _LogCameraEvent(0x60,"cs m:%d arb:%d rb:0x%08x i:%04d",
                    m,
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq2(int m)
{
    _LogCameraEvent(0x60,"cs end m:%d arb:%d rb:0x%08x i:%04d",
                    m,
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq_override(void)
{
    _LogCameraEvent(0x60,"cs override arb:%d rb:0x%08x i:%04d",
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
#endif

#include "../../../generic/capt_seq.c"
//-s=task_CaptSeq -c=173 -f=chdk
// task_CaptSeq 0xFC0BD906
void __attribute__((naked,noinline)) capt_seq_task() {
    asm volatile (
"       push    {r3, r4, r5, r6, r7,lr}\n"
"       ldr     r4, =0x059ef0\n"
"       movs    r6, #0\n"
"       ldr     r5, =0x0b358\n"
"loc_fc0bd90e:\n"
"       movs    r2, #0\n"
"       mov     r1, sp\n"
"       ldr     r0, [r5,#8]\n"
"       blx     sub_fc3022b0\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc0bd930\n"
"       movw    r2, #0x455\n"
"       ldr   r1, =0xfc0bd504\n"
"       movs    r0, #0\n"
"       blx     sub_fc302410\n"
"       blx     sub_fc3022c8\n"
"       pop     {r3, r4, r5, r6, r7,pc}\n"
"loc_fc0bd930:\n"
"       ldr     r0, [sp]\n"
"       ldr     r0, [r0]\n"
"       cmp     r0, #1\n"
"       beq     loc_fc0bd948\n"
"       cmp     r0, #0x28\n"
"       beq     loc_fc0bd948\n"
"       cmp     r0, #0x1c\n"
"       beq     loc_fc0bd948\n"
"       cmp     r0, #0x20\n"
"       beq     loc_fc0bd948\n"
"       bl      sub_fc18b362\n"
"loc_fc0bd948:\n"
#ifdef CAPTSEQ_DEBUG_LOG
// debug message
"ldr     r0, [sp]\n"
"ldr     r0, [r0]\n"
"bl log_capt_seq\n"
#endif
"       ldr     r0, [sp]\n"
"       ldr     r1, [r0]\n"
"       cmp     r1, #0x2f\n"
"       bcs     loc_fc0bda30\n"
"       tbb.w   [pc,r1]\n"
"branchtable_fc0bd950:\n" 
".byte((loc_fc0bd984 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd99a - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9a2 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9b0 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9aa - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9ba - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9c0 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda0c - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9d0 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9d8 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9de - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9f4 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9fa - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda00 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda06 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda14 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda1a - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda20 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda26 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda2c - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda32 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda38 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda3e - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda44 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda4a - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda50 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda58 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda5e - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda62 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda6a - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda70 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda9a - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdaa0 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdaa6 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdaac - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdab2 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdab8 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdac0 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdac6 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdaea - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdaf0 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdb28 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdafc - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdb02 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdb08 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdb0e - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdb14 - branchtable_fc0bd950) / 2)\n"
".align 1\n"
"loc_fc0bd984:\n" // case 0: preshoot, quick press shoot
"       ldr     r0, [r0,#0xc]\n"
"       bl      sub_fc0d47f2\n"
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_capt_seq_override\n"
#endif
"bl shooting_expo_param_override\n" // +
"       bl      sub_fc0d36ac\n"
"       ldr     r0, [r4,#0x28]\n"
"       cmp     r0, #0\n"
"       beq     loc_fc0bd998\n"
"       bl      sub_fc0daf9e_my\n" // -> nr?, remote hook, raw hook (quick, no half press)
"loc_fc0bd998:\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd99a:\n" // case 1: (normal shoot)
"       ldr     r0, [r0,#0x10]\n"
"       bl      sub_fc0dae40_my\n" // ->  nr?, remote hook, raw hook
"       b       loc_fc0bdb28\n"
"loc_fc0bd9a2:\n"
"       movs    r0, #1\n"
"       bl      sub_fc0d4adc\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd9aa:\n"
"       bl      sub_fc0d4534\n"
"       b       loc_fc0bd9b6\n"
"loc_fc0bd9b0:\n"
"       ldr     r0, [r0,#0xc]\n"
"       bl      sub_fc0d47da\n"
"loc_fc0bd9b6:\n"
"       str     r6, [r4,#0x28]\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd9ba:\n"
"       bl      sub_fc0d47e0\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd9c0:\n"
"       bl      sub_fc0d4a7c\n"
"       bl      sub_fc0d36ac\n"
"       movs    r0, #0\n"
"       bl      sub_fc0a9748\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd9d0:\n"
"       ldr     r0, [r4,#0x54]\n"
"       bl      sub_fc0f8f44\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd9d8:\n"
"       bl      sub_fc0f91d0\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd9de:\n"
"       ldr     r0, [r0,#0xc]\n"
"       bl      sub_fc0f921c\n"
"       b       loc_fc0bdb28\n"
".ltorg\n"
//"       .byte    0\n"
//"       .byte    0\n"
//" off_fc0bd9e8 dcd dword_5a0f4\n"
//" off_fc0bd9ec dcd word_59ef0\n"
//" off_fc0bd9f0 dcd 0x0b358\n"
"loc_fc0bd9f4:\n"
"       bl      sub_fc0f93ee\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd9fa:\n"
"       bl      sub_fc0f9438\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda00:\n"
"       bl      sub_fc0f97ee\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda06:\n"
"       bl      sub_fc0f9884\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda0c:\n"
"       ldr     r0, [r0,#0xc]\n"
"       bl      sub_fc0d47da\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda14:\n"
"       bl      sub_fc0da684\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda1a:\n"
"       bl      sub_fc0da886\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda20:\n"
"       bl      sub_fc0da930\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda26:\n"
"       bl      sub_fc0da9e8\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda2c:\n"
"       movs    r0, #0\n"
"       b       loc_fc0bda52\n"
"loc_fc0bda30:\n"
"       b       loc_fc0bdb1a\n"
"loc_fc0bda32:\n"
"       bl      sub_fc0dab8c\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda38:\n"
"       bl      sub_fc0dabec\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda3e:\n"
"       bl      sub_fc0dabf0\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda44:\n"
"       bl      sub_fc0dac00\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda4a:\n"
"       bl      sub_fc0dac8c\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda50:\n"
"       movs    r0, #1\n"
"loc_fc0bda52:\n"
"       bl      sub_fc0daa6c\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda58:\n"
"       bl      sub_fc0d4bd4\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda5e:\n"
"       movs    r0, #0\n"
"       b       loc_fc0bda64\n"
"loc_fc0bda62:\n"
"       ldr     r0, [r0,#0xc]\n"
"loc_fc0bda64:\n"
"       bl      sub_fc0d4c08\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda6a:\n"
"       bl      sub_fc110638\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda70:\n"
"       ldr     r1, =0x00059f52\n"
"       movs    r2, #2\n"
"       movs    r0, #0x75\n"
"       bl      sub_fc373498\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc0bda8c\n"
"       movw    r2, #0x51a\n"
"       ldr     r1, =0xfc0bd504\n"
"       movs    r0, #0\n"
"       blx     sub_fc302410\n"
"loc_fc0bda8c:\n"
"       ldrh.w  r0, [r4,#0x62]\n"
"       cmp     r0, #1\n"
"       bne     loc_fc0bdb28\n"
"       bl      sub_fc110632\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda9a:\n"
"       bl      sub_fc1106bc\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdaa0:\n"
"       bl      sub_fc1107d8\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdaa6:\n"
"       bl      sub_fc0d3eb8\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdaac:\n"
"       bl      sub_fc0d4f4a\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdab2:\n"
"       bl      sub_fc0d5004\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdab8:\n"
"       ldr     r0, [r0,#0xc]\n"
"       bl      sub_fc0dad6c\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdac0:\n"
"       bl      sub_fc0dadbe\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdac6:\n"
"       bl      sub_fc0d58f8\n"
"       bl      sub_fc0d66b2\n"
"       ldrh.w  r0, [r4,#0x1a4]\n"
"       cmp     r0, #4\n"
"       beq     loc_fc0bdae0\n"
"       ldrh    r0, [r4]\n"
"       sub.w   r1, r0, #0x8200\n"
"       subs    r1, #0x36\n"
"       bne     loc_fc0bdb28\n"
"loc_fc0bdae0:\n"
"       bl      sub_fc0d5004\n"
"       bl      sub_fc0d5336\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdaea:\n"
"       movs    r2, #0\n"
"       movs    r1, #0x11\n"
"       b       loc_fc0bdaf4\n"
"loc_fc0bdaf0:\n"
"       movs    r2, #0\n"
"       movs    r1, #0x10\n"
"loc_fc0bdaf4:\n"
"       movs    r0, #0\n"
"       bl      sub_fc0d4046\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdafc:\n"
"       bl      sub_fc110f24\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdb02:\n"
"       bl      sub_fc110fa0\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdb08:\n"
"       bl      sub_fc110fe0\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdb0e:\n"
"       bl      sub_fc110e68\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdb14:\n"
"       bl      sub_fc110e6a\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdb1a:\n"
"       movw    r2, #0x588\n"
"       ldr 	r1, =0xfc0bd504\n" //  *"SsShootTask.c"
"       movs    r0, #0\n"
"       blx     sub_fc302410\n" // j_DebugAssert
"loc_fc0bdb28:\n"
#ifdef CAPTSEQ_DEBUG_LOG
// debug after message handled
"ldr     r0, [sp]\n"
"ldr     r0, [r0]\n"
"bl log_capt_seq2\n"
#endif
"       ldr     r0, [sp]\n"
"       ldr     r1, [r0,#4]\n"
"       ldr     r0, [r5,#4]\n"
"       blx     sub_fc302300\n" // j_SetEventFlag
"       ldr     r7, [sp]\n"
"       ldr     r0, [r7,#8]\n"
"       cbnz    r0, loc_fc0bdb46\n"
"       movw    r2, #0x12b\n"
"       ldr   	r1, =0xfc0bd504\n" //  *"SsShootTask.c"
"       movs    r0, #0\n"
"       blx     sub_fc302410\n" // j_DebugAssert
"loc_fc0bdb46:\n"
"       str     r6, [r7,#8]\n"
"       b       loc_fc0bd90e\n"
".ltorg\n"
    );
}

// -s=0xfc0daf9e -c=56 -f=chdk
void __attribute__((naked,noinline)) sub_fc0daf9e_my() {
    asm volatile (
"       push    {r4,lr}\n"
"       bl      sub_fc0f8b2c\n"
"       mov     r4, r0\n"
"       bl      sub_fc0d47e6\n"
"       bl      sub_fc143ba0\n"
"       mov     r1, r4\n"
"       bl      sub_fc143bee\n"
"       movs    r2, #4\n"
"       movw    r0, #0x116\n"
"       add.w   r1, r4, #0x34\n"
"       bl      sub_fc373346\n"
"       movs    r2, #4\n"
"       movs    r0, #0x30\n"
"       add.w   r1, r4, #0x38\n"
"       bl      sub_fc373346\n"
"       movs    r2, #4\n"
"       movs    r0, #0x44\n"
"       add.w   r1, r4, #8\n"
"       bl      sub_fc373346\n"
"       bl      sub_fc18aea2\n"
"       mov     r1, #0xffffefff\n"
"       blx     sub_fc3023b0\n"
"       mov     r0, r4\n"
"       bl      sub_fc18ab74\n"
"       bl      sub_fc256d6e\n"
"       bl      sub_fc0ab14a\n"
"       mov     r0, r4\n"
"       bl      sub_fc11d71e_my\n"		//->
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc0db004\n"
"       ldr     r1, =0x000132dc\n"
"       movs    r0, #1\n"
"       str     r0, [r1]\n"
"loc_fc0db004:\n"
"       pop     {r4,pc}\n"
".ltorg\n"
    );
}

//-s=0xfc0dae40 -c=211 -f=chdk
void __attribute__((naked,noinline)) sub_fc0dae40_my() {
    asm volatile (
"    push  {r3, r4, r5, r6, r7, lr}\n"
"       ldr     r6, =0x059ef0\n"
"       mov     r5, r0\n"
"       movs    r4, #0\n"
"       ldr     r0, [r6,#0x28]\n"
"       cbz     r0, loc_fc0dae68\n"
"       ldr     r0, =0x0132dc\n"
"       ldr     r0, [r0]\n"
"       cbz     r0, loc_fc0dae54\n"
"       movs    r4, #0x1d\n"
"loc_fc0dae54:\n"
"       mov     r2, r5\n"
"       movs    r1, #2\n"
"       mov     r0, r4\n"
"       bl      sub_fc0d4046\n"
"       mov     r1, r4\n"
"       mov     r0, r5\n"
"       bl      sub_fc18b1ee\n"
"       b       loc_fc0daf94\n"
"loc_fc0dae68:\n"
"       bl      sub_fc143ba0\n"
"       mov     r1, r5\n"
"       bl      sub_fc143bee\n"
"       movs    r2, #4\n"
"       movw    r0, #0x116\n"
"       add.w   r1, r5, #0x34\n"
"       bl      sub_fc373346\n"
"       movs    r2, #4\n"
"       movs    r0, #0x30\n"
"       add.w   r1, r5, #0x38\n"
"       bl      sub_fc373346\n"
"       ldr.w   r0, [r6,#0x10C]\n"
"       cbnz    r0, loc_fc0daea2\n"
"       ldrh.w  r0, [r6,#0x1A2]\n"
"       cmp     r0, #3\n"
"       beq     loc_fc0daea8\n"
"       ldr     r0, [r5,#8]\n"
"       cmp     r0, #1\n"
"       bhi     loc_fc0daeb8\n"
"       b       loc_fc0daea8\n"
"loc_fc0daea2:\n"
"       ldr     r0, [r5,#0xc]\n"
"       cmp     r0, #1\n"
"       bne     loc_fc0daeb8\n"
"loc_fc0daea8:\n"
"       movs    r0, #0xc\n"
"       bl      sub_fc325c14\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc0daeb8\n"
"       bl      sub_fc0d3eae\n"
"       movs    r4, #1\n"
"loc_fc0daeb8:\n"
"       lsls    r0, r4, #0x1f\n"
"       bne     loc_fc0daf82\n"
"       ldr.w   r0, [r6,#0xec]\n"
"       cbz     r0, loc_fc0daedc\n"
"       ldrh.w  r0, [r6,#0x1a2]\n"
"       cmp     r0, #3\n"
"       beq     loc_fc0daed0\n"
"       ldr     r0, [r5,#8]\n"
"       cmp     r0, #1\n"
"       bhi     loc_fc0daf22\n"
"loc_fc0daed0:\n"
"       ldr.w   r0, [r6,#0x10c]\n"
"       cbz     r0, loc_fc0daedc\n"
"       ldr     r0, [r5,#0xc]\n"
"       cmp     r0, #1\n"
"       bhi     loc_fc0daf22\n"
"loc_fc0daedc:\n"
"       bl      sub_fc111084\n"
"       cbnz    r0, loc_fc0daf22\n"
"       movs    r2, #2\n"
"       mov     r1, sp\n"
"       movw    r0, #0x110\n"
"       bl      sub_fc373498\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc0daefc\n"
"       movs    r2, #0xcb\n"
"       movs    r0, #0\n"
"       ldr     r1, =0x0fc0db020\n"
"       blx     sub_fc302410\n"
"loc_fc0daefc:\n"
"       ldrsh.w r0, [sp]\n"
"       bl      sub_fc130c70\n"
"       bl      sub_fc130b38\n"
"       cmp     r0, #1\n"
"       bls     loc_fc0daf14\n"
"       movs    r0, #0\n"
"       bl      sub_fc130c00\n"
"       b       loc_fc0daf22\n"
"loc_fc0daf14:\n"
"       bl      sub_fc0d3eae\n"
"       bl      sub_fc325c54\n"
"       movs    r4, #1\n"
"       lsls    r0, r4, #0x1f\n"
"       bne     loc_fc0daf82\n"
"loc_fc0daf22:\n"
"       mov     r0, r5\n"
"       bl      sub_fc11083e\n"
"       mov     r4, r0\n"
"       lsls    r0, r0, #0x1f\n"
"       bne     loc_fc0daf82\n"
"       bl      sub_fc18aea2\n"
"       mov     r1, #0xffffefff\n"
"       blx     sub_fc3023b0\n"
"       bl      sub_fc256d6e\n"
"       bl      sub_fc0ab14a\n"
"       mov     r0, r5\n"
"       bl      sub_fc11d450\n"
"       mov     r4, r0\n"
"       lsls    r0, r0, #0x1f\n"
"       bne     loc_fc0daf82\n"
"       bl      sub_fc0d47e6\n"
"       mov     r0, r5\n"
"       bl      sub_fc18ab74\n"
"       movs    r0, #2\n"
"       bl      sub_fc0d61ba\n"
"       ldr.w   r0, [r6,#0xb0]\n"
"       cbz     r0, loc_fc0daf6c\n"
"       mov     r0, r5\n"
"       bl      sub_fc11dd00\n"
"       b       loc_fc0daf94\n"
"loc_fc0daf6c:\n"
"       ldr.w   r0, [r6,#0xb4]\n"
"       cmp     r0, #0\n"
"       mov     r0, r5\n"
"       beq     loc_fc0daf7c\n"
"       bl      sub_fc11d97e\n"
"       b       loc_fc0daf94\n"
"loc_fc0daf7c:\n"
"       bl      sub_fc11d71e_my\n"  // SsStandardCaptureSeq.c hook
"       b       loc_fc0daf94\n"
"loc_fc0daf82:\n"
"       movs    r1, #2\n"
"       mov     r2, r5\n"
"       mov     r0, r4\n"
"       bl      sub_fc0d4046\n"
"       mov     r1, r4\n"
"       mov     r0, r5\n"
"       bl      sub_fc18b324\n"
"loc_fc0daf94:\n"
"       bl      sub_fc0f942a\n"
"       movs    r0, #0\n"
"       str     r0, [r6,#0x28]\n"
"    pop {r3, r4, r5, r6, r7, pc}\n"
".ltorg\n"
    );
}

// -s=0xfc11d71e -f=chdk
void __attribute__((naked,noinline)) sub_fc11d71e_my() {
    asm volatile (
"    push  {r2, r3, r4, r5, r6, r7, r8, r9, r10, lr}\n"
"       ldr     r6, =0xfc11d6f9\n"
"       mov     r5, r0\n"
"       bl      sub_fc18ab0a\n"
"       bl      sub_fc0db464\n"
"       ldr     r7, =0x059ef0\n"
"       ldr.w   r0, [r7,#(0x059f94 - 0x59ef0)]\n"
"       cbnz    r0, loc_fc11d74c\n"
"       ldrh.w  r0, [r7,#(0x05a092 - 0x59ef0)]\n"
"       cmp     r0, #3\n"
"       beq     loc_fc11d744\n"
"       ldr     r0, [r5,#8]\n"
"       cmp     r0, #1\n"
"       bhi     loc_fc11d74c\n"
"loc_fc11d744:\n"
"       bl      sub_fc0d4bf6\n"
"       bl      sub_fc0db046\n"
"loc_fc11d74c:\n"
"       movs    r2, #4\n"
"       movw    r0, #0x137\n"
"       add     r1, sp, #4\n"
"       bl      sub_fc373498\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc11d768\n"
"       movs    r0, #0\n"
"       movw    r2, #0x156\n"
"       ldr     r1, =0x0fc11d928\n"
"       blx     sub_fc302410\n"
"loc_fc11d768:\n"
"    BL      wait_until_remote_button_is_released\n" // + remote hook
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_remote_hook\n"
#endif
"       ldr     r0, [sp,#4]\n"
"       ubfx.w  r0, r0, #8, #8\n"
"       cmp     r0, #6\n"
"       bne     loc_fc11d778\n"
"       ldr     r0, =0xfc11d6f9\n"
"       movs    r1, #0\n"
"       b       loc_fc11d77c\n"
"loc_fc11d778:\n"
"       ldr     r0, =(0xfc18a8c4+1)\n"
"       mov     r1, r5\n"
"loc_fc11d77c:\n"
"       bl      sub_fc15526c\n"
"       ldr.w   r0, [r7,#0x18c]\n"
"       cbz     r0, loc_fc11d78a\n"
"       bl      sub_fc18aa20\n"
"loc_fc11d78a:\n"
"       movs    r0, #0\n"
"       bl      sub_fc0be0b0\n"
"       bl      sub_fc111132\n"
"       ldr.w   r8, =0xfc11d6f9\n"
"       mov     r4, r0\n"
"       lsls    r0, r0, #0x1f\n"
"       bne     loc_fc11d89c\n"
"bl capt_seq_hook_set_nr\n"
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_nr_call\n"
#endif
"       mov     r0, r5\n"
"       bl      sub_fc18ac72\n" // NR evaluation
"       mov     r0, r5\n"
"       bl      sub_fc11103c\n"
"       ldr     r1, =0x03ee78\n"
"       movs    r2, #4\n"
"       movs    r0, #0x90\n"
"       bl      sub_fc373498\n" // GetPropertyCase
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc11d7c4\n"
"       movs    r0, #0\n"
"       movw    r2, #0x171\n"
"       ldr     r1, =0x0fc11d928\n"
"       blx     sub_fc302410\n"
"loc_fc11d7c4:\n"
"       bl      sub_fc0be1e4\n"
"       bl      sub_fc18ad04\n"
"       movs    r1, #0\n"
"       mov     r0, r5\n"
"       bl      sub_fc11d6fa\n"
"       mov     r6, r0\n"
"       ldr     r0, [sp,#4]\n"
"       ubfx.w  r0, r0, #8, #8\n"
"       cmp     r0, #6\n"
"       bne     loc_fc11d7e4\n"
"       ldr     r2, =(0xfc18a9ee+1)\n"
"       b       loc_fc11d7e6\n"
"loc_fc11d7e4:\n"
"       ldr     r2, =(0xfc18aa04+1)\n"
"loc_fc11d7e6:\n"
"       ldrh    r0, [r5,#0x18]\n"
"       ldr     r4, =0x03ee78\n"
"       cbz     r0, loc_fc11d7f4\n"
"       cmp     r0, #1\n"
"       beq     loc_fc11d80a\n"
"       cmp     r0, #4\n"
"       bne     loc_fc11d85a\n"
"loc_fc11d7f4:\n"
"       str     r6, [sp]\n"
"       mov     r3, r2\n"
"       ldr     r1, [r5,#0x38]\n"
"       mov     r0, r5\n"
"       ldr     r2, [r4]\n"
"       bl      sub_fc18a718\n"
"       mov     r4, r0\n"
"       bl      sub_fc2b747e\n"
"       b       loc_fc11d868\n"
"loc_fc11d80a:\n"
"       str     r6, [sp]\n"
"       mov     r3, r2\n"
"       ldr     r1, [r5,#0x38]\n"
"       mov     r9, r4\n"
"       ldr     r2, [r4]\n"
"       mov     r0, r5\n"
"       bl      sub_fc18a778\n"
"       movs    r2, #1\n"
"       mov     r4, r0\n"
"       movs    r1, #0\n"
"       movs    r0, #0x45\n"
"       bl      sub_fc0ab2ec\n"
"       lsls    r0, r4, #0x1f\n"
"       bne     loc_fc11d868\n"
"       ldr     r0, =0xfc11d6f9\n"
"       movs    r1, #0\n"
"       bl      sub_fc15526c\n"
"       movs    r1, #1\n"
"       mov     r0, r5\n"
"       bl      sub_fc11d6fa\n"
"       mov     r6, r0\n"
"       ldr.w   r0, [r9]\n"
"       mov     r4, r9\n"
"       bl      sub_fc18aa88\n"
"       ldr     r1, [r5,#0x38]\n"
"       mov     r3, r6\n"
"       ldr     r2, [r4]\n"
"       mov     r0, r5\n"
"       bl      sub_fc18a7e6\n"
"       mov     r4, r0\n"
"       bl      sub_fc18a6c2\n"
"       b       loc_fc11d868\n"
"loc_fc11d85a:\n"
"       movs    r0, #0\n"
"       movw    r2, #0x1aa\n"
"       ldr     r1, =0x0fc11d928\n"
"       blx     sub_fc302410\n"
"       movs    r4, #0x1d\n"
"loc_fc11d868:\n"
"       bl      sub_fc18ad08\n"
"       lsls    r0, r4, #0x1f\n"
"       bne     loc_fc11d8d2\n"
"       mov     r0, r5\n"
"       bl      sub_fc18ad1e\n"
"       ldr.w   r0, [r7,#0x108]\n"
"       cbnz    r0, loc_fc11d89a\n"
"       mov     r0, r5\n"
"       bl      sub_fc11107e\n"
"       cbnz    r0, loc_fc11d89a\n"
"       mov     r0, r5\n"
"       bl      sub_fc18b462\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc11d89a\n"
"       movs    r0, #0\n"
"       movw    r2, #0x1d0\n"
"       ldr     r1, =0x0fc11d928\n"
"       blx     sub_fc302410\n"
"loc_fc11d89a:\n"
"       b       loc_fc11d89e\n"
"loc_fc11d89c:\n"
"       b       loc_fc11d8d2\n"
"loc_fc11d89e:\n"
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_rh\n"
#endif
"BL capt_seq_hook_raw_here\n" //----------------------------------- ???? ----------
"       mov     r0, r5\n"
"       bl      sub_fc18acf4\n"
"       mov     r0, r5\n"
"       bl      sub_fc18acc8\n"
"       cmp     r6, r8\n"
"       beq     loc_fc11d8d2\n"
"       bl      sub_fc18aea2\n"
"       movs    r1, #4\n"
"       movw    r9, #0x1dd\n"
"       ldr     r3, =0x0fc11d928\n"
"       movw    r2, #0x3a98\n"
"       str.w   r9, [sp]\n"
"       bl      sub_fc325dcc\n"
"       cbz     r0, loc_fc11d8d2\n"
"       movs    r0, #0\n"
"       mov     r2, r9\n"
"       ldr     r1, =0x0fc11d928\n"
"       blx     sub_fc302410\n"
"loc_fc11d8d2:\n"
"       ldr.w   r0, [r7,#0x18c]\n"
"       cbz     r0, loc_fc11d8e2\n"
"       movs    r2, #1\n"
"       movs    r1, #0\n"
"       movs    r0, #0x46\n"
"       bl      sub_fc0ab2ec\n"
"loc_fc11d8e2:\n"
"       movs    r1, #2\n"
"       mov     r2, r5\n"
"       mov     r0, r4\n"
"       bl      sub_fc0d4046\n"
"       ldr     r0, [r7,#0x28]\n"
"       cmp     r0, #0\n"
"       mov     r0, r8\n"
"       beq     loc_fc11d908\n"
"       cmp     r6, r0\n"
"       beq     loc_fc11d8fc\n"
"       movs    r1, #1\n"
"       b       loc_fc11d8fe\n"
"loc_fc11d8fc:\n"
"       movs    r1, #0\n"
"loc_fc11d8fe:\n"
"       mov     r2, r4\n"
"       mov     r0, r5\n"
"       bl      sub_fc18b1ac\n"
"       b       loc_fc11d91a\n"
"loc_fc11d908:\n"
"       cmp     r6, r0\n"
"       beq     loc_fc11d910\n"
"       movs    r1, #1\n"
"       b       loc_fc11d912\n"
"loc_fc11d910:\n"
"       movs    r1, #0\n"
"loc_fc11d912:\n"
"       mov     r2, r4\n"
"       mov     r0, r5\n"
"       bl      sub_fc18b166\n"
"loc_fc11d91a:\n"
"       mov     r0, r4\n"
"    pop {r2, r3, r4, r5, r6, r7, r8, r9, r10, pc}\n"
".ltorg\n"
    );
}	

#ifdef CAPTSEQ_DEBUG_LOG
void log_nr_call(void) {
    _LogCameraEvent(0x60,"nr hook %d",_nrflag);
}
void log_remote_hook(void) {
    _LogCameraEvent(0x60,"remote hook");
}
void log_rh(void) {
    _LogCameraEvent(0x60,"raw hook");
}
#endif

//exp_drv_task  -s=task_ExpDrv -c=428 -f=chdk

void __attribute__((naked,noinline)) exp_drv_task() {
    asm volatile (
// task_ExpDrv 0xFC2BC92C
"    push.w  {r4, r5, r6, r7, r8,r9,r10,r11, lr}\n"
//"       push.w  {r4-r11,lr}\n"
"       sub     sp, sp, #0x2c\n"
"       ldr.w   r9, =0x0d2d8\n"
"       ldr.w   r11, =0xfffff400\n"
"       movs    r0, #0\n"
"       ldr     r6, =0x66ba0\n"
"       add.w   r8, sp, #0x1c\n"
"       movw    r10, #0xbb8\n"
"       str     r0, [sp,#0xc]\n"
"loc_fc2bc948:\n"
"       ldr.w   r0, [r9,#(0x0d2fc - 0xd2d8)]\n"
"       movs    r2, #0\n"
"       add     r1, sp, #0x28\n"
"       mov     r4, r9\n"
"       blx     sub_fc3022b0\n"
"       ldr     r0, [sp,#0xc]\n"
"       cmp     r0, #1\n"
"       bne     loc_fc2bc984\n"
"       ldr     r0, [sp,#0x28]\n"
"       ldr     r0, [r0]\n"
"       cmp     r0, #0x15\n"
"loc_fc2bc962:\n"
"       beq     loc_fc2bca40\n"
"       cmp     r0, #0x16\n"
"       beq     loc_fc2bc962\n"
"       cmp     r0, #0x17\n"
"       beq     loc_fc2bc962\n"
"       cmp     r0, #0x18\n"
"       beq     loc_fc2bc962\n"
"       cmp     r0, #0x19\n"
"       beq     loc_fc2bc962\n"
"       cmp     r0, #0x1a\n"
"       beq     loc_fc2bc962\n"
"       cmp     r0, #0x31\n"
"       beq     loc_fc2bca46\n"
"       movs    r0, #0\n"
"       add     r1, sp, #0xc\n"
"       bl      sub_fc2bc66a\n"
"loc_fc2bc984:\n"
"       ldr     r0, [sp,#0x28]\n"
"       ldr     r1, [r0]\n"
"       cmp     r1, #0x39\n"
"       bne     loc_fc2bc9a2\n"
"       bl      sub_fc2bd9cc\n"
"       ldr.w   r0, [r9,#0x20]\n"
"       movs    r1, #1\n"
"       blx     sub_fc302300\n"
"       blx     sub_fc3022c8\n"
"       add     sp, sp, #0x2c\n"
"       b       locret_fc2bc3bc\n"
"loc_fc2bc9a2:\n"
"       cmp     r1, #0x38\n"
"       bne     loc_fc2bc9b4\n"
"loc_fc2bc9a6:\n"
"       add.w   r0, r0, #0xac\n"
"       ldrd.w  r2, r1, [r0]\n"
"       mov     r0, r1\n"
"       blx     r2\n"
"       b       loc_fc2bce2a\n"
"loc_fc2bc9b4:\n"
"       cmp     r1, #0x2f\n"
"       bne     loc_fc2bc9ea\n"
"       ldr     r0, [r4,#0x20]\n"
"       movs    r1, #0x80\n"
"       blx     sub_fc3023b0\n"
"       ldr     r0, =0xfc2b88e3\n"
"       movs    r1, #0x80\n"
"       bl      sub_fc318c22\n"
"       ldr     r0, [r4,#0x20]\n"
"       movs    r1, #0x80\n"
"       mov     r2, r10\n"
"       blx     sub_fc302280\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc2bc9dc\n"
"       movw    r2, #0x198a\n"
"       b       loc_fc2bcaac\n"
"loc_fc2bc9dc:\n"
"       ldr     r1, [sp,#0x28]\n"
"       add.w   r1, r1, #0xac\n"
"       ldrd.w  r1, r0, [r1]\n"
"       blx     r1\n"
"       b       loc_fc2bce2a\n"
"loc_fc2bc9ea:\n"
"       cmp     r1, #0x30\n"
"       bne     loc_fc2bca42\n"
"       add     r1, sp, #0xc\n"
"       bl      sub_fc2bc66a\n"
"       movw    r5, #0x100\n"
"       ldr     r0, [r4,#0x20]\n"
"       mov     r1, r5\n"
"       blx     sub_fc3023b0\n"
"       ldr     r0, =0xfc2b88ed\n"
"       mov     r1, r5\n"
"       bl      sub_fc318dcc\n"
"       ldr     r0, [r4,#0x20]\n"
"       mov     r2, r10\n"
"       mov     r1, r5\n"
"       blx     sub_fc302280\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc2bc9dc\n"
"       movw    r2, #0x1994\n"
"       b       loc_fc2bcaac\n"
/* " off_fc2bca1c dcd word_d2d8      ; ...\n"
" off_fc2bca20 dcd asc_fc2b8cc8   ; ...\n"
" dword_fc2bca24 dcd 0xfc2b88f7   ; ...\n"
" dword_fc2bca28 dcd 0x66ba0      ; ...\n"
" dword_fc2bca2c dcd 0xfc2b8901   ; ...\n"
" dword_fc2bca30 dcd 0xfffff400   ; ...\n"
" dword_fc2bca34 dcd 0xfc2b88d9   ; ...\n"
" dword_fc2bca38 dcd 0xfc2b88e3   ; ...\n"
" dword_fc2bca3c dcd 0xfc2b88ed   ; ...\n" */
"loc_fc2bca40:\n"
"       b       loc_fc2bcab6\n"
"loc_fc2bca42:\n"
"       cmp     r1, #0x31\n"
"       bne     loc_fc2bca50\n"
"loc_fc2bca46:\n"
"       ldr     r0, [sp,#0x28]\n"
"       add     r1, sp, #0xc\n"
"       bl      sub_fc2bc66a\n"
"       b       loc_fc2bc9dc\n"
"loc_fc2bca50:\n"
"       cmp     r1, #0x32\n"
"       bne     loc_fc2bca6a\n"
"       bl      sub_fc2bc6ae\n"
"       ldr     r1, [sp,#0x28]\n"
"       add.w   r1, r1, #0xac\n"
"       ldrd.w  r1, r0, [r1]\n"
"       blx     r1\n"
"       bl      sub_fc20cf62\n"
"       b       loc_fc2bce2a\n"
"loc_fc2bca6a:\n"
"       cmp     r1, #0x33\n"
"       beq     loc_fc2bc9a6\n"
"       cmp     r1, #0x36\n"
"       bne     loc_fc2bca80\n"
"       bl      sub_fc3604a0\n"
"       bl      sub_fc20d26c\n"
"       bl      sub_fc20cf62\n"
"       b       loc_fc2bc9dc\n"
"loc_fc2bca80:\n"
"       cmp     r1, #0x37\n"
"       bne     loc_fc2bcab6\n"
"       ldr     r0, [r4,#0x20]\n"
"       movs    r1, #4\n"
"       blx     sub_fc3023b0\n"
"       ldr     r1, =0xfc2b8901\n"
"       movs    r2, #4\n"
"       mov     r0, r11\n"
"       bl      sub_fc2bda1e\n"
"       bl      sub_fc360204\n"
"       ldr     r0, [r4,#0x20]\n"
"       movs    r1, #4\n"
"       mov     r2, r10\n"
"       blx     sub_fc302400\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc2bc9dc\n"
"       movw    r2, #0x1a77\n"
"loc_fc2bcaac:\n"
"       ldr     r1, =0x0fc2b8cc8\n"
"       movs    r0, #0\n"
"       blx     sub_fc302410\n"
"       b       loc_fc2bc9dc\n"
"loc_fc2bcab6:\n"
"       ldr     r0, [sp,#0x28]\n"
"       movs    r5, #1\n"
"       ldr     r1, [r0]\n"
"       cmp     r1, #0x13\n"
"       beq     loc_fc2bcac4\n"
"       cmp     r1, #0x14\n"
"       bne     loc_fc2bcb02\n"
"loc_fc2bcac4:\n"
"       ldr.w   r1, [r0,#0x94]\n"
"       mov     r4, r8\n"
"       add.w   r1, r1, r1,lsl#1\n"
"       add.w   r1, r0, r1,lsl#2\n"
"       subs    r1, #8\n"
"       ldmia   r1!, {r2,r3,r7}\n"
"       stmia   r4!, {r2,r3,r7}\n"
"       bl      sub_fc2bafe2\n"
"       ldr     r0, [sp,#0x28]\n"
"       add.w   r0, r0, #0x94\n"
"       ldrd.w  r3, r2, [r0,#0x18]\n"
"       ldr     r1, [r0]\n"
"       sub.w   r0, r0, #0x90\n"
"       blx     r3\n"
"       ldr     r0, [sp,#0x28]\n"
"       bl      sub_fc2bdc48\n"
"       ldr     r0, [sp,#0x28]\n"
"       add.w   r0, r0, #0x94\n"
"       ldr     r1, [r0]\n"
"       ldrd.w  r3, r2, [r0,#0x20]\n"
"       b       loc_fc2bcd4c\n"
"loc_fc2bcb02:\n"
"       cmp     r1, #0x15\n"
"       beq     loc_fc2bcb1a\n"
"       cmp     r1, #0x16\n"
"       beq     loc_fc2bcb1a\n"
"       cmp     r1, #0x17\n"
"       beq     loc_fc2bcb1a\n"
"       cmp     r1, #0x18\n"
"       beq     loc_fc2bcb1a\n"
"       cmp     r1, #0x19\n"
"       beq     loc_fc2bcb1a\n"
"       cmp     r1, #0x1a\n"
"       bne     loc_fc2bcb86\n"
"loc_fc2bcb1a:\n"
"       bl      sub_fc3604a0\n"
"       ldr     r0, [sp,#0x28]\n"
"       add     r3, sp, #0xc\n"
"       add     r1, sp, #0x1c\n"
"       mov     r2, sp\n"
"       bl      sub_fc2bb1c0\n"
"       cmp     r0, #1\n"
"       mov     r4, r0\n"
"       beq     loc_fc2bcb34\n"
"       cmp     r4, #5\n"
"       bne     loc_fc2bcb54\n"
"loc_fc2bcb34:\n"
"       ldr     r0, [sp,#0x28]\n"
"       mov     r2, r4\n"
"       add.w   r0, r0, #0x94\n"
"       ldrd.w  r7, r3, [r0,#0x18]\n"
"       ldr     r1, [r0]\n"
"       sub.w   r0, r0, #0x90\n"
"       blx     r7\n"
"       ldr     r2, [sp,#0xc]\n"
"       mov     r1, r4\n"
"       ldr     r0, [sp,#0x28]\n"
"       bl      sub_fc2bc628\n"
"loc_fc2bcb52:\n"
"       b       loc_fc2bcd52\n"
"loc_fc2bcb54:\n"
"       cmp     r4, #2\n"
"       beq     loc_fc2bcb5c\n"
"       cmp     r4, #6\n"
"       bne     loc_fc2bcb70\n"
"loc_fc2bcb5c:\n"
"       ldr     r0, [sp,#0x28]\n"
"       add     r1, sp, #0x1c\n"
"       mov     r2, sp\n"
"       bl      sub_fc2bc3c0\n"
"       ldr     r2, [sp,#0xc]\n"
"       mov     r1, r4\n"
"       ldr     r0, [sp,#0x28]\n"
"       bl      sub_fc2bc628\n"
"loc_fc2bcb70:\n"
"       ldr     r0, [sp,#0x28]\n"
"       mov     r2, r4\n"
"       add.w   r0, r0, #0x94\n"
"       ldrd.w  r7, r3, [r0,#0x18]\n"
"       ldr     r1, [r0]\n"
"       sub.w   r0, r0, #0x90\n"
"       blx     r7\n"
"       b       loc_fc2bcd52\n"
"loc_fc2bcb86:\n"
"       cmp     r1, #0x2b\n"
"       beq     loc_fc2bcb8e\n"
"       cmp     r1, #0x2c\n"
"       bne     loc_fc2bcbfc\n"
"loc_fc2bcb8e:\n"
"       ldr.w   r1, [r0,#0x94]\n"
"       mov     r7, r8\n"
"       add.w   r1, r1, r1,lsl#1\n"
"       add.w   r1, r0, r1,lsl#2\n"
"       subs    r1, #8\n"
"       ldmia   r1, {r1-r3}\n"
"       stmia   r7!, {r1-r3}\n"
"       bl      sub_fc2ba386\n"
"       ldr     r0, [sp,#0x28]\n"
"       add.w   r0, r0, #0x94\n"
"       ldrd.w  r3, r2, [r0,#0x18]\n"
"       ldr     r1, [r0]\n"
"       sub.w   r0, r0, #0x90\n"
"       blx     r3\n"
"       bl      sub_fc3604a0\n"
"       bl      sub_fc20d26c\n"
"       bl      sub_fc20cf62\n"
"       ldr     r0, [r4,#0x20]\n"
"       movs    r1, #2\n"
"       mov     r7, r10\n"
"       mov     r2, r10\n"
"       blx     sub_fc302280\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc2bcbe0\n"
"       ldr     r1, =0x0fc2b8cc8\n"
"       movs    r0, #0\n"
"       movw    r2, #0xeae\n"
"       blx     sub_fc302410\n"
"loc_fc2bcbe0:\n"
"       ldr     r0, [r4,#0x20]\n"
"       movs    r1, #0x20\n"
"       mov     r2, r7\n"
"       blx     sub_fc302280\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc2bcb52\n"
"       ldr     r1, =0x0fc2b8cc8\n"
"       movs    r0, #0\n"
"       movw    r2, #0xeb1\n"
"       blx     sub_fc302410\n"
"       b       loc_fc2bcd52\n"
"loc_fc2bcbfc:\n"
"       adds    r1, r0, #4\n"
"       mov     r4, r8\n"
"       ldmia   r1!, {r2,r3,r7}\n"
"       stmia   r4!, {r2,r3,r7}\n"
"       ldr     r1, [r0]\n"
"       cmp     r1, #0x2f\n"
"       bcs     loc_fc2bcc42\n"
"       tbb.w   [pc,r1]\n"
"branchtable_fc2bcc0a:\n"
".byte((loc_fc2bcc3e - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc3e - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc44 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc4a - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc4a - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc4a - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc3e - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc44 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc4a - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc4a - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc5c - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc5c - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc5c - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd30 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd36 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd36 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd36 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd36 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd3c - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd40 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd40 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd40 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd40 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd40 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd40 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd40 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd40 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc50 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc56 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc56 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc56 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc64 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc64 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc64 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc64 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc6a - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcc94 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bccbe - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bccc2 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bccca - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bccf4 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd1e - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd1e - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd40 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd40 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd24 - branchtable_fc2bcc0a) / 2)\n"
".byte((loc_fc2bcd2a - branchtable_fc2bcc0a) / 2)\n"
".align 1\n"
"loc_fc2bcc3e:\n"
"       bl      sub_fc2b8e0c\n"
"loc_fc2bcc42:\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bcc44:\n"
"       bl      sub_fc2b9084\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bcc4a:\n"
"       bl      sub_fc2b92a8\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bcc50:\n"
"       bl      sub_fc2b955c\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bcc56:\n"
"       bl      sub_fc2b9718\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bcc5c:\n"
"       bl      sub_fc2b9a84_my\n" //		_______-----________
"       movs    r5, #0\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bcc64:\n"
"       bl      sub_fc2b9b88\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bcc6a:\n"
"       ldrh    r1, [r0,#4]\n"
"       strh.w  r1, [sp,#0x1c]\n"
"       ldrh    r1, [r6,#2]\n"
"       strh.w  r1, [sp,#0x1e]\n"
"       ldrh    r1, [r6,#4]\n"
"       strh.w  r1, [sp,#0x20]\n"
"       ldrh    r1, [r6,#6]\n"
"       strh.w  r1, [sp,#0x22]\n"
"       ldrh    r1, [r0,#0xc]\n"
"       strh.w  r1, [sp,#0x24]\n"
"       ldrh    r1, [r6,#0xa]\n"
"       strh.w  r1, [sp,#0x26]\n"
"       bl      sub_fc2ba074\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bcc94:\n"
"       ldrh    r1, [r0,#4]\n"
"       strh.w  r1, [sp,#0x1c]\n"
"       ldrh    r1, [r6,#2]\n"
"       strh.w  r1, [sp,#0x1e]\n"
"       ldrh    r1, [r6,#4]\n"
"       strh.w  r1, [sp,#0x20]\n"
"       ldrh    r1, [r6,#6]\n"
"       strh.w  r1, [sp,#0x22]\n"
"       ldrh    r1, [r6,#8]\n"
"       strh.w  r1, [sp,#0x24]\n"
"       ldrh    r1, [r6,#0xa]\n"
"       strh.w  r1, [sp,#0x26]\n"
"       bl      sub_fc2bda96\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bccbe:\n"
"       movs    r1, #1\n"
"       b       loc_fc2bccc4\n"
"loc_fc2bccc2:\n"
"       movs    r1, #0\n"
"loc_fc2bccc4:\n"
"       bl      sub_fc2ba136\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bccca:\n"
"       ldrh    r1, [r6]\n"
"       strh.w  r1, [sp,#0x1c]\n"
"       ldrh    r1, [r0,#6]\n"
"       strh.w  r1, [sp,#0x1e]\n"
"       ldrh    r1, [r6,#4]\n"
"       strh.w  r1, [sp,#0x20]\n"
"       ldrh    r1, [r6,#6]\n"
"       strh.w  r1, [sp,#0x22]\n"
"       ldrh    r1, [r6,#8]\n"
"       strh.w  r1, [sp,#0x24]\n"
"       ldrh    r1, [r6,#0xa]\n"
"       strh.w  r1, [sp,#0x26]\n"
"       bl      sub_fc2bdb66\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bccf4:\n"
"       ldrh    r1, [r6]\n"
"       strh.w  r1, [sp,#0x1c]\n"
"       ldrh    r1, [r6,#2]\n"
"       strh.w  r1, [sp,#0x1e]\n"
"       ldrh    r1, [r6,#4]\n"
"       strh.w  r1, [sp,#0x20]\n"
"       ldrh    r1, [r6,#6]\n"
"       strh.w  r1, [sp,#0x22]\n"
"       ldrh    r1, [r0,#0xc]\n"
"       strh.w  r1, [sp,#0x24]\n"
"       ldrh    r1, [r6,#0xa]\n"
"       strh.w  r1, [sp,#0x26]\n"
"       bl      sub_fc2bdbda\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bcd1e:\n"
"       bl      sub_fc2ba17a\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bcd24:\n"
"       bl      sub_fc2ba738\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bcd2a:\n"
"       bl      sub_fc2ba982\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bcd30:\n"
"       bl      sub_fc2bab9e\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bcd36:\n"
"       bl      sub_fc2bacfc\n"
"       b       loc_fc2bcd40\n"
"loc_fc2bcd3c:\n"
"       bl      sub_fc2bae20\n"
"loc_fc2bcd40:\n"
"       ldr     r0, [sp,#0x28]\n"
"       add.w   r0, r0, #0x94\n"
"       ldrd.w  r3, r2, [r0,#0x18]\n"
"       ldr     r1, [r0]\n"
"loc_fc2bcd4c:\n"
"       sub.w   r0, r0, #0x90\n"
"       blx     r3\n"
"loc_fc2bcd52:\n"
"       ldr     r0, [sp,#0x28]\n"
"       ldr     r0, [r0]\n"
"       cmp     r0, #0x11\n"
"       beq     loc_fc2bcd76\n"
"       bgt     loc_fc2bcd6a\n"
"       cmp     r0, #1\n"
"       beq     loc_fc2bcd76\n"
"       cmp     r0, #4\n"
"       beq     loc_fc2bcd76\n"
"       cmp     r0, #0xf\n"
"       bne     loc_fc2bcda8\n"
"       b       loc_fc2bcd76\n"
"loc_fc2bcd6a:\n"
"       cmp     r0, #0x14\n"
"       beq     loc_fc2bcd76\n"
"       cmp     r0, #0x1a\n"
"       beq     loc_fc2bcd76\n"
"       cmp     r0, #0x1d\n"
"       bne     loc_fc2bcda8\n"
"loc_fc2bcd76:\n"
"       ldrsh.w r0, [r6]\n"
"       mov     r2, r11\n"
"       cmp     r0, r11\n"
"       beq     loc_fc2bcd88\n"
"       ldrsh.w r1, [r6,#8]\n"
"       cmp     r1, r2\n"
"       bne     loc_fc2bcda0\n"
"loc_fc2bcd88:\n"
"       add     r0, sp, #0x10\n"
"       bl      sub_fc3606de\n"
"       ldrh.w  r0, [sp,#0x10]\n"
"       strh.w  r0, [sp,#0x1c]\n"
"       ldrh.w  r0, [sp,#0x18]\n"
"       strh.w  r0, [sp,#0x24]\n"
"       b       loc_fc2bcda8\n"
"loc_fc2bcda0:\n"
"       strh.w  r0, [sp,#0x1c]\n"
"       strh.w  r1, [sp,#0x24]\n"
"loc_fc2bcda8:\n"
"       cmp     r5, #1\n"
"       ldr     r0, [sp,#0x28]\n"
"       bne     loc_fc2bcde0\n"
"       movs    r2, #0xc\n"
"       ldr.w   r1, [r0,#0x94]\n"
"       add.w   r1, r1, r1,lsl#1\n"
"       add.w   r4, r0, r1,lsl#2\n"
"       ldr     r0, =0x66ba0\n"
"       subs    r4, #8\n"
"       add     r1, sp, #0x1c\n"
"       blx     sub_fc302408\n"
"       ldr     r0, =0x66ba0\n"
"       movs    r2, #0xc\n"
"       add     r1, sp, #0x1c\n"
"       adds    r0, #0xc\n"
"       blx     sub_fc302408\n"
"       ldr     r0, =0x66ba0\n"
"       movs    r2, #0xc\n"
"       mov     r1, r4\n"
"       adds    r0, #0x18\n"
"       blx     sub_fc302408\n"
"       b       loc_fc2bce2a\n"
"loc_fc2bcde0:\n"
"       ldr     r0, [r0]\n"
"       mov.w   r3, #1\n"
"       cmp     r0, #0xc\n"
"       bne     loc_fc2bce0a\n"
"       movs    r2, #0\n"
"       mov     r1, r3\n"
"       strd.w  r2, r3, [sp]\n"
"       movs    r0, #0\n"
"       mov     r2, r3\n"
"       bl      sub_fc2b8c0c\n"
"       movs    r3, #1\n"
"       movs    r2, #0\n"
"       mov     r1, r3\n"
"       movs    r0, #0\n"
"       strd.w  r2, r3, [sp]\n"
"       mov     r2, r3\n"
"       b       loc_fc2bce26\n"
"loc_fc2bce0a:\n"
"       movs    r2, #1\n"
"       strd.w  r2, r3, [sp]\n"
"       mov     r3, r2\n"
"       mov     r1, r2\n"
"       mov     r0, r2\n"
"       bl      sub_fc2b8c0c\n"
"       movs    r3, #1\n"
"       str     r3, [sp]\n"
"       mov     r2, r3\n"
"       mov     r1, r3\n"
"       mov     r0, r3\n"
"       str     r3, [sp,#4]\n"
"loc_fc2bce26:\n"
"       bl      sub_fc2b8d4c\n"
"loc_fc2bce2a:\n"
"       ldr     r0, [sp,#0x28]\n"
"       bl      sub_fc2bd9cc\n"
"       b       loc_fc2bc948\n"
"locret_fc2bc3bc:\n"
//      POP.W   {R4-R11,PC}
"    pop.w  {r4, r5, r6, r7, r8, r9, r10, r11, pc}\n"
".ltorg\n"
    );
}
//loc_fc2b9a84: -s=0xfc28edd9 -c=  -f=chdk
void __attribute__((naked,noinline)) sub_fc2b9a84_my() {
asm volatile (
"    push.w  {r4, r5, r6, r7, r8, lr}\n"
"       ldr     r7, =0x0d2d8\n"
"       movs    r1, #0x3e\n"
"       mov     r4, r0\n"
"       ldr     r0, [r7,#(0x0d2f8 - 0xd2d8)]\n"
"       blx     sub_fc3023b0\n"
"       movs    r2, #0\n"
"       ldrsh.w r0, [r4,#4]\n"
"       movs    r3, #1\n"
"       mov     r1, r2\n"
"       bl      sub_fc2b894a\n"
"       mov     r6, r0\n"
"       ldrsh.w r0, [r4,#6]\n"
"       bl      sub_fc2b8ad2\n"
"       ldrsh.w r0, [r4,#8]\n"
"       bl      sub_fc2b8b16\n"
"       ldrsh.w r0, [r4,#0xa]\n"
"       bl      sub_fc2b8b5a\n"
"       ldrsh.w r0, [r4,#0xc]\n"
"       movs    r1, #0\n"
"       bl      sub_fc2b8b9e\n"
"       mov     r5, r0\n"
"       ldr     r0, [r4]\n"
"       ldr.w   r8, =0x66bb8\n"
"       cmp     r0, #0xc\n"
"       bne     loc_fc2b9ad8\n"
"       movs    r6, #0\n"
"       mov     r5, r6\n"
"       b       loc_fc2b9af0\n"
"loc_fc2b9ad8:\n"
"       cmp     r6, #1\n"
"       bne     loc_fc2b9af0\n"
"       ldrsh.w r0, [r4,#4]\n"
"       movs    r2, #2\n"
"       ldr     r1, =0xfc2b88d9\n"
"       bl      sub_fc318c3c\n"
"       strh    r0, [r4,#4]\n"
"       movs    r0, #0\n"
"       str     r0, [r7,#(0x0d304 - 0xd2d8)]\n"
"       b       loc_fc2b9af6\n"
"loc_fc2b9af0:\n"
"       ldrh.w  r0, [r8]\n"
"       strh    r0, [r4,#4]\n"
"loc_fc2b9af6:\n"
"       cmp     r5, #1\n"
"       bne     loc_fc2b9b08\n"
"       ldrsh.w r0, [r4,#0xc]\n"
"       movs    r2, #0x20\n"
"       ldr     r1, =0xfc2b8935\n"
"       bl      sub_fc2bda42\n"
"       b       loc_fc2b9b0c\n"
"loc_fc2b9b08:\n"
"       ldrh.w  r0, [r8,#8]\n"
"loc_fc2b9b0c:\n"
"       strh    r0, [r4,#0xc]\n"
"       ldrsh.w r0, [r4,#6]\n"
"       bl      sub_fc36025e_my\n"
"ldr pc,=0xfc2b9b17\n" //continue in ROM thumb
".ltorg\n"
/*
FC2B9B12       BL      sub_FC36025E
FC2B9B16       LDRSH.W R0, [R4,#8]
FC2B9B1A       MOVS    R1, #1

*/
 );
}
//loc_fc36025e:
void __attribute__((naked,noinline)) sub_fc36025e_my() {
asm volatile (
"    push    {r4, r5, r6, lr}\n"
"       ldr     r5, =0x0cd08\n"
"       mov     r4, r0\n"
"       ldr     r0, [r5,#(0x0cd0c - 0xcd08)]\n"
"       cmp     r0, #1\n"
"       beq     loc_fc360276\n"
"       movs    r0, #0\n"
"       movw    r2, #0x16b\n"
"       ldr     r1, =0xfc36031c\n"
"       blx     sub_fc302410\n"
"loc_fc360276:\n"
"       ldr     r0, =0xfffff400\n"
"       cmp     r4, r0\n"
"       bne     loc_fc360280\n"
"       ldrsh.w r4, [r5,#2]\n"
"loc_fc360280:\n"
"       strh    r4, [r5,#2]\n"
"       cmp     r4, r0\n"
"       bne     loc_fc360292\n"
"       movs    r0, #0\n"
"       movw    r2, #0x171\n"
"       ldr     r1, =0xfc36031c\n"
"       blx     sub_fc302410\n"
"loc_fc360292:\n"
"       mov     r0, r4\n"
"    	bl      apex2us\n"	
//"       bl      sub_fc3f41de\n"
// "       mov     r4, r0\n"
// "       bl      sub_fc23f5c8\n"
// "       mov     r0, r4\n"
"       bl      sub_fc15f942\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     locret_fc3602b8\n"
"    pop.w   {r4, r5, r6, lr}\n"
"       movs    r0, #0\n"
"       movw    r2, #0x176\n"
"       ldr     r1, =0xfc36031c\n"
//"       b.w     sub_fc3018f4\n"
"ldr pc, =0xfc3018f5\n" //replace above with thumb
" locret_fc3602b8:\n"
"    pop     {r4, r5, r6, pc}\n"
".ltorg\n"
 );
}

