/*
 * capt_seq.c - auto-generated by CHDK code_gen.
 */
#include "lolevel.h"
#include "platform.h"
#include "core.h"

static long *nrflag = (long*)0x6264;

#include "../../../generic/capt_seq.c"

/*************************************************************/
//** capt_seq_task @ 0xFFD55DB8 - 0xFFD55F88, length=117
void __attribute__((naked,noinline)) capt_seq_task() {
asm volatile (
"    STMFD   SP!, {R4,LR} \n"
"    SUB     SP, SP, #4 \n"
"    MOV     R4, SP \n"
"    B       loc_FFD55F54 \n"

"loc_FFD55DC8:\n"
"    LDR     R2, [SP] \n"
"    LDR     R3, [R2] \n"
"    MOV     R0, R2 \n"
"    CMP     R3, #0x16 \n"
"    LDRLS   PC, [PC, R3, LSL#2] \n"
"    B       loc_FFD55F28 \n"
"    .long   loc_FFD55E3C \n"
"    .long   loc_FFD55E5C \n"
"    .long   loc_FFD55E70 \n"
"    .long   loc_FFD55E84 \n"
"    .long   loc_FFD55E7C \n"
"    .long   loc_FFD55E8C \n"
"    .long   loc_FFD55E94 \n"
"    .long   loc_FFD55EA0 \n"
"    .long   loc_FFD55EA8 \n"
"    .long   loc_FFD55EB4 \n"
"    .long   loc_FFD55EBC \n"
"    .long   loc_FFD55EC4 \n"
"    .long   loc_FFD55ECC \n"
"    .long   loc_FFD55ED4 \n"
"    .long   loc_FFD55EDC \n"
"    .long   loc_FFD55EE8 \n"
"    .long   loc_FFD55EF0 \n"
"    .long   loc_FFD55EF8 \n"
"    .long   loc_FFD55F00 \n"
"    .long   loc_FFD55F0C \n"
"    .long   loc_FFD55F18 \n"
"    .long   loc_FFD55F20 \n"
"    .long   loc_FFD55F3C \n"

"loc_FFD55E3C:\n"
"    BL      sub_FFD56438 \n"
// only do quick press hack if overrides are active
"    BL      captseq_hack_override_active\n"      // returns 1 if tv or sv override in effect
"    STR     R0,[SP,#-4]!\n" // push return value
"    BL      shooting_expo_param_override\n"   // +
"    BL      sub_FFD53B94 \n"
"    LDR     R3, =0x91FA0 \n"
"    LDR     R2,[SP],#4\n" // pop override hack
"    CMP     R2, #1\n"     // +
"    MOVEQ   R2, #0\n"     // +
"    STREQ   R2, [R3,#0x28]\n" // fixes overrides behavior at short shutter press
"    LDRNE   R2, [R3,#0x28]\n" // modified NE
"    CMPNE   R2, #0\n"         // modified NE
//"    LDR     R2, [R3, #0x28] \n"  // above patch makes these lines redundant
//"    CMP     R2, #0 \n"
"    BEQ     loc_FFD55F38 \n"
"    BL      sub_FFD559BC_my \n"  // --> Patched. Old value = 0xFFD559BC.
"    B       loc_FFD55F38 \n"

"loc_FFD55E5C:\n"
"    BL      sub_FFD558E0_my \n"  // --> Patched. Old value = 0xFFD558E0.

"loc_FFD55E60:\n"
"    LDR     R2, =0x91FA0 \n"
"    MOV     R3, #0 \n"
"    STR     R3, [R2, #0x28] \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55E70:\n"
"    MOV     R0, #1 \n"
"    BL      sub_FFD5662C \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55E7C:\n"
"    BL      sub_FFD5604C \n"
"    B       loc_FFD55E60 \n"

"loc_FFD55E84:\n"
"    BL      sub_FFD563F0 \n"
"    B       loc_FFD55E60 \n"

"loc_FFD55E8C:\n"
"    BL      sub_FFD56400 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55E94:\n"
"    BL      sub_FFD56524 \n"
"    BL      sub_FFD53B94 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55EA0:\n"
"    BL      sub_FFD55A98 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55EA8:\n"
"    BL      sub_FFD5658C \n"
"    BL      sub_FFD53B94 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55EB4:\n"
"    BL      sub_FFD563F0 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55EBC:\n"
"    BL      sub_FFD57C18 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55EC4:\n"
"    BL      sub_FFD57DE4 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55ECC:\n"
"    BL      sub_FFD57E78 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55ED4:\n"
"    BL      sub_FFD57F14 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55EDC:\n"
"    MOV     R0, #0 \n"
"    BL      sub_FFD58180 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55EE8:\n"
"    BL      sub_FFD58338 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55EF0:\n"
"    BL      sub_FFD583C8 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55EF8:\n"
"    BL      sub_FFD58480 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55F00:\n"
"    MOV     R0, #1 \n"
"    BL      sub_FFD58180 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55F0C:\n"
"    BL      sub_FFD5676C \n"
"    BL      sub_FFD55804 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55F18:\n"
"    BL      sub_FFD58054 \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55F20:\n"
"    BL      sub_FFD580AC \n"
"    B       loc_FFD55F38 \n"

"loc_FFD55F28:\n"
"    MOV     R1, #0x4E0 \n"
"    LDR     R0, =0xFFD55660 /*'ShootTask.c'*/ \n"
"    ADD     R1, R1, #7 \n"
"    BL      _DebugAssert \n"

"loc_FFD55F38:\n"
"    LDR     R2, [SP] \n"

"loc_FFD55F3C:\n"
"    LDR     R3, =0x67094 \n"
"    LDR     R1, [R2, #4] \n"
"    LDR     R0, [R3] \n"
"    BL      sub_FFC108A0 /*_SetEventFlag*/ \n"
"    LDR     R0, [SP] \n"
"    BL      sub_FFD556DC \n"

"loc_FFD55F54:\n"
"    LDR     R3, =0x67098 \n"
"    MOV     R1, R4 \n"
"    LDR     R0, [R3] \n"
"    MOV     R2, #0 \n"
"    BL      sub_FFC10FB8 /*_ReceiveMessageQueue*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FFD55DC8 \n"
"    MOV     R1, #0x410 \n"
"    LDR     R0, =0xFFD55660 /*'ShootTask.c'*/ \n"
"    ADD     R1, R1, #9 \n"
"    BL      _DebugAssert \n"
"    BL      _ExitTask \n"
"    ADD     SP, SP, #4 \n"
"    LDMFD   SP!, {R4,PC} \n"
);
}

/*************************************************************/
//** sub_FFD559BC_my @ 0xFFD559BC - 0xFFD55A7C, length=49
void __attribute__((naked,noinline)) sub_FFD559BC_my() {
asm volatile (
"    STMFD   SP!, {R4,LR} \n"
"    BL      sub_FFD55568 \n"
"    LDR     R3, =0x91FA0 \n"
"    LDR     R2, [R3, #0x28] \n"
"    CMP     R2, #0 \n"
"    MOV     R4, R0 \n"
"    MOV     R0, #0xC \n"
"    BEQ     loc_FFD55A04 \n"
"    BL      sub_FFD5F510 \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FFD55A04 \n"
"    LDR     R3, [R4, #8] \n"
"    LDR     R2, =0x6248 \n"
"    ORR     R3, R3, #0x40000000 \n"
"    MOV     R1, #1 \n"
"    STR     R1, [R2] \n"
"    STR     R3, [R4, #8] \n"
"    LDMFD   SP!, {R4,PC} \n"

"loc_FFD55A04:\n"
"    BL      sub_FFD96AA4 \n"
"    BL      sub_FFC15680 \n"
"    STR     R0, [R4, #0x14] \n"
"    MOV     R0, R4 \n"
"    BL      sub_FFD5894C_my \n"  // --> Patched. Old value = 0xFFD5894C.
"    BL      capt_seq_hook_raw_here\n"   // +
"    TST     R0, #1 \n"
"    LDRNE   R3, =0x6248 \n"
"    MOVNE   R2, #1 \n"
"    STRNE   R2, [R3] \n"
"    LDMFD   SP!, {R4,PC} \n"
);
}

/*************************************************************/
//** sub_FFD558E0_my @ 0xFFD558E0 - 0xFFD559B0, length=53
void __attribute__((naked,noinline)) sub_FFD558E0_my() {
asm volatile (
"    STMFD   SP!, {R4,R5,LR} \n"
"    LDR     R3, =0x91FA0 \n"
"    LDR     R5, [R0, #0xC] \n"
"    LDR     R1, [R3, #0x28] \n"
"    LDR     R2, [R5, #8] \n"
"    CMP     R1, #0 \n"
"    ORR     R2, R2, #1 \n"
"    STR     R2, [R5, #8] \n"
"    BNE     loc_FFD55934 \n"
"    MOV     R0, #0xC \n"
"    BL      sub_FFD5F510 \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FFD55934 \n"
"    LDR     R3, [R5, #8] \n"
"    MOV     R0, #1 \n"
"    ORR     R3, R3, #0x40000000 \n"
"    STR     R3, [R5, #8] \n"

"loc_FFD55924:\n"
"    MOV     R2, R5 \n"
"    MOV     R1, #1 \n"
"    LDMFD   SP!, {R4,R5,LR} \n"
"    B       sub_FFD54100 \n"

"loc_FFD55934:\n"
"    LDR     R4, =0x91FA0 \n"
"    BL      sub_FFD56410 \n"
"    LDR     R3, [R4, #0x28] \n"
"    CMP     R3, #0 \n"
"    BNE     loc_FFD5597C \n"
"    MOV     R0, R5 \n"
"    BL      sub_FFD574E8 \n"
"    TST     R0, #1 \n"
"    BNE     loc_FFD55924 \n"
"    BL      sub_FFD96AA4 \n"
"    BL      sub_FFC15680 \n"
"    STR     R0, [R5, #0x14] \n"
"    MOV     R0, R5 \n"
"    BL      sub_FFD58834 \n"
"    BL      sub_FFD5919C \n"
"    MOV     R0, R5 \n"
"    BL      sub_FFD5894C_my \n"  // --> Patched. Old value = 0xFFD5894C.
"    BL      capt_seq_hook_raw_here\n"   // +
"    B       loc_FFD55990 \n"

"loc_FFD5597C:\n"
"    LDR     R3, =0x6248 \n"
"    LDR     R2, [R3] \n"
"    CMP     R2, #0 \n"
"    MOVNE   R0, #0x1D \n"
"    MOVEQ   R0, #0 \n"

"loc_FFD55990:\n"
"    MOV     R1, #1 \n"
"    MOV     R2, R5 \n"
"    BL      sub_FFD54100 \n"
"    BL      sub_FFD58C88 \n"
"    CMP     R0, #0 \n"
"    LDRNE   R3, [R5, #8] \n"
"    ORRNE   R3, R3, #0x2000 \n"
"    STRNE   R3, [R5, #8] \n"
"    LDMFD   SP!, {R4,R5,PC} \n"
);
}

/*************************************************************/
//** sub_FFD5894C_my @ 0xFFD5894C - 0xFFD589A4, length=23
void __attribute__((naked,noinline)) sub_FFD5894C_my() {
asm volatile (
"    STMFD   SP!, {R4,LR} \n"
"    MOV     R4, R0 \n"
"    SUB     SP, SP, #0xC \n"
"    BL      sub_FFD59310 \n"
"    MVN     R1, #0 \n"
"    BL      sub_FFC10A3C /*_ClearEventFlag*/ \n"
"    MOV     R0, #0x120 \n"
"    ADD     R0, R0, #2 \n"
"    ADD     R1, SP, #4 \n"
"    MOV     R2, #4 \n"
"    BL      _GetPropertyCase \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FFD5898C \n"
"    LDR     R0, =0xFFD587C8 /*'CaptureSeq.c'*/ \n"
"    MOV     R1, #0x1D0 \n"
"    BL      _DebugAssert \n"

"loc_FFD5898C:\n"
"    LDR     R3, =0x91FA0 \n"
"    LDR     R2, =0x92060 \n"
"    LDR     R0, [R3, #0x84] \n"
"    LDRSH   R1, [R2, #0xE] \n"
"    BL      sub_FFC91A4C \n"
"    MOV     R0, R4 \n"
"    BL      sub_FFD5874C \n"
"    BL      wait_until_remote_button_is_released\n"
"    BL      capt_seq_hook_set_nr\n"
"    LDR     PC, =0xFFD589A8 \n"  // Continue in firmware
);
}

/*************************************************************/
//** exp_drv_task @ 0xFFCFDCF0 - 0xFFCFE1F0, length=321
void __attribute__((naked,noinline)) exp_drv_task() {
asm volatile (
"    STMFD   SP!, {R4-R8,LR} \n"
"    SUB     SP, SP, #0x20 \n"
"    ADD     R7, SP, #4 \n"
"    B       loc_FFCFE1AC \n"

"loc_FFCFDD00:\n"
"    CMP     R2, #0x22 \n"
"    BNE     loc_FFCFDD18 \n"
"    LDR     R0, [R12, #0x8C] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R12, #0x88] \n"
"    B       loc_FFCFDD7C \n"

"loc_FFCFDD18:\n"
"    CMP     R2, #0x1D \n"
"    BNE     loc_FFCFDD2C \n"
"    MOV     R0, R12 \n"
"    BL      sub_FFCFDBC0 \n"
"    B       loc_FFCFDD6C \n"

"loc_FFCFDD2C:\n"
"    CMP     R2, #0x1E \n"
"    BNE     loc_FFCFDD40 \n"
"    MOV     R0, R12 \n"
"    BL      sub_FFCFDC1C \n"
"    B       loc_FFCFDD6C \n"

"loc_FFCFDD40:\n"
"    SUB     R3, R2, #0x1F \n"
"    CMP     R3, #1 \n"
"    BHI     loc_FFCFDD58 \n"
"    MOV     R0, R12 \n"
"    BL      sub_FFCFDC78 \n"
"    B       loc_FFCFDD6C \n"

"loc_FFCFDD58:\n"
"    CMP     R2, #0x21 \n"
"    BNE     loc_FFCFDD88 \n"
"    BL      sub_FFCA45E8 \n"
"    BL      sub_FFCA76DC \n"
"    BL      sub_FFCA6914 \n"

"loc_FFCFDD6C:\n"
"    LDR     R3, [SP, #4] \n"
"    LDR     R0, [R3, #0x8C] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R3, #0x88] \n"

"loc_FFCFDD7C:\n"
"    LDR     R0, [SP, #4] \n"
"    BL      sub_FFCF976C \n"
"    B       loc_FFCFE1AC \n"

"loc_FFCFDD88:\n"
"    CMP     R2, #0xD \n"
"    MOV     R8, #1 \n"
"    BNE     loc_FFCFDDF8 \n"
"    LDR     R1, [R12, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R1, R12, R1, LSL#2 \n"
"    ADD     R6, SP, #0x14 \n"
"    SUB     R1, R1, #8 \n"
"    MOV     R2, #0xC \n"
"    MOV     R0, R6 \n"
"    BL      _memcpy \n"
"    LDR     R0, [SP, #4] \n"
"    BL      sub_FFCFC248 \n"
"    LDR     R3, [SP, #4] \n"
"    LDR     R1, [R3, #0x7C] \n"
"    LDR     R2, [R3, #0x8C] \n"
"    ADD     R0, R3, #4 \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R3, #0x88] \n"
"    LDR     R0, [SP, #4] \n"
"    BL      sub_FFCFC518 \n"
"    LDR     R3, [SP, #4] \n"
"    ADD     R0, R3, #4 \n"
"    LDR     R1, [R3, #0x7C] \n"
"    LDR     R2, [R3, #0x94] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R3, #0x90] \n"
"    B       loc_FFCFE148 \n"

"loc_FFCFDDF8:\n"
"    SUB     R3, R2, #0xE \n"
"    CMP     R3, #1 \n"
"    BHI     loc_FFCFDEB4 \n"
"    ADD     R6, SP, #0x14 \n"
"    ADD     R5, SP, #8 \n"
"    MOV     R0, R12 \n"
"    MOV     R1, R6 \n"
"    MOV     R2, R5 \n"
"    BL      sub_FFCFC60C \n"
"    MOV     R4, R0 \n"
"    CMP     R4, #5 \n"
"    CMPNE   R4, #1 \n"
"    BNE     loc_FFCFDE4C \n"
"    LDR     R12, [SP, #4] \n"
"    MOV     R0, R5 \n"
"    LDR     R1, [R12, #0x7C] \n"
"    MOV     R2, R4 \n"
"    LDR     R3, [R12, #0x8C] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R12, #0x88] \n"
"    B       loc_FFCFDE84 \n"

"loc_FFCFDE4C:\n"
"    CMP     R4, #6 \n"
"    CMPNE   R4, #2 \n"
"    BNE     loc_FFCFDE94 \n"
"    LDR     R12, [SP, #4] \n"
"    MOV     R0, R5 \n"
"    MOV     R1, R8 \n"
"    MOV     R2, R4 \n"
"    LDR     R3, [R12, #0x8C] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R12, #0x88] \n"
"    MOV     R1, R6 \n"
"    LDR     R0, [SP, #4] \n"
"    MOV     R2, R5 \n"
"    BL      sub_FFCFD82C \n"

"loc_FFCFDE84:\n"
"    MOV     R1, R4 \n"
"    LDR     R0, [SP, #4] \n"
"    BL      sub_FFCFDB54 \n"
"    B       loc_FFCFE148 \n"

"loc_FFCFDE94:\n"
"    LDR     R12, [SP, #4] \n"
"    MOV     R2, R4 \n"
"    ADD     R0, R12, #4 \n"
"    LDR     R1, [R12, #0x7C] \n"
"    LDR     R3, [R12, #0x8C] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R12, #0x88] \n"
"    B       loc_FFCFE148 \n"

"loc_FFCFDEB4:\n"
"    SUB     R3, R2, #0x19 \n"
"    CMP     R3, #1 \n"
"    BHI     loc_FFCFDF0C \n"
"    LDR     R1, [R12, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R1, R12, R1, LSL#2 \n"
"    ADD     R6, SP, #0x14 \n"
"    SUB     R1, R1, #8 \n"
"    MOV     R2, #0xC \n"
"    MOV     R0, R6 \n"
"    BL      _memcpy \n"
"    LDR     R0, [SP, #4] \n"
"    BL      sub_FFCFB640 \n"
"    LDR     R3, [SP, #4] \n"
"    ADD     R0, R3, #4 \n"
"    LDR     R1, [R3, #0x7C] \n"
"    LDR     R2, [R3, #0x8C] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R3, #0x88] \n"
"    LDR     R0, [SP, #4] \n"
"    BL      sub_FFCFBA1C \n"
"    B       loc_FFCFE148 \n"

"loc_FFCFDF0C:\n"
"    ADD     R6, SP, #0x14 \n"
"    ADD     R1, R12, #4 \n"
"    MOV     R2, #0xC \n"
"    MOV     R0, R6 \n"
"    BL      _memcpy \n"
"    LDR     R12, [SP, #4] \n"
"    LDR     R3, [R12] \n"
"    MOV     R2, R12 \n"
"    CMP     R3, #0x1C \n"
"    LDRLS   PC, [PC, R3, LSL#2] \n"
"    B       loc_FFCFE134 \n"
"    .long   loc_FFCFDFAC \n"
"    .long   loc_FFCFDFB8 \n"
"    .long   loc_FFCFDFC4 \n"
"    .long   loc_FFCFDFC4 \n"
"    .long   loc_FFCFDFAC \n"
"    .long   loc_FFCFDFB8 \n"
"    .long   loc_FFCFDFC4 \n"
"    .long   loc_FFCFDFC4 \n"
"    .long   loc_FFCFDFE8 \n"
"    .long   loc_FFCFDFE8 \n"
"    .long   loc_FFCFE108 \n"
"    .long   loc_FFCFE114 \n"
"    .long   loc_FFCFE124 \n"
"    .long   loc_FFCFE134 \n"
"    .long   loc_FFCFE134 \n"
"    .long   loc_FFCFE134 \n"
"    .long   loc_FFCFDFD0 \n"
"    .long   loc_FFCFDFDC \n"
"    .long   loc_FFCFDFF8 \n"
"    .long   loc_FFCFE004 \n"
"    .long   loc_FFCFE03C \n"
"    .long   loc_FFCFE074 \n"
"    .long   loc_FFCFE0AC \n"
"    .long   loc_FFCFE0E4 \n"
"    .long   loc_FFCFE0E4 \n"
"    .long   loc_FFCFE134 \n"
"    .long   loc_FFCFE134 \n"
"    .long   loc_FFCFE0F0 \n"
"    .long   loc_FFCFE0FC \n"

"loc_FFCFDFAC:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FFCFA01C \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFDFB8:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FFCFA2C0 \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFDFC4:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FFCFA534 \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFDFD0:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FFCFA830 \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFDFDC:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FFCFAA94 \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFDFE8:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FFCFAC90_my \n"  // --> Patched. Old value = 0xFFCFAC90.
"    MOV     R8, #0 \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFDFF8:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FFCFADEC \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFE004:\n"
"    LDRH    R1, [R2, #4] \n"
"    LDR     R3, =0x42A10 \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R3, #6] \n"
"    STRH    R1, [SP, #0x1A] \n"
"    LDRH    R1, [R3, #2] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R3, [R3, #4] \n"
"    STRH    R3, [SP, #0x18] \n"
"    MOV     R0, R2 \n"
"    LDRH    R2, [R2, #0xC] \n"
"    STRH    R2, [SP, #0x1C] \n"
"    BL      sub_FFCFB0E8 \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFE03C:\n"
"    MOV     R0, R2 \n"
"    LDRH    R2, [R2, #4] \n"
"    LDR     R3, =0x42A10 \n"
"    STRH    R2, [SP, #0x14] \n"
"    LDRH    R2, [R3, #8] \n"
"    STRH    R2, [SP, #0x1C] \n"
"    LDRH    R1, [R3, #2] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R2, [R3, #4] \n"
"    STRH    R2, [SP, #0x18] \n"
"    LDRH    R3, [R3, #6] \n"
"    STRH    R3, [SP, #0x1A] \n"
"    BL      sub_FFCFB210 \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFE074:\n"
"    LDR     R3, =0x42A10 \n"
"    LDRH    R1, [R3] \n"
"    STRH    R1, [SP, #0x14] \n"
"    MOV     R0, R2 \n"
"    LDRH    R2, [R2, #6] \n"
"    STRH    R2, [SP, #0x16] \n"
"    LDRH    R2, [R3, #8] \n"
"    STRH    R2, [SP, #0x1C] \n"
"    LDRH    R1, [R3, #4] \n"
"    STRH    R1, [SP, #0x18] \n"
"    LDRH    R3, [R3, #6] \n"
"    STRH    R3, [SP, #0x1A] \n"
"    BL      sub_FFCFB2D4 \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFE0AC:\n"
"    LDR     R3, =0x42A10 \n"
"    LDRH    R1, [R3, #6] \n"
"    STRH    R1, [SP, #0x1A] \n"
"    LDRH    R1, [R3] \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R3, #2] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R3, [R3, #4] \n"
"    STRH    R3, [SP, #0x18] \n"
"    MOV     R0, R2 \n"
"    LDRH    R2, [R2, #0xC] \n"
"    STRH    R2, [SP, #0x1C] \n"
"    BL      sub_FFCFB38C \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFE0E4:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FFCFB43C \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFE0F0:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FFCFBB6C \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFE0FC:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FFCFBD68 \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFE108:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FFCFBF24 \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFE114:\n"
"    MOV     R0, R2 \n"
"    MOV     R1, #0 \n"
"    BL      sub_FFCFC108 \n"
"    B       loc_FFCFE130 \n"

"loc_FFCFE124:\n"
"    MOV     R0, R2 \n"
"    MOV     R1, #1 \n"
"    BL      sub_FFCFC108 \n"

"loc_FFCFE130:\n"
"    LDR     R12, [SP, #4] \n"

"loc_FFCFE134:\n"
"    ADD     R0, R12, #4 \n"
"    LDR     R1, [R12, #0x7C] \n"
"    LDR     R2, [R12, #0x8C] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R12, #0x88] \n"

"loc_FFCFE148:\n"
"    CMP     R8, #1 \n"
"    BNE     loc_FFCFE170 \n"
"    LDR     R1, [SP, #4] \n"
"    LDR     R3, [R1, #0x7C] \n"
"    ADD     R3, R3, R3, LSL#1 \n"
"    ADD     R1, R1, R3, LSL#2 \n"
"    MOV     R0, R6 \n"
"    SUB     R1, R1, #8 \n"
"    BL      sub_FFCF9D80 \n"
"    B       loc_FFCFE1A4 \n"

"loc_FFCFE170:\n"
"    MOV     R4, #1 \n"
"    MOV     R0, R4 \n"
"    MOV     R1, R4 \n"
"    MOV     R2, R4 \n"
"    MOV     R3, R4 \n"
"    STR     R4, [SP] \n"
"    BL      sub_FFCF9CD4 \n"
"    MOV     R0, R4 \n"
"    MOV     R1, R0 \n"
"    MOV     R2, R0 \n"
"    MOV     R3, R0 \n"
"    STR     R4, [SP] \n"
"    BL      sub_FFCF9E58 \n"

"loc_FFCFE1A4:\n"
"    LDR     R0, [SP, #4] \n"
"    BL      sub_FFCF976C \n"

"loc_FFCFE1AC:\n"
"    LDR     R3, =0x42A08 \n"
"    MOV     R2, #0 \n"
"    LDR     R0, [R3] \n"
"    MOV     R1, R7 \n"
"    BL      sub_FFC10FB8 /*_ReceiveMessageQueue*/ \n"
"    LDR     R12, [SP, #4] \n"
"    LDR     R2, [R12] \n"
"    CMP     R2, #0x23 \n"
"    BNE     loc_FFCFDD00 \n"
"    MOV     R0, R12 \n"
"    BL      sub_FFCF976C \n"
"    LDR     R3, =0x42A04 \n"
"    MOV     R1, #1 \n"
"    LDR     R0, [R3] \n"
"    BL      sub_FFC108A0 /*_SetEventFlag*/ \n"
"    BL      _ExitTask \n"
"    ADD     SP, SP, #0x20 \n"
"    LDMFD   SP!, {R4-R8,PC} \n"
);
}

/*************************************************************/
//** sub_FFCFAC90_my @ 0xFFCFAC90 - 0xFFCFADD4, length=82
void __attribute__((naked,noinline)) sub_FFCFAC90_my() {
asm volatile (
"    STMFD   SP!, {R4-R6,LR} \n"
"    LDR     R3, =0x42A04 \n"
"    MOV     R4, R0 \n"
"    MOV     R1, #0x3E \n"
"    LDR     R0, [R3] \n"
"    BL      sub_FFC10A3C /*_ClearEventFlag*/ \n"
"    MOV     R1, #0 \n"
"    LDRSH   R0, [R4, #4] \n"
"    BL      sub_FFCF98A0 \n"
"    MOV     R6, R0 \n"
"    LDRSH   R0, [R4, #6] \n"
"    BL      sub_FFCF9A14 \n"
"    LDRSH   R0, [R4, #8] \n"
"    BL      sub_FFCF9AB0 \n"
"    LDRSH   R0, [R4, #0xA] \n"
"    BL      sub_FFCF9B4C \n"
"    LDRSH   R0, [R4, #0xC] \n"
"    BL      sub_FFCF9BE8 \n"
"    LDR     R3, [R4] \n"
"    CMP     R3, #9 \n"
"    MOV     R5, R0 \n"
"    MOVEQ   R5, #0 \n"
"    MOVEQ   R6, R5 \n"
"    CMP     R6, #1 \n"
"    BNE     loc_FFCFAD14 \n"
"    MOV     R2, #2 \n"
"    LDRSH   R0, [R4, #4] \n"
"    LDR     R1, =0xFFCF97C0 \n"
"    BL      sub_FFE9B3E0 \n"
"    LDR     R2, =0x42A44 \n"
"    MOV     R3, #0 \n"
"    STR     R3, [R2] \n"
"    B       loc_FFCFAD18 \n"

"loc_FFCFAD14:\n"
"    BL      sub_FFCF9C84 \n"

"loc_FFCFAD18:\n"
"    STRH    R0, [R4, #4] \n"
"    CMP     R5, #1 \n"
"    BNE     loc_FFCFAD38 \n"
"    LDRSH   R0, [R4, #0xC] \n"
"    LDR     R1, =0xFFCF9884 \n"
"    MOV     R2, #0x20 \n"
"    BL      sub_FFCF9FBC \n"
"    B       loc_FFCFAD3C \n"

"loc_FFCFAD38:\n"
"    BL      sub_FFCF9CC4 \n"

"loc_FFCFAD3C:\n"
"    STRH    R0, [R4, #0xC] \n"
"    LDRSH   R0, [R4, #6] \n"
"    BL      sub_FFCA4270_my \n"  // --> Patched. Old value = 0xFFCA4270.
"    LDRSH   R0, [R4, #8] \n"
"    MOV     R1, #1 \n"
"    BL      sub_FFCA64D4 \n"
"    ADD     R0, R4, #8 \n"
"    MOV     R1, #0 \n"
"    BL      sub_FFCA6594 \n"
"    LDRSH   R0, [R4, #0xE] \n"
"    BL      sub_FFCE7768 \n"
"    CMP     R6, #1 \n"
"    BNE     loc_FFCFADA0 \n"
"    LDR     R3, =0x42A04 \n"
"    MOV     R2, #0xBB0 \n"
"    LDR     R0, [R3] \n"
"    MOV     R1, #2 \n"
"    ADD     R2, R2, #8 \n"
"    BL      sub_FFC10890 /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FFCFADA0 \n"
"    MOV     R1, #0x440 \n"
"    LDR     R0, =0xFFCF9718 /*'ExpDrv.c'*/ \n"
"    ADD     R1, R1, #0xB \n"
"    BL      _DebugAssert \n"

"loc_FFCFADA0:\n"
"    CMP     R5, #1 \n"
"    LDMNEFD SP!, {R4-R6,PC} \n"
"    LDR     R3, =0x42A04 \n"
"    MOV     R2, #0xBB0 \n"
"    LDR     R0, [R3] \n"
"    MOV     R1, #0x20 \n"
"    ADD     R2, R2, #8 \n"
"    BL      sub_FFC10890 /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    LDMEQFD SP!, {R4-R6,PC} \n"
"    LDR     R0, =0xFFCF9718 /*'ExpDrv.c'*/ \n"
"    MOV     R1, #0x450 \n"
"    LDMFD   SP!, {R4-R6,LR} \n"
"    B       _DebugAssert \n"
);
}

/*************************************************************/
//** sub_FFCA4270_my @ 0xFFCA4270 - 0xFFCA42CC, length=24
void __attribute__((naked,noinline)) sub_FFCA4270_my() {
asm volatile (
"    STMFD   SP!, {R4,LR} \n"
"    LDR     R3, =0x5328 \n"
"    LDR     R2, [R3] \n"
"    MOV     R1, #0x150 \n"
"    MOV     R3, R0, LSL#16 \n"
"    CMP     R2, #1 \n"
"    ADD     R1, R1, #1 \n"
"    LDR     R0, =0xFFCA3AAC /*'Shutter.c'*/ \n"
"    MOV     R4, R3, ASR#16 \n"
"    BEQ     loc_FFCA429C \n"
"    BL      _DebugAssert \n"

"loc_FFCA429C:\n"
"    MOV     R1, #0x154 \n"
"    CMN     R4, #0xC00 \n"
"    LDR     R3, =0x34356 \n"
"    LDR     R0, =0xFFCA3AAC /*'Shutter.c'*/ \n"
"    ADD     R1, R1, #3 \n"
"    LDREQSH R4, [R3] \n"
"    LDRNE   R3, =0x34356 \n"
"    CMN     R4, #0xC00 \n"
"    STRH    R4, [R3] \n"
"    BNE     loc_FFCA42C8 \n"
"    BL      _DebugAssert \n"

"loc_FFCA42C8:\n"
"    MOV     R0, R4 \n"
"    BL      apex2us \n"  // --> Patched. Old value = _apex2us.
"    LDR     PC, =0xFFCA42D0 \n"  // Continue in firmware
);
}
