#include "lolevel.h"
#include "platform.h"
#include "core.h"

// debug
//#define CAPTSEQ_DEBUG_LOG 1

#define USE_STUBS_NRFLAG 1
#define NR_AUTO (0) // For sx700v100e; method from G16 -- default value if NRTBL.SetDarkSubType not used is -1 (0 probalby works the same), set to enable auto
// static long *nrflag = (long*)0x0001b8e4 ; // sx700v100e 0x0001b8e0 + 0x04   found at 0xfc3145fc

#ifdef CAPTSEQ_DEBUG_LOG
extern void _LogCameraEvent(int id,const char *fmt,...);   // debug
extern int active_raw_buffer;
extern char *hook_raw_image_addr(void);

void log_remote_hook(void)
{
    _LogCameraEvent(0x60,"Remote Hook:");
}

void log_raw_hook(void) {
#ifdef VARIABLE_RAW_BUFFER
    _LogCameraEvent(0x60,"Raw Hook: arb:%d rb:0x%08x rbc:0x%08x",active_raw_buffer,hook_raw_image_addr(),current_raw_addr2);
#else
    _LogCameraEvent(0x60,"Raw Hook: arb:%d rb:0x%08x",active_raw_buffer,hook_raw_image_addr());
#endif
}

void log_capt_seq1(int m)
{
    _LogCameraEvent(0x60,"Capture Sequence Start: m:%d arb:%d rb:0x%08x i:%04d",
                    m,
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq2(int m)
{
    _LogCameraEvent(0x60,"Capture Sequence End: m:%d arb:%d rb:0x%08x i:%04d",
                    m,
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq3(void)
{
    _LogCameraEvent(0x60,"Capture Sequence Override: arb:%d rb:0x%08x i:%04d",
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());

}
#endif

#include "../../../generic/capt_seq.c"


//***  capt_seq_task *****

//  sx700v100e -f=chdk -s=task_CaptSeq -c=174 
// task_CaptSeq 0xfc12de09
void __attribute__((naked,noinline)) capt_seq_task() {
    asm volatile (
"    push    {r3, r4, r5, r6, r7, lr}\n"
"    ldr     r4, =0x00037518\n"
"    movs    r6, #0\n"
"    ldr     r5, =0x0000ba6c\n"
"loc_fc12de10:\n"
"    movs    r2, #0\n"
"    mov     r1, sp\n"
"    ldr     r0, [r5, #4]\n"
"    blx     sub_fc29b34c\n" // j_ReceiveMessageQueue
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc12de32\n"
"    movw    r2, #0x429\n"
"    ldr     r1, =0xfc12da98\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc29b444\n" // j_DebugAssert
"    blx     sub_fc29b364\n" // -> ExitTask
"    pop     {r3, r4, r5, r6, r7, pc}\n"
"loc_fc12de32:\n"
"    ldr     r0, [sp]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #1\n"
"    beq     loc_fc12de4a\n"
"    cmp     r0, #0x2a\n"
"    beq     loc_fc12de4a\n"
"    cmp     r0, #0x1e\n"
"    beq     loc_fc12de4a\n"
"    cmp     r0, #0x21\n"
"    beq     loc_fc12de4a\n"
"    bl      sub_fc1ba46c\n"
"loc_fc12de4a:\n"
#ifdef CAPTSEQ_DEBUG_LOG
// debug message
"ldr     r0, [sp]\n"
"ldr     r0, [r0]\n"
"bl log_capt_seq1\n"
#endif
"    ldr     r0, [sp]\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x2c\n"
"    bhs     loc_fc12df32\n"
"    tbb     [pc, r1]\n" // (jumptable r1 44 elements)
"branchtable_fc12de56:\n"
"    .byte((loc_fc12de82 - branchtable_fc12de56) / 2)\n" // (case 0)
"    .byte((loc_fc12de96 - branchtable_fc12de56) / 2)\n" // (case 1)
"    .byte((loc_fc12de9e - branchtable_fc12de56) / 2)\n" // (case 2)
"    .byte((loc_fc12deac - branchtable_fc12de56) / 2)\n" // (case 3)
"    .byte((loc_fc12dea6 - branchtable_fc12de56) / 2)\n" // (case 4)
"    .byte((loc_fc12deb4 - branchtable_fc12de56) / 2)\n" // (case 5)
"    .byte((loc_fc12deba - branchtable_fc12de56) / 2)\n" // (case 6)
"    .byte((loc_fc12dec0 - branchtable_fc12de56) / 2)\n" // (case 7)
"    .byte((loc_fc12dec8 - branchtable_fc12de56) / 2)\n" // (case 8)
"    .byte((loc_fc12df04 - branchtable_fc12de56) / 2)\n" // (case 9)
"    .byte((loc_fc12ded2 - branchtable_fc12de56) / 2)\n" // (case 10)
"    .byte((loc_fc12deda - branchtable_fc12de56) / 2)\n" // (case 11)
"    .byte((loc_fc12dee0 - branchtable_fc12de56) / 2)\n" // (case 12)
"    .byte((loc_fc12dee8 - branchtable_fc12de56) / 2)\n" // (case 13)
"    .byte((loc_fc12def8 - branchtable_fc12de56) / 2)\n" // (case 14)
"    .byte((loc_fc12defe - branchtable_fc12de56) / 2)\n" // (case 15)
"    .byte((loc_fc12df0a - branchtable_fc12de56) / 2)\n" // (case 16)
"    .byte((loc_fc12df10 - branchtable_fc12de56) / 2)\n" // (case 17)
"    .byte((loc_fc12df16 - branchtable_fc12de56) / 2)\n" // (case 18)
"    .byte((loc_fc12df1c - branchtable_fc12de56) / 2)\n" // (case 19)
"    .byte((loc_fc12df22 - branchtable_fc12de56) / 2)\n" // (case 20)
"    .byte((loc_fc12df28 - branchtable_fc12de56) / 2)\n" // (case 21)
"    .byte((loc_fc12df2c - branchtable_fc12de56) / 2)\n" // (case 22)
"    .byte((loc_fc12df34 - branchtable_fc12de56) / 2)\n" // (case 23)
"    .byte((loc_fc12df3a - branchtable_fc12de56) / 2)\n" // (case 24)
"    .byte((loc_fc12df40 - branchtable_fc12de56) / 2)\n" // (case 25)
"    .byte((loc_fc12df46 - branchtable_fc12de56) / 2)\n" // (case 26)
"    .byte((loc_fc12df4c - branchtable_fc12de56) / 2)\n" // (case 27)
"    .byte((loc_fc12df54 - branchtable_fc12de56) / 2)\n" // (case 28)
"    .byte((loc_fc12df5a - branchtable_fc12de56) / 2)\n" // (case 29)
"    .byte((loc_fc12df5e - branchtable_fc12de56) / 2)\n" // (case 30)
"    .byte((loc_fc12df66 - branchtable_fc12de56) / 2)\n" // (case 31)
"    .byte((loc_fc12df6c - branchtable_fc12de56) / 2)\n" // (case 32)
"    .byte((loc_fc12df72 - branchtable_fc12de56) / 2)\n" // (case 33)
"    .byte((loc_fc12df78 - branchtable_fc12de56) / 2)\n" // (case 34)
"    .byte((loc_fc12df7e - branchtable_fc12de56) / 2)\n" // (case 35)
"    .byte((loc_fc12df84 - branchtable_fc12de56) / 2)\n" // (case 36)
"    .byte((loc_fc12df8a - branchtable_fc12de56) / 2)\n" // (case 37)
"    .byte((loc_fc12df92 - branchtable_fc12de56) / 2)\n" // (case 38)
"    .byte((loc_fc12df98 - branchtable_fc12de56) / 2)\n" // (case 39)
"    .byte((loc_fc12dfa2 - branchtable_fc12de56) / 2)\n" // (case 40)
"    .byte((loc_fc12dfce - branchtable_fc12de56) / 2)\n" // (case 41)
"    .byte((loc_fc12dfd4 - branchtable_fc12de56) / 2)\n" // (case 42)
"    .byte((loc_fc12dfee - branchtable_fc12de56) / 2)\n" // (case 43)
".align 1\n"
"loc_fc12de82:\n" // case 0: preshoot, quick press shoot
"    bl      sub_fc12e326\n"
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_capt_seq3\n"
#endif
"    BL      shooting_expo_param_override\n" // +
"    bl      sub_fc12bb2e\n"
"    ldr     r0, [r4, #0x28]\n"
"    cmp     r0, #0\n"
"    beq     loc_fc12de94\n"
//"    bl      sub_fc1b935a\n" // quick press
"    bl      sub_fc1b935a_my\n" // SUB1
"loc_fc12de94:\n"
"    b       loc_fc12dfee\n"
"loc_fc12de96:\n"  // case 1: normal shoot
"    ldr     r0, [r0, #0x10]\n"
//"    bl      sub_fc1b91ce\n" // regular shoot
"    bl      sub_fc1b91ce_my\n" // SUB2
"    b       loc_fc12dfee\n"
"loc_fc12de9e:\n"               // case 2
"    movs    r0, #1\n"
"    bl      sub_fc12e5a6\n"
"    b       loc_fc12dfee\n"
"loc_fc12dea6:\n"              // case 4
"    bl      sub_fc12e0f2\n"
"    b       loc_fc12deb0\n"
"loc_fc12deac:\n"              // case 3
"    bl      sub_fc12e312\n"
"loc_fc12deb0:\n"
"    str     r6, [r4, #0x28]\n"
"    b       loc_fc12dfee\n"
"loc_fc12deb4:\n"
"    bl      sub_fc12e316\n"
"    b       loc_fc12dfee\n"
"loc_fc12deba:\n"
"    bl      sub_fc12e4ae\n"
"    b       loc_fc12decc\n"
"loc_fc12dec0:\n"
"    ldr     r0, [r0, #0x10]\n"
"    bl      sub_fc1b93ce\n"
"    b       loc_fc12dfee\n"
"loc_fc12dec8:\n"
"    bl      sub_fc12e534\n"
"loc_fc12decc:\n"
"    bl      sub_fc12bb2e\n"
"    b       loc_fc12dfee\n"
"loc_fc12ded2:\n"
"    ldr     r0, [r4, #0x50]\n"
"    bl      sub_fc12eb0c\n"
"    b       loc_fc12dfee\n"
"loc_fc12deda:\n"
"    bl      sub_fc12eda0\n"
"    b       loc_fc12dfee\n"
"loc_fc12dee0:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc12edec\n"
"    b       loc_fc12dfee\n"
"loc_fc12dee8:\n"
"    bl      sub_fc12ef66\n"
"    b       loc_fc12dfee\n"
".ltorg\n" 
/* literal pool
"    movs    r0, r0\n"
"    strb    r0, [r3, #0x14]\n"
"    movs    r3, r0\n"
"    rev16   r4, r5\n"
"    movs    r0, r0\n"
*/
"loc_fc12def8:\n"
"    bl      sub_fc12f328\n"
"    b       loc_fc12dfee\n"
"loc_fc12defe:\n"
"    bl      sub_fc12f3b8\n"
"    b       loc_fc12dfee\n"
"loc_fc12df04:\n"
"    bl      sub_fc12e312\n"
"    b       loc_fc12dfee\n"
"loc_fc12df0a:\n"
"    bl      sub_fc1b87a8\n"
"    b       loc_fc12dfee\n"
"loc_fc12df10:\n"
"    bl      sub_fc1b8936\n"
"    b       loc_fc12dfee\n"
"loc_fc12df16:\n"
"    bl      sub_fc1b89aa\n"
"    b       loc_fc12dfee\n"
"loc_fc12df1c:\n"
"    bl      sub_fc1b8a3c\n"
"    b       loc_fc12dfee\n"
"loc_fc12df22:\n"
"    bl      sub_fc1b8ad8\n"
"    b       loc_fc12dfee\n"
"loc_fc12df28:\n"
"    movs    r0, #0\n"
"    b       loc_fc12df4e\n"
"loc_fc12df2c:\n"
"    bl      sub_fc1b8dcc\n"
"    b       loc_fc12dfee\n"
"loc_fc12df32:\n"
"    b       loc_fc12dfe0\n"
"loc_fc12df34:\n"
"    bl      sub_fc1b8e2a\n"
"    b       loc_fc12dfee\n"
"loc_fc12df3a:\n"
"    bl      sub_fc1b8e2e\n"
"    b       loc_fc12dfee\n"
"loc_fc12df40:\n"
"    bl      sub_fc1b8e40\n"
"    b       loc_fc12dfee\n"
"loc_fc12df46:\n"
"    bl      sub_fc1b8ebc\n"
"    b       loc_fc12dfee\n"
"loc_fc12df4c:\n"
"    movs    r0, #1\n"
"loc_fc12df4e:\n"
"    bl      sub_fc1b8cc0\n"
"    b       loc_fc12dfee\n"
"loc_fc12df54:\n"
"    bl      sub_fc12e6b2\n"
"    b       loc_fc12dfee\n"
"loc_fc12df5a:\n"
"    movs    r0, #0\n"
"    b       loc_fc12df60\n"
"loc_fc12df5e:\n"
"    ldr     r0, [r0, #0xc]\n"
"loc_fc12df60:\n"
"    bl      sub_fc12e702\n"
"    b       loc_fc12dfee\n"
"loc_fc12df66:\n"
"    bl      sub_fc1b8bf4\n"
"    b       loc_fc12dfee\n"
"loc_fc12df6c:\n"
"    bl      sub_fc1b8c56\n"
"    b       loc_fc12dfee\n"
"loc_fc12df72:\n"
"    bl      sub_fc1b9e2a\n"
"    b       loc_fc12dfee\n"
"loc_fc12df78:\n"
"    bl      sub_fc12c364\n"
"    b       loc_fc12dfee\n"
"loc_fc12df7e:\n"
"    bl      sub_fc1314b4\n"
"    b       loc_fc12dfee\n"
"loc_fc12df84:\n"
"    bl      sub_fc131564\n"
"    b       loc_fc12dfee\n"
"loc_fc12df8a:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc1b8f7c\n"
"    b       loc_fc12dfee\n"
"loc_fc12df92:\n"
"    bl      sub_fc1b8fde\n"
"    b       loc_fc12dfee\n"
"loc_fc12df98:\n"
"    bl      sub_fc131654\n"
"    bl      sub_fc1315a2\n"
"    b       loc_fc12dfee\n"
"loc_fc12dfa2:\n"
"    movs    r0, #1\n"
"    bl      sub_fc1b9a6c\n"
"    movs    r0, #1\n"
"    bl      sub_fc1b9b36\n"
"    ldrh.w  r0, [r4, #0x198]\n"
"    cmp     r0, #4\n"
"    beq     loc_fc12dfc0\n"
"    ldrh    r0, [r4]\n"
"    sub.w   r1, r0, #0x4200\n"
"    subs    r1, #0x31\n"
"    bne     loc_fc12dfee\n"
"loc_fc12dfc0:\n"
"    bl      sub_fc131564\n"
"    bl      sub_fc131a44\n"
"    bl      sub_fc13188c\n"
"    b       loc_fc12dfee\n"
"loc_fc12dfce:\n"
"    movs    r2, #0\n"
"    movs    r1, #0x10\n"
"    b       loc_fc12dfd8\n"
"loc_fc12dfd4:\n"
"    movs    r2, #0\n"
"    movs    r1, #0xf\n"
"loc_fc12dfd8:\n"
"    movs    r0, #0\n"
"    bl      sub_fc12c530\n"
"    b       loc_fc12dfee\n"
"loc_fc12dfe0:\n"
"    movw    r2, #0x54d\n"
"    ldr     r1, =0xfc12da98\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc29b444\n" // j_DebugAssert
"loc_fc12dfee:\n" 
// debug after message handled
#ifdef CAPTSEQ_DEBUG_LOG
"ldr     r0, [sp]\n"
"ldr     r0, [r0]\n"
"bl log_capt_seq2\n"
#endif
"    bl      capt_seq_hook_set_nr\n" //  ---->> dark frame control
"    ldr     r0, [sp]\n"
"    ldr     r1, [r0, #4]\n"
"    ldr     r0, [r5]\n"
"    blx     sub_fc29b32c\n" // j_SetEventFlag
"    ldr     r7, [sp]\n"
"    ldr     r0, [r7, #8]\n"
"    cbnz    r0, loc_fc12e00c\n"
"    movw    r2, #0x11e\n"
"    ldr     r1, =0xfc12da98\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc29b444\n" // j_DebugAssert
"loc_fc12e00c:\n"
"    str     r6, [r7, #8]\n"
"    b       loc_fc12de10\n"
".ltorg\n"
    );
}

// Quick Press
// sx700v100e -f=chdk -s=0xfc1b935b -c=39
void __attribute__((naked,noinline)) sub_fc1b935a_my() { // SUB1
    asm volatile (
"    push    {r4, r5, r6, lr}\n"
"    bl      sub_fc12d52c\n"
"    mov     r4, r0\n"
"    movs    r0, #0xc\n"
"    bl      sub_fc2b70e0\n"
"    ldr     r6, =0x00014778\n"
"    lsls    r0, r0, #0x1f\n"
"    mov.w   r5, #1\n"
"    bne     loc_fc1b93ca\n"
"    bl      sub_fc2b7112\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc1b93ca\n"
"    bl      sub_fc12e31a\n"
"    bl      sub_fc12fe98\n"
"    mov     r1, r4\n"
"    bl      sub_fc12fede\n"
"    movs    r2, #4\n"
"    movw    r0, #0x10e\n"
"    add.w   r1, r4, #0x50\n"
"    bl      _SetPropertyCase\n"
"    movs    r2, #4\n"
"    movs    r0, #0x2c\n"
"    add.w   r1, r4, #0x54\n"
"    bl      _SetPropertyCase\n"
"    movs    r2, #4\n"
"    movs    r0, #0x3f\n"
"    add.w   r1, r4, #8\n"
"    bl      _SetPropertyCase\n"
"    bl      sub_fc1b9c26\n"
"    mvn     r1, #0x1000\n"
"    blx     sub_fc29b36c\n" // j_ClearEventFlag
"    mov     r0, r4\n"
"    bl      sub_fc36f7e0\n"
"    mov     r0, r4\n"
//"    bl      sub_fc36fa76\n"
"    bl      sub_fc36fa76_my\n" // -> SUB3 remote hook, raw hook
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1b93cc\n"
"loc_fc1b93ca:\n"
"    str     r5, [r6]\n"
"loc_fc1b93cc:\n"
"    pop     {r4, r5, r6, pc}\n"
".ltorg\n"
    );
}

// sx700v100e -f=chdk -s=0xfc1b91cf -c=147
void __attribute__((naked,noinline)) sub_fc1b91ce_my() { // SUB2
    asm volatile (
"    push    {r2, r3, r4, r5, r6, lr}\n"
"    ldr     r6, =0x00037518\n"
"    mov     r4, r0\n"
"    movs    r5, #0\n"
"    ldr     r0, [r6, #0x28]\n"
"    cbz     r0, loc_fc1b91f6\n"
"    ldr     r0, =0x00014778\n"
"    ldr     r0, [r0]\n"
"    cbz     r0, loc_fc1b91e2\n"
"    movs    r5, #0x1d\n"
"loc_fc1b91e2:\n"
"    mov     r2, r4\n"
"    movs    r1, #1\n"
"    mov     r0, r5\n"
"    bl      sub_fc12c530\n"
"    mov     r1, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc1ba2ca\n"
"    b       loc_fc1b9354\n"
"loc_fc1b91f6:\n"
"    bl      sub_fc12fe98\n"
"    mov     r1, r4\n"
"    bl      sub_fc12fede\n"
"    movs    r2, #4\n"
"    movw    r0, #0x10e\n"
"    add.w   r1, r4, #0x50\n"
"    bl      _SetPropertyCase\n"
"    movs    r2, #4\n"
"    movs    r0, #0x2c\n"
"    add.w   r1, r4, #0x54\n"
"    bl      _SetPropertyCase\n"
"    ldr.w   r0, [r6, #0x12c]\n"
"    cbz     r0, loc_fc1b924e\n"
"    ldrh.w  r0, [r6, #0x196]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc1b922e\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc1b923a\n"
"loc_fc1b922e:\n"
"    ldr.w   r0, [r6, #0x104]\n"
"    cbz     r0, loc_fc1b924e\n"
"    ldr     r0, [r4, #0xc]\n"
"    cmp     r0, #1\n"
"    bls     loc_fc1b924e\n"
"loc_fc1b923a:\n"
"    ldr.w   r0, [r6, #0xe4]\n"
"    cbnz    r0, loc_fc1b9266\n"
"    bl      sub_fc11a3a6\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1b9266\n"
"    bl      sub_fc2b714c\n"
"    b       loc_fc1b9264\n"
"loc_fc1b924e:\n"
"    movs    r0, #0xc\n"
"    bl      sub_fc2b70e0\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc1b9260\n"
"    bl      sub_fc2b7112\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1b9266\n"
"loc_fc1b9260:\n"
"    bl      sub_fc12c35a\n"
"loc_fc1b9264:\n"
"    movs    r5, #1\n"
"loc_fc1b9266:\n"
"    lsls    r0, r5, #0x1f\n"
"    bne     loc_fc1b9342\n"
"    mov     r0, r4\n"
"    bl      sub_fc1b9e74\n"
"    bl      sub_fc1b9c26\n"
"    mvn     r1, #0x1000\n"
"    blx     sub_fc29b36c\n" // j_ClearEventFlag
"    mov     r0, r4\n"
"    bl      sub_fc36f078\n"
"    mov     r5, r0\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc1b9342\n"
"    bl      sub_fc12e31a\n"
"    mov     r0, r4\n"
"    bl      sub_fc36f7e0\n"
"    ldr.w   r0, [r6, #0x128]\n"
"    cbnz    r0, loc_fc1b92a6\n"
"    ldrh.w  r0, [r6, #0x196]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc1b92a6\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc1b92ac\n"
"loc_fc1b92a6:\n"
"    movs    r0, #2\n"
"    bl      sub_fc1341ee\n"
"loc_fc1b92ac:\n"
"    ldr.w   r0, [r6, #0xa0]\n"
"    cmp     r0, #0\n"
"    beq     loc_fc1b931e\n"
"    ldrh.w  r0, [r6, #0x196]\n"
"    movw    r5, #0x1000\n"
"    cmp     r0, #3\n"
"    beq     loc_fc1b92dc\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bls     loc_fc1b92dc\n"
"    bl      sub_fc1b9c26\n"
"    movw    r3, #0x119\n"
"    movw    r2, #0x3a98\n"
"    mov     r1, r5\n"
"    str     r3, [sp]\n"
"    ldr     r3, =0xfc1b94a4\n" //  *"SsCaptureCtrl.c"
"    bl      sub_fc2b72b8\n"
"loc_fc1b92dc:\n"
"    movs    r2, #4\n"
"    movw    r0, #0x180\n"
"    add     r1, sp, #4\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1b92f8\n"
"    movs    r0, #0\n"
"    movw    r2, #0x11d\n"
"    ldr     r1, =0xfc1b94a4\n" //  *"SsCaptureCtrl.c"
"    blx     sub_fc29b444\n" // j_DebugAssert
"loc_fc1b92f8:\n"
"    ldr     r0, [sp, #4]\n"
"    cbnz    r0, loc_fc1b9308\n"
"    bl      sub_fc1b9c26\n"
"    mov     r1, r5\n"
"    blx     sub_fc29b32c\n" // j_SetEventFlag
"    b       loc_fc1b931e\n"
"loc_fc1b9308:\n"
"    bl      sub_fc1b9c26\n"
"    mov     r1, r5\n"
"    blx     sub_fc29b36c\n" // j_ClearEventFlag
"    ldr     r2, =0xfc1b91bd\n"
"    mov     r3, r5\n"
"    ldr     r0, [sp, #4]\n"
"    mov     r1, r2\n"
"    bl      sub_fc3004dc\n"
"loc_fc1b931e:\n"
"    ldr.w   r0, [r6, #0xac]\n"
"    cbz     r0, loc_fc1b932c\n"
"    mov     r0, r4\n"
"    bl      sub_fc36febc\n"
"    b       loc_fc1b9354\n"
"loc_fc1b932c:\n"
"    ldr.w   r0, [r6, #0xb0]\n"
"    cmp     r0, #0\n"
"    mov     r0, r4\n"
"    beq     loc_fc1b933c\n"
"    bl      sub_fc3701b6\n"
"    b       loc_fc1b9354\n"
"loc_fc1b933c:\n"
"    bl      sub_fc36fa76_my\n"   // ----> SUB3
"    b       loc_fc1b9354\n"
"loc_fc1b9342:\n"
"    movs    r1, #1\n"
"    mov     r2, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc12c530\n"
"    mov     r1, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc1ba400\n"
"loc_fc1b9354:\n"
"    movs    r0, #0\n"
"    str     r0, [r6, #0x28]\n"
"    pop     {r2, r3, r4, r5, r6, pc}\n"

".ltorg\n"
    );
}


// sx700v100e -f=chdk -s=0xfc36fa77 -c=188
void __attribute__((naked,noinline)) sub_fc36fa76_my() { // SUB3
    asm volatile (
"    push.w  {r2, r3, r4, r5, r6, r7, r8, sb, sl, lr}\n"
"    ldr     r7, =0x00037518\n"
"    mov     r4, r0\n"
"    ldr.w   r0, [r7, #0x164]\n"
"    cbz     r0, loc_fc36fa92\n"
"    ldrh.w  r0, [r7, #0x196]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc36fa92\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc36fa9c\n"
"loc_fc36fa92:\n"
"    mov     r0, r4\n"
"    bl      sub_fc36f776\n"
"    bl      sub_fc1b9896\n"
"loc_fc36fa9c:\n"
"    ldr.w   r0, [r7, #0x9c]\n"
"    cbnz    r0, loc_fc36fab8\n"
"    ldrh.w  r0, [r7, #0x196]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc36fab0\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc36fab8\n"
"loc_fc36fab0:\n"
"    bl      sub_fc12e6fe\n"
"    bl      sub_fc1b94d6\n"
"loc_fc36fab8:\n"
"    movs    r2, #4\n"
"    movw    r0, #0x12f\n"
"    add     r1, sp, #4\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc36fad4\n"
"    movs    r0, #0\n"
"    movw    r2, #0x18c\n"
"    ldr     r1, =0xfc36fe20\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc29b444\n" // j_DebugAssert
"loc_fc36fad4:\n"
"    ldr     r0, [sp, #4]\n"
"    ubfx    r0, r0, #8, #8\n"
"    cmp     r0, #6\n"
"    bne     loc_fc36fae4\n"
"    ldr     r0, =0xfc36fa4f\n"
"    movs    r1, #0\n"
"    b       loc_fc36fae8\n"
"loc_fc36fae4:\n"
"    ldr     r0, =0xfc36f49f\n"
"    mov     r1, r4\n"
"loc_fc36fae8:\n"
"    bl      sub_fc14f7ac\n"
"    mov     r0, r4\n"
"    bl      sub_fc36f88c\n"
"    ldr     r1, =0x00023450\n"
"    movs    r2, #4\n"
"    movs    r0, #0x8a\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc36fb0c\n"
"    movs    r0, #0\n"
"    movw    r2, #0x19b\n"
"    ldr     r1, =0xfc36fe20\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc29b444\n" // j_DebugAssert
"loc_fc36fb0c:\n"
"    bl      sub_fc130a30\n"
"    bl      sub_fc36f928\n"
"    movs    r1, #0\n"
"    mov     r0, r4\n"
"    bl      sub_fc36fdf2\n"
"    mov     r6, r0\n"
"    bl      wait_until_remote_button_is_released\n" // ---->> remote hook
#ifdef CAPT_SEQ_DEBUG
"    bl      log_remote_hook\n"   // ---->>
#endif
"    ldr     r0, [sp, #4]\n"
"    ubfx    r0, r0, #8, #8\n"
"    cmp     r0, #6\n"
"    bne     loc_fc36fb2c\n"
"    ldr     r2, =0xfc36f607\n"
"    b       loc_fc36fb2e\n"
"loc_fc36fb2c:\n"
"    ldr     r2, =0xfc36f68f\n"
"loc_fc36fb2e:\n"
"    ldrh    r0, [r4, #0x18]\n"
"    ldr     r5, =0x00023450\n"
"    cbz     r0, loc_fc36fb3c\n"
"    cmp     r0, #1\n"
"    beq     loc_fc36fb52\n"
"    cmp     r0, #4\n"
"    bne     loc_fc36fbb6\n"
"loc_fc36fb3c:\n"
"    str     r6, [sp]\n"
"    mov     r3, r2\n"
"    ldr     r1, [r4, #0x54]\n"
"    mov     r0, r4\n"
"    ldr     r2, [r5]\n"
"    bl      sub_fc36f36a\n"
"    mov     r5, r0\n"
"    bl      sub_fc14d328\n"
"    b       loc_fc36fbc4\n"
"loc_fc36fb52:\n"
"    str     r6, [sp]\n"
"    mov     r3, r2\n"
"    ldr     r1, [r4, #0x54]\n"
"    mov     r8, r5\n"
"    ldr     r2, [r5]\n"
"    mov     r0, r4\n"
"    bl      sub_fc36f3b6\n"
"    movs    r1, #0\n"
"    mov     r5, r0\n"
"    movs    r0, #0x45\n"
"    bl      sub_fc25cc38\n"
"    lsls    r0, r5, #0x1f\n"
"    bne     loc_fc36fbc4\n"
"    ldr.w   r0, [r7, #0xf8]\n"
"    cbz     r0, loc_fc36fb86\n"
"    ldr     r1, [r4, #8]\n"
"    ldr     r2, =0x001caa04\n"
"    ldr     r0, [r4, #0x54]\n"
"    add.w   r1, r2, r1, lsl #2\n"
"    str     r0, [r1, #-0x4]\n"
"    b       loc_fc36fbb0\n"
"loc_fc36fb86:\n"
"    ldr     r0, =0xfc36fa4f\n"
"    movs    r1, #0\n"
"    bl      sub_fc14f7ac\n"
"    movs    r1, #1\n"
"    mov     r0, r4\n"
"    bl      sub_fc36fdf2\n"
"    mov     r6, r0\n"
"    ldr.w   r0, [r8]\n"
"    mov     r5, r8\n"
"    bl      sub_fc36f718\n"
"    ldr     r1, [r4, #0x54]\n"
"    mov     r3, r6\n"
"    ldr     r2, [r5]\n"
"    mov     r0, r4\n"
"    bl      sub_fc36f406\n"
"    mov     r5, r0\n"
"loc_fc36fbb0:\n"
"    bl      sub_fc36f314\n"
"    b       loc_fc36fbc4\n"
"loc_fc36fbb6:\n"
"    movs    r0, #0\n"
"    movw    r2, #0x1d5\n"
"    ldr     r1, =0xfc36fe20\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc29b444\n" // j_DebugAssert
"    movs    r5, #0x1d\n"
"loc_fc36fbc4:\n"
"    bl      sub_fc36f92c\n"
"    ldr.w   r8, =0xfc36fa4f\n"
"    lsls    r0, r5, #0x1f\n"
"    bne     loc_fc36fc20\n"
"    ldr.w   r0, [r7, #0x100]\n"
"    cbnz    r0, loc_fc36fbec\n"
"    mov     r0, r4\n"
"    bl      sub_fc1ba892\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc36fbec\n"
"    movs    r0, #0\n"
"    movw    r2, #0x1ef\n"
"    ldr     r1, =0xfc36fe20\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc29b444\n" // j_DebugAssert
"loc_fc36fbec:\n"
#ifdef CAPT_SEQ_DEBUG
"  BL log_raw_hook\n"                  // ---->>
#endif
"    BL      capt_seq_hook_raw_here\n" // ---->>
"    mov     r0, r4\n"
"    bl      sub_fc36f918\n"
"    mov     r0, r4\n"
"    bl      sub_fc36f8ec\n"
"    cmp     r6, r8\n"
"    beq     loc_fc36fc20\n"
"    bl      sub_fc1b9c26\n"
"    movs    r1, #4\n"
"    movw    sb, #0x1fc\n"
"    ldr     r3, =0xfc36fe20\n" //  *"SsStandardCaptureSeq.c"
"    movw    r2, #0x3a98\n"
"    str.w   sb, [sp]\n"
"    bl      sub_fc2b72b8\n"
"    cbz     r0, loc_fc36fc20\n"
"    movs    r0, #0\n"
"    mov     r2, sb\n"
"    ldr     r1, =0xfc36fe20\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc29b444\n" // j_DebugAssert
"loc_fc36fc20:\n"
"    movs    r1, #1\n"
"    mov     r2, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc12c530\n"
"    ldr     r0, [r7, #0x28]\n"
"    cmp     r0, #0\n"
"    mov     r0, r8\n"
"    beq     loc_fc36fc46\n"
"    cmp     r6, r0\n"
"    beq     loc_fc36fc3a\n"
"    movs    r1, #1\n"
"    b       loc_fc36fc3c\n"
"loc_fc36fc3a:\n"
"    movs    r1, #0\n"
"loc_fc36fc3c:\n"
"    mov     r2, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc1ba288\n"
"    b       loc_fc36fc58\n"
"loc_fc36fc46:\n"
"    cmp     r6, r0\n"
"    beq     loc_fc36fc4e\n"
"    movs    r1, #1\n"
"    b       loc_fc36fc50\n"
"loc_fc36fc4e:\n"
"    movs    r1, #0\n"
"loc_fc36fc50:\n"
"    mov     r2, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc1ba242\n"
"loc_fc36fc58:\n"
"    mov     r0, r5\n"
"    pop.w   {r2, r3, r4, r5, r6, r7, r8, sb, sl, pc}\n"
".ltorg\n"
    );
}

// *******  exp_drv_task  *******
// Likley not needed in sx700hs, so if 0

#if 0
// sx700v100e -f=chdk -s=task_ExpDrv -c=425
// ?? note, breaks on literal pool around ????
// task_ExpDrv 0xfc276991
void __attribute__((naked,noinline)) exp_drv_task() {
    asm volatile (
"    push.w  {r4, r5, r6, r7, r8, sb, sl, fp, lr}\n"
"    sub     sp, #0x2c\n"
"    ldr.w   sb, =0x0000d6d4\n"
"    ldr.w   sl, =0xfffff400\n"
"    movs    r0, #0\n"
"    ldr     r6, =0x0005a258\n"
"    add.w   r8, sp, #0x1c\n"
"    movw    fp, #0xbb8\n"
"    str     r0, [sp, #0xc]\n"
"loc_fc2769ac:\n"
"    ldr.w   r0, [sb, #0x20]\n"
"    movs    r2, #0\n"
"    add     r1, sp, #0x28\n"
"    mov     r4, sb\n"
"    blx     sub_fc29b34c\n" // j_ReceiveMessageQueue
"    ldr     r0, [sp, #0xc]\n"
"    cmp     r0, #1\n"
"    bne     loc_fc2769e0\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x14\n"
"loc_fc2769c6:\n"
"    beq     loc_fc276ac6\n"
"    cmp     r0, #0x15\n"
"    beq     loc_fc2769c6\n"
"    cmp     r0, #0x16\n"
"    beq     loc_fc2769c6\n"
"    cmp     r0, #0x17\n"
"    beq     loc_fc276ad2\n"
"    cmp     r0, #0x2a\n"
"    beq     loc_fc276a7c\n"
"    movs    r0, #0\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc27694c\n"
"loc_fc2769e0:\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x30\n"
"    bne     loc_fc2769fe\n"
"    bl      sub_fc277736\n"
"    ldr.w   r0, [sb, #0x1c]\n"
"    movs    r1, #1\n"
"    blx     sub_fc29b32c\n" // j_SetEventFlag
"    blx     sub_fc29b364\n" // -> ExitTask
"    add     sp, #0x2c\n"
//"    b       loc_fc2766f4\n"                         // branches to pop.w
"    ldmia.w sp!, {r4, r5, r6, r7, r8, r9, sl, fp, pc}\n"  // substitute this instead
"loc_fc2769fe:\n"
"    cmp     r1, #0x2f\n"
"    bne     loc_fc276a10\n"
"    add.w   r0, r0, #0xa8\n"
"    ldrd    r2, r1, [r0]\n"
"    mov     r0, r1\n"
"    blx     r2\n"
"    b       loc_fc276e1e\n"
"loc_fc276a10:\n"
"    cmp     r1, #0x28\n"
"    bne     loc_fc276a46\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r1, #0x80\n"
"    blx     sub_fc29b36c\n" // j_ClearEventFlag
"    ldr     r0, =0xfc2728c1\n"
"    movs    r1, #0x80\n"
"    bl      sub_fc129792\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r1, #0x80\n"
"    mov     r2, fp\n"
"    blx     sub_fc29b29c\n" // j_WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc276a38\n"
"    movw    r2, #0x1732\n"
"    b       loc_fc276ac4\n"
"loc_fc276a38:\n"
"    ldr     r1, [sp, #0x28]\n"
"    add.w   r1, r1, #0xa8\n"
"    ldrd    r1, r0, [r1]\n"
"    blx     r1\n"
"    b       loc_fc276e1e\n"
"loc_fc276a46:\n"
"    cmp     r1, #0x29\n"
"    bne     loc_fc276a78\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc27694c\n"
"    movw    r5, #0x100\n"
"    ldr     r0, [r4, #0x1c]\n"
"    mov     r1, r5\n"
"    blx     sub_fc29b36c\n" // j_ClearEventFlag
"    ldr     r0, =0xfc2728cb\n"
"    mov     r1, r5\n"
"    bl      sub_fc12a112\n"
"    ldr     r0, [r4, #0x1c]\n"
"    mov     r2, fp\n"
"    mov     r1, r5\n"
"    blx     sub_fc29b29c\n" // j_WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc276a38\n"
"    movw    r2, #0x173c\n"
"    b       loc_fc276ac4\n"
"loc_fc276a78:\n"
"    cmp     r1, #0x2a\n"
"    bne     loc_fc276a86\n"
"loc_fc276a7c:\n"
"    ldr     r0, [sp, #0x28]\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc27694c\n"
"    b       loc_fc276a38\n"
"loc_fc276a86:\n"
"    cmp     r1, #0x2d\n"
"    bne     loc_fc276a98\n"
"    bl      sub_fc149b16\n"
"    bl      sub_fc14a49c\n"
"    bl      sub_fc14a182\n"
"    b       loc_fc276a38\n"
"loc_fc276a98:\n"
"    cmp     r1, #0x2e\n"
"    bne     loc_fc276ad2\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r1, #4\n"
"    blx     sub_fc29b36c\n" // j_ClearEventFlag
"    ldr     r1, =0xfc2728df\n"
"    movs    r2, #4\n"
"    mov     r0, sl\n"
"    bl      sub_fc272c2c\n"
"    bl      sub_fc14987a\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r1, #4\n"
"    mov     r2, fp\n"
"    blx     sub_fc29b404\n" // j_WaitForAnyEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc276a38\n"
"    movw    r2, #0x1774\n"
"loc_fc276ac4:\n"
"    b       loc_fc276ac8\n"
"loc_fc276ac6:\n"
"    b       loc_fc276ad2\n"
"loc_fc276ac8:\n"
"    ldr     r1, =0xfc2730b0\n" //  **"ExpDrv.c"
"    movs    r0, #0\n"
"    blx     sub_fc29b444\n" // j_DebugAssert
"    b       loc_fc276a38\n"
"loc_fc276ad2:\n"
"    ldr     r0, [sp, #0x28]\n"
"    movs    r5, #1\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x12\n"
"    beq     loc_fc276ae0\n"
"    cmp     r1, #0x13\n"
"    bne     loc_fc276b1e\n"
"loc_fc276ae0:\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    mov     r4, r8\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r1, r0, r1, lsl #2\n"
"    subs    r1, #8\n"
"    ldm     r1!, {r2, r3, r7}\n"
"    stm     r4!, {r2, r3, r7}\n"
"    bl      sub_fc275288\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x14]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc27791e\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldr     r1, [r0]\n"
"    ldrd    r3, r2, [r0, #0x1c]\n"
"    b       loc_fc276d40\n"
"loc_fc276b1e:\n"
"    cmp     r1, #0x14\n"
"    beq     loc_fc276b2e\n"
"    cmp     r1, #0x15\n"
"    beq     loc_fc276b2e\n"
"    cmp     r1, #0x16\n"
"    beq     loc_fc276b2e\n"
"    cmp     r1, #0x17\n"
"    bne     loc_fc276ba0\n"
"loc_fc276b2e:\n"
"    add     r3, sp, #0xc\n"
"    mov     r2, sp\n"
"    add     r1, sp, #0x1c\n"
"    bl      sub_fc27547e\n"
"    cmp     r0, #1\n"
"    mov     r4, r0\n"
"    beq     loc_fc276b42\n"
"    cmp     r4, #5\n"
"    bne     loc_fc276b58\n"
"loc_fc276b42:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r4\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x14]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    b       loc_fc276b7e\n"
"loc_fc276b58:\n"
"    cmp     r4, #2\n"
"    beq     loc_fc276b60\n"
"    cmp     r4, #6\n"
"    bne     loc_fc276b8a\n"
"loc_fc276b60:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r4\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x14]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    ldr     r0, [sp, #0x28]\n"
"    add     r1, sp, #0x1c\n"
"    mov     r2, sp\n"
"    bl      sub_fc2766f8\n"
"loc_fc276b7e:\n"
"    ldr     r2, [sp, #0xc]\n"
"    mov     r1, r4\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc276904\n"
"    b       loc_fc276d46\n"
"loc_fc276b8a:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r4\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x14]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    b       loc_fc276d46\n"
"loc_fc276ba0:\n"
"    cmp     r1, #0x24\n"
"    beq     loc_fc276ba8\n"
"    cmp     r1, #0x25\n"
"    bne     loc_fc276bda\n"
"loc_fc276ba8:\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    mov     r4, r8\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r1, r0, r1, lsl #2\n"
"    subs    r1, #8\n"
"    ldm     r1!, {r2, r3, r7}\n"
"    stm     r4!, {r2, r3, r7}\n"
"    bl      sub_fc274402\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x14]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc2747dc\n"
"    b       loc_fc276d46\n"
"loc_fc276bda:\n"
"    adds    r1, r0, #4\n"
"    mov     r4, r8\n"
"    ldm     r1!, {r2, r3, r7}\n"
"    stm     r4!, {r2, r3, r7}\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x28\n"
"    bhs     loc_fc276c18\n"
"    tbb     [pc, r1]\n" // (jumptable r1 40 elements)
"branchtable_fc276bec:\n"
"    .byte((loc_fc276c14 - branchtable_fc276bec) / 2)\n" // (case 0)
"    .byte((loc_fc276c14 - branchtable_fc276bec) / 2)\n" // (case 1)
"    .byte((loc_fc276c1a - branchtable_fc276bec) / 2)\n" // (case 2)
"    .byte((loc_fc276c20 - branchtable_fc276bec) / 2)\n" // (case 3)
"    .byte((loc_fc276c20 - branchtable_fc276bec) / 2)\n" // (case 4)
"    .byte((loc_fc276c20 - branchtable_fc276bec) / 2)\n" // (case 5)
"    .byte((loc_fc276c14 - branchtable_fc276bec) / 2)\n" // (case 6)
"    .byte((loc_fc276c1a - branchtable_fc276bec) / 2)\n" // (case 7)
"    .byte((loc_fc276c20 - branchtable_fc276bec) / 2)\n" // (case 8)
"    .byte((loc_fc276c20 - branchtable_fc276bec) / 2)\n" // (case 9)
"    .byte((loc_fc276c32 - branchtable_fc276bec) / 2)\n" // (case 10)
"    .byte((loc_fc276c32 - branchtable_fc276bec) / 2)\n" // (case 11)
"    .byte((loc_fc276d24 - branchtable_fc276bec) / 2)\n" // (case 12)
"    .byte((loc_fc276d2a - branchtable_fc276bec) / 2)\n" // (case 13)
"    .byte((loc_fc276d2a - branchtable_fc276bec) / 2)\n" // (case 14)
"    .byte((loc_fc276d2a - branchtable_fc276bec) / 2)\n" // (case 15)
"    .byte((loc_fc276d2a - branchtable_fc276bec) / 2)\n" // (case 16)
"    .byte((loc_fc276d30 - branchtable_fc276bec) / 2)\n" // (case 17)
"    .byte((loc_fc276d34 - branchtable_fc276bec) / 2)\n" // (case 18)
"    .byte((loc_fc276d34 - branchtable_fc276bec) / 2)\n" // (case 19)
"    .byte((loc_fc276d34 - branchtable_fc276bec) / 2)\n" // (case 20)
"    .byte((loc_fc276d34 - branchtable_fc276bec) / 2)\n" // (case 21)
"    .byte((loc_fc276d34 - branchtable_fc276bec) / 2)\n" // (case 22)
"    .byte((loc_fc276d34 - branchtable_fc276bec) / 2)\n" // (case 23)
"    .byte((loc_fc276c26 - branchtable_fc276bec) / 2)\n" // (case 24)
"    .byte((loc_fc276c2c - branchtable_fc276bec) / 2)\n" // (case 25)
"    .byte((loc_fc276c2c - branchtable_fc276bec) / 2)\n" // (case 26)
"    .byte((loc_fc276c2c - branchtable_fc276bec) / 2)\n" // (case 27)
"    .byte((loc_fc276c3a - branchtable_fc276bec) / 2)\n" // (case 28)
"    .byte((loc_fc276c3a - branchtable_fc276bec) / 2)\n" // (case 29)
"    .byte((loc_fc276c40 - branchtable_fc276bec) / 2)\n" // (case 30)
"    .byte((loc_fc276c94 - branchtable_fc276bec) / 2)\n" // (case 31)
"    .byte((loc_fc276cbe - branchtable_fc276bec) / 2)\n" // (case 32)
"    .byte((loc_fc276ce8 - branchtable_fc276bec) / 2)\n" // (case 33)
"    .byte((loc_fc276d12 - branchtable_fc276bec) / 2)\n" // (case 34)
"    .byte((loc_fc276d12 - branchtable_fc276bec) / 2)\n" // (case 35)
"    .byte((loc_fc276d34 - branchtable_fc276bec) / 2)\n" // (case 36)
"    .byte((loc_fc276d34 - branchtable_fc276bec) / 2)\n" // (case 37)
"    .byte((loc_fc276d18 - branchtable_fc276bec) / 2)\n" // (case 38)
"    .byte((loc_fc276d1e - branchtable_fc276bec) / 2)\n" // (case 39)
".align 1\n"
"loc_fc276c14:\n"
"    bl      sub_fc272e48\n"
"loc_fc276c18:\n"
"    b       loc_fc276d34\n"
"loc_fc276c1a:\n"
"    bl      sub_fc2730d0\n"
"    b       loc_fc276d34\n"
"loc_fc276c20:\n"
"    bl      sub_fc2732ca\n"
"    b       loc_fc276d34\n"
"loc_fc276c26:\n"
"    bl      sub_fc27356a\n"
"    b       loc_fc276d34\n"
"loc_fc276c2c:\n"
"    bl      sub_fc27371a\n"
"    b       loc_fc276d34\n"
"loc_fc276c32:\n"
//"    bl      sub_fc273b48\n"
"    bl      sub_fc273b48_my\n"           // --->
"    movs    r5, #0\n"
"    b       loc_fc276d34\n"
"loc_fc276c3a:\n"
"    bl      sub_fc273c42\n"
"    b       loc_fc276d34\n"
"loc_fc276c40:\n"
"    ldrh    r1, [r0, #4]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r0, #0xc]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc27414e\n"
"    b       loc_fc276d34\n"
".ltorg\n"
/* literals pool bad disassembly
"    movs    r0, r0\n"
"    adds    r0, #0xb0\n"
"    stc2    p8, c2, [r7], #-0x2dc\n"
"    stc2    p9, c2, [r7], #-0x2c\n"
"    stc2    p6, c13, [r7], #-0x350\n"
"    movs    r0, r0\n"
"    cmp     r0, #0xd5\n"
"    stc2    p2, c10, [r7], #-0x160\n"
"    movs    r5, r0\n"
"    bl      sub_fbe77c86\n"
"    cmp     r0, #0xc1\n"
"    stc2    p8, c2, [r7], #-0x32c\n"
"    stc2    p8, c2, [r7], #-0x37c\n"
"    stc2    p8, c8, [r7], #-0x204\n"
*/
"loc_fc276c94:\n"
"    ldrh    r1, [r0, #4]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r6, #8]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc2777b2\n"
"    b       loc_fc276d34\n"
"loc_fc276cbe:\n"
"    ldrh    r1, [r6]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r0, #6]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r6, #8]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc277838\n"
"    b       loc_fc276d34\n"
"loc_fc276ce8:\n"
"    ldrh    r1, [r6]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r0, #0xc]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc2778ae\n"
"    b       loc_fc276d34\n"
"loc_fc276d12:\n"
"    bl      sub_fc27422c\n"
"    b       loc_fc276d34\n"
"loc_fc276d18:\n"
"    bl      sub_fc2748a4\n"
"    b       loc_fc276d34\n"
"loc_fc276d1e:\n"
"    bl      sub_fc274c82\n"
"    b       loc_fc276d34\n"
"loc_fc276d24:\n"
"    bl      sub_fc274e60\n"
"    b       loc_fc276d34\n"
"loc_fc276d2a:\n"
"    bl      sub_fc274fda\n"
"    b       loc_fc276d34\n"
"loc_fc276d30:\n"
"    bl      sub_fc2750f6\n"
"loc_fc276d34:\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x14]\n"
"    ldr     r1, [r0]\n"
"loc_fc276d40:\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"loc_fc276d46:\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x10\n"
"    beq     loc_fc276d6a\n"
"    bgt     loc_fc276d5e\n"
"    cmp     r0, #1\n"
"    beq     loc_fc276d6a\n"
"    cmp     r0, #4\n"
"    beq     loc_fc276d6a\n"
"    cmp     r0, #0xe\n"
"    bne     loc_fc276d9c\n"
"    b       loc_fc276d6a\n"
"loc_fc276d5e:\n"
"    cmp     r0, #0x13\n"
"    beq     loc_fc276d6a\n"
"    cmp     r0, #0x17\n"
"    beq     loc_fc276d6a\n"
"    cmp     r0, #0x1a\n"
"    bne     loc_fc276d9c\n"
"loc_fc276d6a:\n"
"    ldrsh.w r0, [r6]\n"
"    mov     r2, sl\n"
"    cmp     r0, sl\n"
"    beq     loc_fc276d7c\n"
"    ldrsh.w r1, [r6, #8]\n"
"    cmp     r1, r2\n"
"    bne     loc_fc276d94\n"
"loc_fc276d7c:\n"
"    add     r0, sp, #0x10\n"
"    bl      sub_fc2d6990\n"
"    ldrh.w  r0, [sp, #0x10]\n"
"    strh.w  r0, [sp, #0x1c]\n"
"    ldrh.w  r0, [sp, #0x18]\n"
"    strh.w  r0, [sp, #0x24]\n"
"    b       loc_fc276d9c\n"
"loc_fc276d94:\n"
"    strh.w  r0, [sp, #0x1c]\n"
"    strh.w  r1, [sp, #0x24]\n"
"loc_fc276d9c:\n"
"    cmp     r5, #1\n"
"    ldr     r0, [sp, #0x28]\n"
"    bne     loc_fc276dd4\n"
"    movs    r2, #0xc\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r4, r0, r1, lsl #2\n"
"    ldr     r0, =0x0005a258\n"
"    subs    r4, #8\n"
"    add     r1, sp, #0x1c\n"
"    blx     sub_fc29b45c\n"
"    ldr     r0, =0x0005a258\n"
"    movs    r2, #0xc\n"
"    add     r1, sp, #0x1c\n"
"    adds    r0, #0xc\n"
"    blx     sub_fc29b45c\n"
"    ldr     r0, =0x0005a258\n"
"    movs    r2, #0xc\n"
"    mov     r1, r4\n"
"    adds    r0, #0x18\n"
"    blx     sub_fc29b45c\n"
"    b       loc_fc276e1e\n"
"loc_fc276dd4:\n"
"    ldr     r0, [r0]\n"
"    mov.w   r3, #1\n"
"    cmp     r0, #0xb\n"
"    bne     loc_fc276dfe\n"
"    movs    r2, #0\n"
"    mov     r1, r3\n"
"    strd    r2, r3, [sp]\n"
"    movs    r0, #0\n"
"    mov     r2, r3\n"
"    bl      sub_fc272ca8\n"
"    movs    r3, #1\n"
"    movs    r2, #0\n"
"    mov     r1, r3\n"
"    movs    r0, #0\n"
"    strd    r2, r3, [sp]\n"
"    mov     r2, r3\n"
"    b       loc_fc276e1a\n"
"loc_fc276dfe:\n"
"    movs    r2, #1\n"
"    strd    r2, r3, [sp]\n"
"    mov     r3, r2\n"
"    mov     r1, r2\n"
"    mov     r0, r2\n"
"    bl      sub_fc272ca8\n"
"    movs    r3, #1\n"
"    str     r3, [sp]\n"
"    mov     r2, r3\n"
"    mov     r1, r3\n"
"    mov     r0, r3\n"
"    str     r3, [sp, #4]\n"
"loc_fc276e1a:\n"
"    bl      sub_fc272dce\n"
"loc_fc276e1e:\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc277736\n"
"    b       loc_fc2769ac\n"
".ltorg\n"
    );
}

// Used by ExpDrv
// sx700v100e -f=chdk -s=0xfc273b49 -c=52
void __attribute__((naked,noinline)) sub_fc273b48_my() {
    asm volatile (
"    push.w  {r4, r5, r6, r7, r8, lr}\n"
"    ldr     r7, =0x0000d6d4\n"
"    movs    r1, #0x3e\n"
"    mov     r4, r0\n"
"    ldr     r0, [r7, #0x1c]\n"
"    blx     sub_fc29b36c\n" // j_ClearEventFlag
"    movs    r2, #0\n"
"    ldrsh.w r0, [r4, #4]\n"
"    movs    r3, #1\n"
"    mov     r1, r2\n"
"    bl      sub_fc272920\n"
"    mov     r6, r0\n"
"    ldrsh.w r0, [r4, #6]\n"
"    bl      sub_fc272abe\n"
"    ldrsh.w r0, [r4, #8]\n"
"    bl      sub_fc272b02\n"
"    ldrsh.w r0, [r4, #0xa]\n"
"    bl      sub_fc272b46\n"
"    ldrsh.w r0, [r4, #0xc]\n"
"    movs    r1, #0\n"
"    bl      sub_fc272b8a\n"
"    mov     r5, r0\n"
"    ldr     r0, [r4]\n"
"    ldr.w   r8, =0x0005a270\n"
"    cmp     r0, #0xb\n"
"    bne     loc_fc273b9c\n"
"    movs    r6, #0\n"
"    mov     r5, r6\n"
"    b       loc_fc273bb4\n"
"loc_fc273b9c:\n"
"    cmp     r6, #1\n"
"    bne     loc_fc273bb4\n"
"    ldrsh.w r0, [r4, #4]\n"
"    movs    r2, #2\n"
"    ldr     r1, =0xfc2728b7\n"
"    bl      sub_fc129982\n"
"    strh    r0, [r4, #4]\n"
"    movs    r0, #0\n"
"    str     r0, [r7, #0x28]\n"
"    b       loc_fc273bba\n"
"loc_fc273bb4:\n"
"    ldrh.w  r0, [r8]\n"
"    strh    r0, [r4, #4]\n"
"loc_fc273bba:\n"
"    cmp     r5, #1\n"
"    bne     loc_fc273bcc\n"
"    ldrsh.w r0, [r4, #0xc]\n"
"    movs    r2, #0x20\n"
"    ldr     r1, =0xfc27290b\n"
"    bl      sub_fc277788\n"
"    b       loc_fc273bd0\n"
"loc_fc273bcc:\n"
"    ldrh.w  r0, [r8, #8]\n"
"loc_fc273bd0:\n"
"    strh    r0, [r4, #0xc]\n"
"    ldrsh.w r0, [r4, #6]\n"
"    bl      sub_fc1498d4_my\n" // ->
"    ldr     pc, =0xfc273bdb\n" // continue in firmware, thumb
".ltorg\n"
    );
}

// Used by sub_fc273b48_my following from ExpDrv
// sx700v100e -f=chdk -s=0xfc1498d5 -c=35
void __attribute__((naked,noinline)) sub_fc1498d4_my() {
asm volatile (
"    push    {r4, r5, r6, lr}\n"
"    ldr     r5, =0x0000d2b4\n"
"    mov     r4, r0\n"
"    ldr     r0, [r5, #4]\n"
"    cmp     r0, #1\n"
"    beq     loc_fc1498ec\n"
"    movs    r0, #0\n"
"    movw    r2, #0x168\n"
"    ldr     r1, =0xfc149980\n" //  *"Shutter.c"
"    blx     sub_fc29b444\n" // j_DebugAssert
"loc_fc1498ec:\n"
"    ldr     r0, =0xfffff400\n"
"    cmp     r4, r0\n"
"    bne     loc_fc1498f6\n"
"    ldrsh.w r4, [r5, #2]\n"
"loc_fc1498f6:\n"
"    strh    r4, [r5, #2]\n"
"    cmp     r4, r0\n"
"    bne     loc_fc149908\n"
"    movs    r0, #0\n"
"    movw    r2, #0x16e\n"
"    ldr     r1, =0xfc149980\n" //  *"Shutter.c"
"    blx     sub_fc29b444\n" // j_DebugAssert
"loc_fc149908:\n"
"    mov     r0, r4\n"
//"    bl      fc313636\n" 
"    bl      sub_fc313636\n" // ?? _apex2us
//"    bl      apex2us\n"
"    mov     r4, r0\n" 
"    bl      sub_fc184f1a\n" 
"    mov     r0, r4\n"
"    bl      sub_fc1891ba\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc14992e\n"
"    pop.w   {r4, r5, r6, lr}\n"
"    movs    r0, #0\n"
"    movw    r2, #0x173\n"
"    ldr     r1, =0xfc149980\n" //  *"Shutter.c"
//"    b.w     loc_fc29aa60\n" // -> DebugAssert
"    ldr     pc,=0xfc29aa61\n" // -> DebugAssert  << replaced with thumb code
"loc_fc14992e:\n"
"    pop     {r4, r5, r6, pc}\n"
".ltorg\n"
    );
}
#endif

