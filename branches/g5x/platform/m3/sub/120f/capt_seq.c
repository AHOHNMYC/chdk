#include "lolevel.h"
#include "platform.h"
#include "core.h"

// debug
//#define CAPTSEQ_DEBUG_LOG 1

extern int active_raw_buffer;
// debug
extern void _LogCameraEvent(int id,const char *fmt,...);

#define USE_STUBS_NRFLAG 1
#define NR_AUTO (-1) // default value if NRTBL.SetDarkSubType not used is -1 (0 probalby works the same), set to enable auto

#ifdef CAPTSEQ_DEBUG_LOG
extern char *hook_raw_image_addr(void);

void log_capt_seq(int m)
{
    _LogCameraEvent(0x60,"cs m:%d arb:%d rb:0x%08x i:%04d",
                    m,
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq2(int m)
{
    _LogCameraEvent(0x60,"cs end m:%d arb:%d rb:0x%08x i:%04d",
                    m,
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq_override(void)
{
    _LogCameraEvent(0x60,"cs override arb:%d rb:0x%08x i:%04d",
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
#endif

#include "../../../generic/capt_seq.c"
//-s=task_CaptSeq -c=173 -f=chdk
// task_CaptSeq 0xFC0BD906
void __attribute__((naked,noinline)) capt_seq_task() {
    asm volatile (
"       push    {r3, r4, r5, r6, r7,lr}\n"
"       ldr     r4, =0x059F20\n"
"       movs    r6, #0\n"
"       ldr     r5, =0x0b378\n"
"loc_fc0bd90e:\n"
"       movs    r2, #0\n"
"       mov     r1, sp\n"
"       ldr     r0, [r5,#8]\n"
"       blx     sub_FC3022D4\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc0bd930\n"
"       movw    r2, #0x455\n"
"       ldr   r1, =0xfc0bd504\n"
"       movs    r0, #0\n"
"       blx     sub_FC302434\n"
"       blx     sub_FC3022EC\n"
"       pop     {r3, r4, r5, r6, r7,pc}\n"
"loc_fc0bd930:\n"
"       ldr     r0, [sp]\n"
"       ldr     r0, [r0]\n"
"       cmp     r0, #1\n"
"       beq     loc_fc0bd948\n"
"       cmp     r0, #0x28\n"
"       beq     loc_fc0bd948\n"
"       cmp     r0, #0x1c\n"
"       beq     loc_fc0bd948\n"
"       cmp     r0, #0x20\n"
"       beq     loc_fc0bd948\n"
"       bl      sub_FC18B492\n"
"loc_fc0bd948:\n"
#ifdef CAPTSEQ_DEBUG_LOG
// debug message
"ldr     r0, [sp]\n"
"ldr     r0, [r0]\n"
"bl log_capt_seq\n"
#endif
"       ldr     r0, [sp]\n"
"       ldr     r1, [r0]\n"
"       cmp     r1, #0x2f\n"
"       bcs     loc_fc0bda30\n"
"       tbb.w   [pc,r1]\n"
"branchtable_fc0bd950:\n" 
".byte((loc_fc0bd984 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd99a - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9a2 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9b0 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9aa - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9ba - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9c0 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda0c - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9d0 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9d8 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9de - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9f4 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bd9fa - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda00 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda06 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda14 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda1a - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda20 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda26 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda2c - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda32 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda38 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda3e - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda44 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda4a - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda50 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda58 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda5e - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda62 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda6a - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda70 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bda9a - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdaa0 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdaa6 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdaac - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdab2 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdab8 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdac0 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdac6 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdaea - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdaf0 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdb28 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdafc - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdb02 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdb08 - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdb0e - branchtable_fc0bd950) / 2)\n"
".byte((loc_fc0bdb14 - branchtable_fc0bd950) / 2)\n"
".align 1\n"
"loc_fc0bd984:\n" // case 0: preshoot, quick press shoot
"       ldr     r0, [r0,#0xc]\n"
"       bl      sub_fc0d47f2\n"
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_capt_seq_override\n"
#endif
"bl shooting_expo_param_override\n" // +
"       bl      sub_fc0d36ac\n"
"       ldr     r0, [r4,#0x28]\n"
"       cmp     r0, #0\n"
"       beq     loc_fc0bd998\n"
"       bl      sub_fc0daf9e_my\n" // -> nr?, remote hook, raw hook (quick, no half press)
"loc_fc0bd998:\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd99a:\n" // case 1: (normal shoot)
"       ldr     r0, [r0,#0x10]\n"
"       bl      sub_fc0dae40_my\n" // ->  nr?, remote hook, raw hook
"       b       loc_fc0bdb28\n"
"loc_fc0bd9a2:\n"
"       movs    r0, #1\n"
"       bl      sub_fc0d4adc\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd9aa:\n"
"       bl      sub_fc0d4534\n"
"       b       loc_fc0bd9b6\n"
"loc_fc0bd9b0:\n"
"       ldr     r0, [r0,#0xc]\n"
"       bl      sub_fc0d47da\n"
"loc_fc0bd9b6:\n"
"       str     r6, [r4,#0x28]\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd9ba:\n"
"       bl      sub_fc0d47e0\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd9c0:\n"
"       bl      sub_fc0d4a7c\n"
"       bl      sub_fc0d36ac\n"
"       movs    r0, #0\n"
"       bl      sub_fc0a9748\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd9d0:\n"
"       ldr     r0, [r4,#0x54]\n"
"       bl      sub_fc0f8f44\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd9d8:\n"
"       bl      sub_fc0f91d0\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd9de:\n"
"       ldr     r0, [r0,#0xc]\n"
"       bl      sub_fc0f921c\n"
"       b       loc_fc0bdb28\n"
".ltorg\n"
//"       .byte    0\n"
//"       .byte    0\n"
//" off_fc0bd9e8 dcd dword_5A124\n"
//" off_fc0bd9ec dcd word_59F20\n"
//" off_fc0bd9f0 dcd 0xB378\n"
"loc_fc0bd9f4:\n"
"       bl      sub_fc0f93ee\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bd9fa:\n"
"       bl      sub_fc0f9438\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda00:\n"
"       bl      sub_fc0f97ee\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda06:\n"
"       bl      sub_fc0f9884\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda0c:\n"
"       ldr     r0, [r0,#0xc]\n"
"       bl      sub_fc0d47da\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda14:\n"
"       bl      sub_fc0da684\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda1a:\n"
"       bl      sub_fc0da886\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda20:\n"
"       bl      sub_fc0da930\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda26:\n"
"       bl      sub_fc0da9e8\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda2c:\n"
"       movs    r0, #0\n"
"       b       loc_fc0bda52\n"
"loc_fc0bda30:\n"
"       b       loc_fc0bdb1a\n"
"loc_fc0bda32:\n"
"       bl      sub_fc0dab8c\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda38:\n"
"       bl      sub_fc0dabec\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda3e:\n"
"       bl      sub_fc0dabf0\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda44:\n"
"       bl      sub_fc0dac00\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda4a:\n"
"       bl      sub_fc0dac8c\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda50:\n"
"       movs    r0, #1\n"
"loc_fc0bda52:\n"
"       bl      sub_fc0daa6c\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda58:\n"
"       bl      sub_fc0d4bd4\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda5e:\n"
"       movs    r0, #0\n"
"       b       loc_fc0bda64\n"
"loc_fc0bda62:\n"
"       ldr     r0, [r0,#0xc]\n"
"loc_fc0bda64:\n"
"       bl      sub_fc0d4c08\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda6a:\n"
"       bl      sub_FC110720\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda70:\n"
"       ldr     r1, =0x00059F82\n"
"       movs    r2, #2\n"
"       movs    r0, #0x75\n"
"       bl      sub_FC373808\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc0bda8c\n"
"       movw    r2, #0x51a\n"
"       ldr     r1, =0xfc0bd504\n"
"       movs    r0, #0\n"
"       blx     sub_FC302434\n"
"loc_fc0bda8c:\n"
"       ldrh.w  r0, [r4,#0x62]\n"
"       cmp     r0, #1\n"
"       bne     loc_fc0bdb28\n"
"       bl      sub_FC11071A\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bda9a:\n"
"       bl      sub_FC1107A4\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdaa0:\n"
"       bl      sub_FC1108C0\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdaa6:\n"
"       bl      sub_fc0d3eb8\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdaac:\n"
"       bl      sub_fc0d4f4a\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdab2:\n"
"       bl      sub_fc0d5004\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdab8:\n"
"       ldr     r0, [r0,#0xc]\n"
"       bl      sub_fc0dad6c\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdac0:\n"
"       bl      sub_fc0dadbe\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdac6:\n"
"       bl      sub_fc0d58f8\n"
"       bl      sub_fc0d66b2\n"
"       ldrh.w  r0, [r4,#0x1a4]\n"
"       cmp     r0, #4\n"
"       beq     loc_fc0bdae0\n"
"       ldrh    r0, [r4]\n"
"       sub.w   r1, r0, #0x8200\n"
"       subs    r1, #0x36\n"
"       bne     loc_fc0bdb28\n"
"loc_fc0bdae0:\n"
"       bl      sub_fc0d5004\n"
"       bl      sub_fc0d5336\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdaea:\n"
"       movs    r2, #0\n"
"       movs    r1, #0x11\n"
"       b       loc_fc0bdaf4\n"
"loc_fc0bdaf0:\n"
"       movs    r2, #0\n"
"       movs    r1, #0x10\n"
"loc_fc0bdaf4:\n"
"       movs    r0, #0\n"
"       bl      sub_fc0d4046\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdafc:\n"
"       bl      sub_FC11100C\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdb02:\n"
"       bl      sub_FC111088\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdb08:\n"
"       bl      sub_FC1110C8\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdb0e:\n"
"       bl      sub_FC110F50\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdb14:\n"
"       bl      sub_FC110F52\n"
"       b       loc_fc0bdb28\n"
"loc_fc0bdb1a:\n"
"       movw    r2, #0x588\n"
"       ldr 	r1, =0xfc0bd504\n" //  *"SsShootTask.c"
"       movs    r0, #0\n"
"       blx     sub_FC302434\n" // j_DebugAssert
"loc_fc0bdb28:\n"
#ifdef CAPTSEQ_DEBUG_LOG
// debug after message handled
"ldr     r0, [sp]\n"
"ldr     r0, [r0]\n"
"bl log_capt_seq2\n"
#endif
"       ldr     r0, [sp]\n"
"       ldr     r1, [r0,#4]\n"
"       ldr     r0, [r5,#4]\n"
"       blx     sub_FC302324\n" // j_SetEventFlag
"       ldr     r7, [sp]\n"
"       ldr     r0, [r7,#8]\n"
"       cbnz    r0, loc_fc0bdb46\n"
"       movw    r2, #0x12b\n"
"       ldr   	r1, =0xfc0bd504\n" //  *"SsShootTask.c"
"       movs    r0, #0\n"
"       blx     sub_FC302434\n" // j_DebugAssert
"loc_fc0bdb46:\n"
"       str     r6, [r7,#8]\n"
"       b       loc_fc0bd90e\n"
".ltorg\n"
    );
}

// -s=0xfc0daf9e -c=56 -f=chdk
void __attribute__((naked,noinline)) sub_fc0daf9e_my() {
    asm volatile (
"        push    {r4,lr}\n"
"        bl      sub_fc0f8b2c\n"
"        mov     r4, r0\n"
"        bl      sub_fc0d47e6\n"
"        bl      sub_fc143c90\n"
"        mov     r1, r4\n"
"        bl      sub_fc143cde\n"
"        movs    r2, #4\n"
"        movw    r0, #0x116\n"
"        add.w   r1, r4, #0x34\n"
"        bl      sub_fc3736b6\n"
"        movs    r2, #4\n"
"        movs    r0, #0x30\n"
"        add.w   r1, r4, #0x38\n"
"        bl      sub_fc3736b6\n"
"        movs    r2, #4\n"
"        movs    r0, #0x44\n"
"        add.w   r1, r4, #8\n"
"        bl      sub_fc3736b6\n"
"        bl      sub_fc18afd2\n"
"        mov     r1, #0xffffefff\n"
"        blx     sub_fc3023d4\n"
"        mov     r0, r4\n"
"        bl      sub_fc18aca4\n"
"        bl      sub_fc256c72\n"
"        bl      sub_fc0ab14a\n"
"        mov     r0, r4\n"
"       bl      sub_fc11d806_my\n"		//->
"        lsls    r0, r0, #0x1f\n"
"        beq     locret_fc0db004\n"
"        ldr     r1, =0x132fc\n"
"        movs    r0, #1\n"
"        str     r0, [r1]\n"
"  locret_fc0db004:\n"
"        pop     {r4,pc}\n"
".ltorg\n"
    );
}

//-s=0xfc0dae40 -c=211 -f=chdk
void __attribute__((naked,noinline)) sub_fc0dae40_my() {
    asm volatile (
"       push    {r3-r7,lr}\n"
"       ldr     r6, =0x59f20\n"
"       mov     r5, r0\n"
"       movs    r4, #0\n"
"       ldr     r0, [r6,#0x28]\n"
"       cbz     r0, loc_fc0dae68\n"
"       ldr     r0, =0x132fc\n"
"       ldr     r0, [r0]\n"
"       cbz     r0, loc_fc0dae54\n"
"       movs    r4, #0x1d\n"
" loc_fc0dae54:\n"
"       mov     r2, r5\n"
"       movs    r1, #2\n"
"       mov     r0, r4\n"
"       bl      sub_fc0d4046\n"
"       mov     r1, r4\n"
"       mov     r0, r5\n"
"       bl      sub_fc18b31e\n"
"       b       loc_fc0daf94\n"
" loc_fc0dae68:\n"
"       bl      sub_fc143c90\n"
"       mov     r1, r5\n"
"       bl      sub_fc143cde\n"
"       movs    r2, #4\n"
"       movw    r0, #0x116\n"
"       add.w   r1, r5, #0x34\n"
"       bl      sub_fc3736b6\n"
"       movs    r2, #4\n"
"       movs    r0, #0x30\n"
"       add.w   r1, r5, #0x38\n"
"       bl      sub_fc3736b6\n"
"       ldr.w   r0, [r6,#0x10c]\n"
"       cbnz    r0, loc_fc0daea2\n"
"       ldrh.w  r0, [r6,#0x1a2]\n"
"       cmp     r0, #3\n"
"       beq     loc_fc0daea8\n"
"       ldr     r0, [r5,#8]\n"
"       cmp     r0, #1\n"
"       bhi     loc_fc0daeb8\n"
"       b       loc_fc0daea8\n"
" loc_fc0daea2:\n"
"       ldr     r0, [r5,#0xc]\n"
"       cmp     r0, #1\n"
"       bne     loc_fc0daeb8\n"
" loc_fc0daea8:\n"
"       movs    r0, #0xc\n"
"       bl      sub_fc325c74\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc0daeb8\n"
"       bl      sub_fc0d3eae\n"
"       movs    r4, #1\n"
" loc_fc0daeb8:\n"
"       lsls    r0, r4, #0x1f\n"
"       bne     loc_fc0daf82\n"
"       ldr.w   r0, [r6,#0xec]\n"
"       cbz     r0, loc_fc0daedc\n"
"       ldrh.w  r0, [r6,#0x1a2]\n"
"       cmp     r0, #3\n"
"       beq     loc_fc0daed0\n"
"       ldr     r0, [r5,#8]\n"
"       cmp     r0, #1\n"
"       bhi     loc_fc0daf22\n"
" loc_fc0daed0:\n"
"       ldr.w   r0, [r6,#0x10c]\n"
"       cbz     r0, loc_fc0daedc\n"
"       ldr     r0, [r5,#0xc]\n"
"       cmp     r0, #1\n"
"       bhi     loc_fc0daf22\n"
" loc_fc0daedc:\n"
"       bl      sub_fc11116c\n"
"       cbnz    r0, loc_fc0daf22\n"
"       movs    r2, #2\n"
"       mov     r1, sp\n"
"       movw    r0, #0x110\n"
"       bl      sub_fc373808\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc0daefc\n"
"       movs    r2, #0xcb\n"
"       movs    r0, #0\n"
"       ldr     r1, =0xfc0db020\n"
"       blx     sub_fc302434\n"
" loc_fc0daefc:\n"
"       ldrsh.w r0, [sp]\n"
"       bl      sub_fc130d58\n"
"       bl      sub_fc130c20\n"
"       cmp     r0, #1\n"
"       bls     loc_fc0daf14\n"
"       movs    r0, #0\n"
"       bl      sub_fc130ce8\n"
"       b       loc_fc0daf22\n"
" loc_fc0daf14:\n"
"       bl      sub_fc0d3eae\n"
"       bl      sub_fc325cb4\n"
"       movs    r4, #1\n"
"       lsls    r0, r4, #0x1f\n"
"       bne     loc_fc0daf82\n"
" loc_fc0daf22:\n"
"       mov     r0, r5\n"
"       bl      sub_fc110926\n"
"       mov     r4, r0\n"
"       lsls    r0, r0, #0x1f\n"
"       bne     loc_fc0daf82\n"
"       bl      sub_fc18afd2\n"
"       mov     r1, #0xffffefff\n"
"       blx     sub_fc3023d4\n"
"       bl      sub_fc256c72\n"
"       bl      sub_fc0ab14a\n"
"       mov     r0, r5\n"
"       bl      sub_fc11d538\n"
"       mov     r4, r0\n"
"       lsls    r0, r0, #0x1f\n"
"       bne     loc_fc0daf82\n"
"       bl      sub_fc0d47e6\n"
"       mov     r0, r5\n"
"       bl      sub_fc18aca4\n"
"       movs    r0, #2\n"
"       bl      sub_fc0d61ba\n"
"       ldr.w   r0, [r6,#0xb0]\n"
"       cbz     r0, loc_fc0daf6c\n"
"       mov     r0, r5\n"
"       bl      sub_fc11dde8\n"
"       b       loc_fc0daf94\n"
" loc_fc0daf6c:\n"
"       ldr.w   r0, [r6,#0xb4]\n"
"       cmp     r0, #0\n"
"       mov     r0, r5\n"
"       beq     loc_fc0daf7c\n"
"       bl      sub_fc11da66\n"
"       b       loc_fc0daf94\n"
" loc_fc0daf7c:\n"
"       bl      sub_fc11d806_my\n"  // SsStandardCaptureSeq.c hook
"       b       loc_fc0daf94\n"
" loc_fc0daf82:\n"
"       movs    r1, #2\n"
"       mov     r2, r5\n"
"       mov     r0, r4\n"
"       bl      sub_fc0d4046\n"
"       mov     r1, r4\n"
"       mov     r0, r5\n"
"       bl      sub_fc18b454\n"
" loc_fc0daf94:\n"
"       bl      sub_fc0f942a\n"
"       movs    r0, #0\n"
"       str     r0, [r6,#0x28]\n"
"       pop     {r3-r7,pc}\n"
".ltorg\n"
    );
}

// -s=0xfc11d806 -f=chdk
void __attribute__((naked,noinline)) sub_fc11d806_my() {
    asm volatile (
"       push.w  {r2-r10,lr}\n"
"       ldr     r6, =0xfc11d7e1\n"
"       mov     r5, r0\n"
"       bl      sub_fc18ac3a\n"
"       bl      sub_fc0db464\n"
"       ldr     r7, =0x59f20\n"
"       ldr.w   r0, [r7,#0xa4]\n"
"       cbnz    r0, loc_fc11d834\n"
"       ldrh.w  r0, [r7,#0x1a2]\n"
"       cmp     r0, #3\n"
"       beq     loc_fc11d82c\n"
"       ldr     r0, [r5,#8]\n"
"       cmp     r0, #1\n"
"       bhi     loc_fc11d834\n"
" loc_fc11d82c:\n"
"       bl      sub_fc0d4bf6\n"
"       bl      sub_fc0db046\n"
" loc_fc11d834:\n"
"       movs    r2, #4\n"
"       movw    r0, #0x137\n"
"       add     r1, sp, #4\n"
"       bl      sub_fc373808\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc11d850\n"
"       movs    r0, #0\n"
"       movw    r2, #0x156\n"
"       ldr     r1, =0xfc11da10\n"
"       blx     sub_fc302434\n"
" loc_fc11d850:\n"
"    BL      wait_until_remote_button_is_released\n" // + remote hook
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_remote_hook\n"
#endif
"       ldr     r0, [sp,#4]\n"
"       ubfx.w  r0, r0, #8, #8\n"
"       cmp     r0, #6\n"
"       bne     loc_fc11d860\n"
"       ldr     r0, =0xfc11d7e1\n"
"       movs    r1, #0\n"
"       b       loc_fc11d864\n"
" loc_fc11d860:\n"
"       ldr     r0, =0xfc18a9f5\n"
"       mov     r1, r5\n"
" loc_fc11d864:\n"
"       bl      sub_fc15535c\n"
"       ldr.w   r0, [r7,#0x18c]\n"
"       cbz     r0, loc_fc11d872\n"
"       bl      sub_fc18ab50\n"
" loc_fc11d872:\n"
"       movs    r0, #0\n"
"       bl      sub_fc0be0b0\n"
"       bl      sub_fc11121a\n"
"       ldr.w   r8, =0xfc11d7e1\n"
"       mov     r4, r0\n"
"       lsls    r0, r0, #0x1f\n"
"       bne     loc_fc11d984\n"
"bl capt_seq_hook_set_nr\n"
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_nr_call\n"
#endif
"       mov     r0, r5\n"
"       bl      sub_fc18ada2\n" // NR evaluation
"       mov     r0, r5\n"
"       bl      sub_fc111124\n"
"       ldr     r1, =0x3eea0\n"
"       movs    r2, #4\n"
"       movs    r0, #0x90\n"
"       bl      sub_fc373808\n" // GetPropertyCase
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc11d8ac\n"
"       movs    r0, #0\n"
"       movw    r2, #0x171\n"
"       ldr     r1, =0xfc11da10\n"
"       blx     sub_fc302434\n"
" loc_fc11d8ac:\n"
"       bl      sub_fc0be1e4\n"
"       bl      sub_fc18ae34\n"
"       movs    r1, #0\n"
"       mov     r0, r5\n"
"       bl      sub_fc11d7e2\n"
"       mov     r6, r0\n"
"       ldr     r0, [sp,#4]\n"
"       ubfx.w  r0, r0, #8, #8\n"
"       cmp     r0, #6\n"
"       bne     loc_fc11d8cc\n"
"       ldr     r2, =0xfc18ab1f\n"
"       b       loc_fc11d8ce\n"
" loc_fc11d8cc:\n"
"       ldr     r2, =0xfc18ab35\n"
" loc_fc11d8ce:\n"
"       ldrh    r0, [r5,#0x18]\n"
"       ldr     r4, =0x3eea0\n"
"       cbz     r0, loc_fc11d8dc\n"
"       cmp     r0, #1\n"
"       beq     loc_fc11d8f2\n"
"       cmp     r0, #4\n"
"       bne     loc_fc11d942\n"
" loc_fc11d8dc:\n"
"       str     r6, [sp]\n"
"       mov     r3, r2\n"
"       ldr     r1, [r5,#0x38]\n"
"       mov     r0, r5\n"
"       ldr     r2, [r4]\n"
"       bl      sub_fc18a848\n"
"       mov     r4, r0\n"
"       bl      sub_fc2b7392\n"
"       b       loc_fc11d950\n"
" loc_fc11d8f2:\n"
"       str     r6, [sp]\n"
"       mov     r3, r2\n"
"       ldr     r1, [r5,#0x38]\n"
"       mov     r9, r4\n"
"       ldr     r2, [r4]\n"
"       mov     r0, r5\n"
"       bl      sub_fc18a8a8\n"
"       movs    r2, #1\n"
"       mov     r4, r0\n"
"       movs    r1, #0\n"
"       movs    r0, #0x45\n"
"       bl      sub_fc0ab2ec\n"
"       lsls    r0, r4, #0x1f\n"
"       bne     loc_fc11d950\n"
"       ldr     r0, =0xfc11d7e1\n"
"       movs    r1, #0\n"
"       bl      sub_fc15535c\n"
"       movs    r1, #1\n"
"       mov     r0, r5\n"
"       bl      sub_fc11d7e2\n"
"       mov     r6, r0\n"
"       ldr.w   r0, [r9]\n"
"       mov     r4, r9\n"
"       bl      sub_fc18abb8\n"
"       ldr     r1, [r5,#0x38]\n"
"       mov     r3, r6\n"
"       ldr     r2, [r4]\n"
"       mov     r0, r5\n"
"       bl      sub_fc18a916\n"
"       mov     r4, r0\n"
"       bl      sub_fc18a7f2\n"
"       b       loc_fc11d950\n"
" loc_fc11d942:\n"
"       movs    r0, #0\n"
"       movw    r2, #0x1aa\n"
"       ldr     r1, =0xfc11da10\n"
"       blx     sub_fc302434\n"
"       movs    r4, #0x1d\n"
" loc_fc11d950:\n"
"       bl      sub_fc18ae38\n"
"       lsls    r0, r4, #0x1f\n"
"       bne     loc_fc11d9ba\n"
"       mov     r0, r5\n"
"       bl      sub_fc18ae4e\n"
"       ldr.w   r0, [r7,#0x108]\n"
"       cbnz    r0, loc_fc11d982\n"
"       mov     r0, r5\n"
"       bl      sub_fc111166\n"
"       cbnz    r0, loc_fc11d982\n"
"       mov     r0, r5\n"
"       bl      sub_fc18b592\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc11d982\n"
"       movs    r0, #0\n"
"       movw    r2, #0x1d0\n"
"       ldr     r1, =0xfc11da10\n"
"       blx     sub_fc302434\n"
" loc_fc11d982:\n"
"       b       loc_fc11d986\n"
" loc_fc11d984:\n"
"       b       loc_fc11d9ba\n"
" loc_fc11d986:\n"
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_rh\n"
#endif
"BL capt_seq_hook_raw_here\n" //----------------------------------- ???? ----------
"       mov     r0, r5\n"
"       bl      sub_fc18ae24\n"
"       mov     r0, r5\n"
"       bl      sub_fc18adf8\n"
"       cmp     r6, r8\n"
"       beq     loc_fc11d9ba\n"
"       bl      sub_fc18afd2\n"
"       movs    r1, #4\n"
"       movw    r9, #0x1dd\n"
"       ldr     r3, =0xfc11da10\n"
"       movw    r2, #0x3a98\n"
"       str.w   r9, [sp]\n"
"       bl      sub_fc325e2c\n"
"       cbz     r0, loc_fc11d9ba\n"
"       movs    r0, #0\n"
"       mov     r2, r9\n"
"       ldr     r1, =0xfc11da10\n"
"       blx     sub_fc302434\n"
" loc_fc11d9ba:\n"
"       ldr.w   r0, [r7,#0x18c]\n"
"       cbz     r0, loc_fc11d9ca\n"
"       movs    r2, #1\n"
"       movs    r1, #0\n"
"       movs    r0, #0x46\n"
"       bl      sub_fc0ab2ec\n"
" loc_fc11d9ca:\n"
"       movs    r1, #2\n"
"       mov     r2, r5\n"
"       mov     r0, r4\n"
"       bl      sub_fc0d4046\n"
"       ldr     r0, [r7,#0x28]\n"
"       cmp     r0, #0\n"
"       mov     r0, r8\n"
"       beq     loc_fc11d9f0\n"
"       cmp     r6, r0\n"
"       beq     loc_fc11d9e4\n"
"       movs    r1, #1\n"
"       b       loc_fc11d9e6\n"
" loc_fc11d9e4:\n"
"       movs    r1, #0\n"
" loc_fc11d9e6:\n"
"       mov     r2, r4\n"
"       mov     r0, r5\n"
"       bl      sub_fc18b2dc\n"
"       b       loc_fc11da02\n"
" loc_fc11d9f0:\n"
"       cmp     r6, r0\n"
"       beq     loc_fc11d9f8\n"
"       movs    r1, #1\n"
"       b       loc_fc11d9fa\n"
" loc_fc11d9f8:\n"
"       movs    r1, #0\n"
" loc_fc11d9fa:\n"
"       mov     r2, r4\n"
"       mov     r0, r5\n"
"       bl      sub_fc18b296\n"
" loc_fc11da02:\n"
"       mov     r0, r4\n"
"       pop.w   {r2-r10,pc}\n"
".ltorg\n"
    );
}	

#ifdef CAPTSEQ_DEBUG_LOG
void log_nr_call(void) {
    _LogCameraEvent(0x60,"nr hook %d",_nrflag);
}
void log_remote_hook(void) {
    _LogCameraEvent(0x60,"remote hook");
}
void log_rh(void) {
    _LogCameraEvent(0x60,"raw hook");
}
#endif
//exp_drv_task  -s=task_ExpDrv -c=428 -f=chdk

void __attribute__((naked,noinline)) exp_drv_task() {
    asm volatile (
// task_ExpDrv 0xFC2BC840
"       push.w  {r4-r11,lr}\n"
"       sub     sp, sp, #0x2c\n"
"       ldr.w   r9, =0xd2f8\n"
"       ldr.w   r11, =0xfffff400\n"
"       movs    r0, #0\n"
"       ldr     r6, =0x66bd0\n"
"       add.w   r8, sp, #0x1c\n"
"       movw    r10, #0xbb8\n"
"       str     r0, [sp,#0xc]\n"
" loc_fc2bc85c:\n"
"       ldr.w   r0, [r9,#0x24]\n"
"       movs    r2, #0\n"
"       add     r1, sp, #0x28\n"
"       mov     r4, r9\n"
"       blx     sub_fc3022d4\n"
"       ldr     r0, [sp,#0xc]\n"
"       cmp     r0, #1\n"
"       bne     loc_fc2bc898\n"
"       ldr     r0, [sp,#0x28]\n"
"       ldr     r0, [r0]\n"
"       cmp     r0, #0x15\n"
" loc_fc2bc876:\n"
"       beq     loc_fc2bc954\n"
"       cmp     r0, #0x16\n"
"       beq     loc_fc2bc876\n"
"       cmp     r0, #0x17\n"
"       beq     loc_fc2bc876\n"
"       cmp     r0, #0x18\n"
"       beq     loc_fc2bc876\n"
"       cmp     r0, #0x19\n"
"       beq     loc_fc2bc876\n"
"       cmp     r0, #0x1a\n"
"       beq     loc_fc2bc876\n"
"       cmp     r0, #0x31\n"
"       beq     loc_fc2bc95a\n"
"       movs    r0, #0\n"
"       add     r1, sp, #0xc\n"
"       bl      sub_fc2bc57e\n"
" loc_fc2bc898:\n"
"       ldr     r0, [sp,#0x28]\n"
"       ldr     r1, [r0]\n"
"       cmp     r1, #0x39\n"
"       bne     loc_fc2bc8b6\n"
"       bl      sub_fc2bd8e0\n"
"       ldr.w   r0, [r9,#0x20]\n"
"       movs    r1, #1\n"
"       blx     sub_fc302324\n"
"       blx     sub_fc3022ec\n"
"       add     sp, sp, #0x2c\n"
"       b       locret_fc2bc2d0\n"
" loc_fc2bc8b6:\n"
"       cmp     r1, #0x38\n"
"       bne     loc_fc2bc8c8\n"
" loc_fc2bc8ba:\n"
"       add.w   r0, r0, #0xac\n"
"       ldrd.w  r2, r1, [r0]\n"
"       mov     r0, r1\n"
"       blx     r2\n"
"       b       loc_fc2bcd3e\n"
" loc_fc2bc8c8:\n"
"       cmp     r1, #0x2f\n"
"       bne     loc_fc2bc8fe\n"
"       ldr     r0, [r4,#0x20]\n"
"       movs    r1, #0x80\n"
"       blx     sub_fc3023d4\n"
"       ldr     r0, =0xfc2b87f7\n"
"       movs    r1, #0x80\n"
"       bl      sub_fc318c46\n"
"       ldr     r0, [r4,#0x20]\n"
"       movs    r1, #0x80\n"
"       mov     r2, r10\n"
"       blx     sub_fc3022a4\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc2bc8f0\n"
"       movw    r2, #0x198a\n"
"       b       loc_fc2bc9c0\n"
" loc_fc2bc8f0:\n"
"       ldr     r1, [sp,#0x28]\n"
"       add.w   r1, r1, #0xac\n"
"       ldrd.w  r1, r0, [r1]\n"
"       blx     r1\n"
"       b       loc_fc2bcd3e\n"
" loc_fc2bc8fe:\n"
"       cmp     r1, #0x30\n"
"       bne     loc_fc2bc956\n"
"       add     r1, sp, #0xc\n"
"       bl      sub_fc2bc57e\n"
"       movw    r5, #0x100\n"
"       ldr     r0, [r4,#0x20]\n"
"       mov     r1, r5\n"
"       blx     sub_fc3023d4\n"
"       ldr     r0, =0xfc2b8801\n"
"       mov     r1, r5\n"
"       bl      sub_fc318df0\n"
"       ldr     r0, [r4,#0x20]\n"
"       mov     r2, r10\n"
"       mov     r1, r5\n"
"       blx     sub_fc3022a4\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc2bc8f0\n"
"       movw    r2, #0x1994\n"
"       b       loc_fc2bc9c0\n"
// " dword_fc2bc930 dcd 0xd2f8\n"
// " dword_fc2bc934 dcd 0xfc2b8bdc\n"
// " dword_fc2bc938 dcd 0xfc2b880b\n"
// " off_fc2bc93c dcd word_66bd0\n"
// " dword_fc2bc940 dcd 0xfc2b8815\n"
// " dword_fc2bc944 dcd 0xfffff400\n"
// " dword_fc2bc948 dcd 0xfc2b87ed\n"
// " dword_fc2bc94c dcd 0xfc2b87f7\n"
// " dword_fc2bc950 dcd 0xfc2b8801\n"
" loc_fc2bc954:\n"
"       b       loc_fc2bc9ca\n"
" loc_fc2bc956:\n"
"       cmp     r1, #0x31\n"
"       bne     loc_fc2bc964\n"
" loc_fc2bc95a:\n"
"       ldr     r0, [sp,#0x28]\n"
"       add     r1, sp, #0xc\n"
"       bl      sub_fc2bc57e\n"
"       b       loc_fc2bc8f0\n"
" loc_fc2bc964:\n"
"       cmp     r1, #0x32\n"
"       bne     loc_fc2bc97e\n"
"       bl      sub_fc2bc5c2\n"
"       ldr     r1, [sp,#0x28]\n"
"       add.w   r1, r1, #0xac\n"
"       ldrd.w  r1, r0, [r1]\n"
"       blx     r1\n"
"       bl      sub_fc20cfce\n"
"       b       loc_fc2bcd3e\n"
" loc_fc2bc97e:\n"
"       cmp     r1, #0x33\n"
"       beq     loc_fc2bc8ba\n"
"       cmp     r1, #0x36\n"
"       bne     loc_fc2bc994\n"
"       bl      sub_fc36070c\n"
"       bl      sub_fc20d2d8\n"
"       bl      sub_fc20cfce\n"
"       b       loc_fc2bc8f0\n"
" loc_fc2bc994:\n"
"       cmp     r1, #0x37\n"
"       bne     loc_fc2bc9ca\n"
"       ldr     r0, [r4,#0x20]\n"
"       movs    r1, #4\n"
"       blx     sub_fc3023d4\n"
"       ldr     r1, =0xfc2b8815\n"
"       movs    r2, #4\n"
"       mov     r0, r11\n"
"       bl      sub_fc2bd932\n"
"       bl      sub_fc360470\n"
"       ldr     r0, [r4,#0x20]\n"
"       movs    r1, #4\n"
"       mov     r2, r10\n"
"       blx     sub_fc302424\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc2bc8f0\n"
"       movw    r2, #0x1a77\n"
" loc_fc2bc9c0:\n"
"       ldr     r1, =0xfc2b8bdc\n"
"       movs    r0, #0\n"
"       blx     sub_fc302434\n"
"       b       loc_fc2bc8f0\n"
" loc_fc2bc9ca:\n"
"       ldr     r0, [sp,#0x28]\n"
"       movs    r5, #1\n"
"       ldr     r1, [r0]\n"
"       cmp     r1, #0x13\n"
"       beq     loc_fc2bc9d8\n"
"       cmp     r1, #0x14\n"
"       bne     loc_fc2bca16\n"
" loc_fc2bc9d8:\n"
"       ldr.w   r1, [r0,#0x94]\n"
"       mov     r4, r8\n"
"       add.w   r1, r1, r1,lsl#1\n"
"       add.w   r1, r0, r1,lsl#2\n"
"       subs    r1, #8\n"
"       ldmia   r1!, {r2,r3,r7}\n"
"       stmia   r4!, {r2,r3,r7}\n"
"       bl      sub_fc2baef6\n"
"       ldr     r0, [sp,#0x28]\n"
"       add.w   r0, r0, #0x94\n"
"       ldrd.w  r3, r2, [r0,#0x18]\n"
"       ldr     r1, [r0]\n"
"       sub.w   r0, r0, #0x90\n"
"       blx     r3\n"
"       ldr     r0, [sp,#0x28]\n"
"       bl      sub_fc2bdb5c\n"
"       ldr     r0, [sp,#0x28]\n"
"       add.w   r0, r0, #0x94\n"
"       ldr     r1, [r0]\n"
"       ldrd.w  r3, r2, [r0,#0x20]\n"
"       b       loc_fc2bcc60\n"
" loc_fc2bca16:\n"
"       cmp     r1, #0x15\n"
"       beq     loc_fc2bca2e\n"
"       cmp     r1, #0x16\n"
"       beq     loc_fc2bca2e\n"
"       cmp     r1, #0x17\n"
"       beq     loc_fc2bca2e\n"
"       cmp     r1, #0x18\n"
"       beq     loc_fc2bca2e\n"
"       cmp     r1, #0x19\n"
"       beq     loc_fc2bca2e\n"
"       cmp     r1, #0x1a\n"
"       bne     loc_fc2bca9a\n"
" loc_fc2bca2e:\n"
"       bl      sub_fc36070c\n"
"       ldr     r0, [sp,#0x28]\n"
"       add     r3, sp, #0xc\n"
"       add     r1, sp, #0x1c\n"
"       mov     r2, sp\n"
"       bl      sub_fc2bb0d4\n"
"       cmp     r0, #1\n"
"       mov     r4, r0\n"
"       beq     loc_fc2bca48\n"
"       cmp     r4, #5\n"
"       bne     loc_fc2bca68\n"
" loc_fc2bca48:\n"
"       ldr     r0, [sp,#0x28]\n"
"       mov     r2, r4\n"
"       add.w   r0, r0, #0x94\n"
"       ldrd.w  r7, r3, [r0,#0x18]\n"
"       ldr     r1, [r0]\n"
"       sub.w   r0, r0, #0x90\n"
"       blx     r7\n"
"       ldr     r2, [sp,#0xc]\n"
"       mov     r1, r4\n"
"       ldr     r0, [sp,#0x28]\n"
"       bl      sub_fc2bc53c\n"
" loc_fc2bca66:\n"
"       b       loc_fc2bcc66\n"
" loc_fc2bca68:\n"
"       cmp     r4, #2\n"
"       beq     loc_fc2bca70\n"
"       cmp     r4, #6\n"
"       bne     loc_fc2bca84\n"
" loc_fc2bca70:\n"
"       ldr     r0, [sp,#0x28]\n"
"       add     r1, sp, #0x1c\n"
"       mov     r2, sp\n"
"       bl      sub_fc2bc2d4\n"
"       ldr     r2, [sp,#0xc]\n"
"       mov     r1, r4\n"
"       ldr     r0, [sp,#0x28]\n"
"       bl      sub_fc2bc53c\n"
" loc_fc2bca84:\n"
"       ldr     r0, [sp,#0x28]\n"
"       mov     r2, r4\n"
"       add.w   r0, r0, #0x94\n"
"       ldrd.w  r7, r3, [r0,#0x18]\n"
"       ldr     r1, [r0]\n"
"       sub.w   r0, r0, #0x90\n"
"       blx     r7\n"
"       b       loc_fc2bcc66\n"
" loc_fc2bca9a:\n"
"       cmp     r1, #0x2b\n"
"       beq     loc_fc2bcaa2\n"
"       cmp     r1, #0x2c\n"
"       bne     loc_fc2bcb10\n"
" loc_fc2bcaa2:\n"
"       ldr.w   r1, [r0,#0x94]\n"
"       mov     r7, r8\n"
"       add.w   r1, r1, r1,lsl#1\n"
"       add.w   r1, r0, r1,lsl#2\n"
"       subs    r1, #8\n"
"       ldmia   r1, {r1-r3}\n"
"       stmia   r7!, {r1-r3}\n"
"       bl      sub_fc2ba29a\n"
"       ldr     r0, [sp,#0x28]\n"
"       add.w   r0, r0, #0x94\n"
"       ldrd.w  r3, r2, [r0,#0x18]\n"
"       ldr     r1, [r0]\n"
"       sub.w   r0, r0, #0x90\n"
"       blx     r3\n"
"       bl      sub_fc36070c\n"
"       bl      sub_fc20d2d8\n"
"       bl      sub_fc20cfce\n"
"       ldr     r0, [r4,#0x20]\n"
"       movs    r1, #2\n"
"       mov     r7, r10\n"
"       mov     r2, r10\n"
"       blx     sub_fc3022a4\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc2bcaf4\n"
"       ldr     r1, =0xfc2b8bdc\n"
"       movs    r0, #0\n"
"       movw    r2, #0xeae\n"
"       blx     sub_fc302434\n"
" loc_fc2bcaf4:\n"
"       ldr     r0, [r4,#0x20]\n"
"       movs    r1, #0x20\n"
"       mov     r2, r7\n"
"       blx     sub_fc3022a4\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     loc_fc2bca66\n"
"       ldr     r1, =0xfc2b8bdc\n"
"       movs    r0, #0\n"
"       movw    r2, #0xeb1\n"
"       blx     sub_fc302434\n"
"       b       loc_fc2bcc66\n"
" loc_fc2bcb10:\n"
"       adds    r1, r0, #4\n"
"       mov     r4, r8\n"
"       ldmia   r1!, {r2,r3,r7}\n"
"       stmia   r4!, {r2,r3,r7}\n"
"       ldr     r1, [r0]\n"
"       cmp     r1, #0x2f\n"
"       bcs     loc_fc2bcb56\n"
"       tbb.w   [pc,r1]\n"
"branchtable_fc2bcb1e:\n"
".byte((loc_fc2bcb52 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb52 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb58 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb5e - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb5e - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb5e - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb52 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb58 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb5e - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb5e - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb70 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb70 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb70 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc44 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc4a - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc4a - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc4a - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc4a - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc50 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc54 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc54 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc54 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc54 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc54 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc54 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc54 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc54 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb64 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb6a - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb6a - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb6a - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb78 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb78 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb78 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb78 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcb7e - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcba8 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcbd2 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcbd6 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcbde - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc08 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc32 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc32 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc54 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc54 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc38 - branchtable_fc2bcb1e) / 2)\n"
".byte((loc_fc2bcc3e - branchtable_fc2bcb1e) / 2)\n"
".align 1\n"
" loc_fc2bcb52:\n"
"       bl      sub_fc2b8d20\n"
" loc_fc2bcb56:\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcb58:\n"
"       bl      sub_fc2b8f98\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcb5e:\n"
"       bl      sub_fc2b91bc\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcb64:\n"
"       bl      sub_fc2b9470\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcb6a:\n"
"       bl      sub_fc2b962c\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcb70:\n"
"       bl      sub_fc2b9998_my\n" //		_______-----________
"       movs    r5, #0\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcb78:\n"
"       bl      sub_fc2b9a9c\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcb7e:\n"
"       ldrh    r1, [r0,#4]\n"
"       strh.w  r1, [sp,#0x1c]\n"
"       ldrh    r1, [r6,#2]\n"
"       strh.w  r1, [sp,#0x1e]\n"
"       ldrh    r1, [r6,#4]\n"
"       strh.w  r1, [sp,#0x20]\n"
"       ldrh    r1, [r6,#6]\n"
"       strh.w  r1, [sp,#0x22]\n"
"       ldrh    r1, [r0,#0xc]\n"
"       strh.w  r1, [sp,#0x24]\n"
"       ldrh    r1, [r6,#0xa]\n"
"       strh.w  r1, [sp,#0x26]\n"
"       bl      sub_fc2b9f88\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcba8:\n"
"       ldrh    r1, [r0,#4]\n"
"       strh.w  r1, [sp,#0x1c]\n"
"       ldrh    r1, [r6,#2]\n"
"       strh.w  r1, [sp,#0x1e]\n"
"       ldrh    r1, [r6,#4]\n"
"       strh.w  r1, [sp,#0x20]\n"
"       ldrh    r1, [r6,#6]\n"
"       strh.w  r1, [sp,#0x22]\n"
"       ldrh    r1, [r6,#8]\n"
"       strh.w  r1, [sp,#0x24]\n"
"       ldrh    r1, [r6,#0xa]\n"
"       strh.w  r1, [sp,#0x26]\n"
"       bl      sub_fc2bd9aa\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcbd2:\n"
"       movs    r1, #1\n"
"       b       loc_fc2bcbd8\n"
" loc_fc2bcbd6:\n"
"       movs    r1, #0\n"
" loc_fc2bcbd8:\n"
"       bl      sub_fc2ba04a\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcbde:\n"
"       ldrh    r1, [r6]\n"
"       strh.w  r1, [sp,#0x1c]\n"
"       ldrh    r1, [r0,#6]\n"
"       strh.w  r1, [sp,#0x1e]\n"
"       ldrh    r1, [r6,#4]\n"
"       strh.w  r1, [sp,#0x20]\n"
"       ldrh    r1, [r6,#6]\n"
"       strh.w  r1, [sp,#0x22]\n"
"       ldrh    r1, [r6,#8]\n"
"       strh.w  r1, [sp,#0x24]\n"
"       ldrh    r1, [r6,#0xa]\n"
"       strh.w  r1, [sp,#0x26]\n"
"       bl      sub_fc2bda7a\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcc08:\n"
"       ldrh    r1, [r6]\n"
"       strh.w  r1, [sp,#0x1c]\n"
"       ldrh    r1, [r6,#2]\n"
"       strh.w  r1, [sp,#0x1e]\n"
"       ldrh    r1, [r6,#4]\n"
"       strh.w  r1, [sp,#0x20]\n"
"       ldrh    r1, [r6,#6]\n"
"       strh.w  r1, [sp,#0x22]\n"
"       ldrh    r1, [r0,#0xc]\n"
"       strh.w  r1, [sp,#0x24]\n"
"       ldrh    r1, [r6,#0xa]\n"
"       strh.w  r1, [sp,#0x26]\n"
"       bl      sub_fc2bdaee\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcc32:\n"
"       bl      sub_fc2ba08e\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcc38:\n"
"       bl      sub_fc2ba64c\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcc3e:\n"
"       bl      sub_fc2ba896\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcc44:\n"
"       bl      sub_fc2baab2\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcc4a:\n"
"       bl      sub_fc2bac10\n"
"       b       loc_fc2bcc54\n"
" loc_fc2bcc50:\n"
"       bl      sub_fc2bad34\n"
" loc_fc2bcc54:\n"
"       ldr     r0, [sp,#0x28]\n"
"       add.w   r0, r0, #0x94\n"
"       ldrd.w  r3, r2, [r0,#0x18]\n"
"       ldr     r1, [r0]\n"
" loc_fc2bcc60:\n"
"       sub.w   r0, r0, #0x90\n"
"       blx     r3\n"
" loc_fc2bcc66:\n"
"       ldr     r0, [sp,#0x28]\n"
"       ldr     r0, [r0]\n"
"       cmp     r0, #0x11\n"
"       beq     loc_fc2bcc8a\n"
"       bgt     loc_fc2bcc7e\n"
"       cmp     r0, #1\n"
"       beq     loc_fc2bcc8a\n"
"       cmp     r0, #4\n"
"       beq     loc_fc2bcc8a\n"
"       cmp     r0, #0xf\n"
"       bne     loc_fc2bccbc\n"
"       b       loc_fc2bcc8a\n"
" loc_fc2bcc7e:\n"
"       cmp     r0, #0x14\n"
"       beq     loc_fc2bcc8a\n"
"       cmp     r0, #0x1a\n"
"       beq     loc_fc2bcc8a\n"
"       cmp     r0, #0x1d\n"
"       bne     loc_fc2bccbc\n"
" loc_fc2bcc8a:\n"
"       ldrsh.w r0, [r6]\n"
"       mov     r2, r11\n"
"       cmp     r0, r11\n"
"       beq     loc_fc2bcc9c\n"
"       ldrsh.w r1, [r6,#8]\n"
"       cmp     r1, r2\n"
"       bne     loc_fc2bccb4\n"
" loc_fc2bcc9c:\n"
"       add     r0, sp, #0x10\n"
"       bl      sub_fc36094a\n"
"       ldrh.w  r0, [sp,#0x10]\n"
"       strh.w  r0, [sp,#0x1c]\n"
"       ldrh.w  r0, [sp,#0x18]\n"
"       strh.w  r0, [sp,#0x24]\n"
"       b       loc_fc2bccbc\n"
" loc_fc2bccb4:\n"
"       strh.w  r0, [sp,#0x1c]\n"
"       strh.w  r1, [sp,#0x24]\n"
" loc_fc2bccbc:\n"
"       cmp     r5, #1\n"
"       ldr     r0, [sp,#0x28]\n"
"       bne     loc_fc2bccf4\n"
"       movs    r2, #0xc\n"
"       ldr.w   r1, [r0,#0x94]\n"
"       add.w   r1, r1, r1,lsl#1\n"
"       add.w   r4, r0, r1,lsl#2\n"
"       ldr     r0, =0x66bd0\n"
"       subs    r4, #8\n"
"       add     r1, sp, #0x1c\n"
"       blx     sub_fc30242c\n"
"       ldr     r0, =0x66bd0\n"
"       movs    r2, #0xc\n"
"       add     r1, sp, #0x1c\n"
"       adds    r0, #0xc\n"
"       blx     sub_fc30242c\n"
"       ldr     r0, =0x66bd0\n"
"       movs    r2, #0xc\n"
"       mov     r1, r4\n"
"       adds    r0, #0x18\n"
"       blx     sub_fc30242c\n"
"       b       loc_fc2bcd3e\n"
" loc_fc2bccf4:\n"
"       ldr     r0, [r0]\n"
"       mov.w   r3, #1\n"
"       cmp     r0, #0xc\n"
"       bne     loc_fc2bcd1e\n"
"       movs    r2, #0\n"
"       mov     r1, r3\n"
"       strd.w  r2, r3, [sp]\n"
"       movs    r0, #0\n"
"       mov     r2, r3\n"
"       bl      sub_fc2b8b20\n"
"       movs    r3, #1\n"
"       movs    r2, #0\n"
"       mov     r1, r3\n"
"       movs    r0, #0\n"
"       strd.w  r2, r3, [sp]\n"
"       mov     r2, r3\n"
"       b       loc_fc2bcd3a\n"
" loc_fc2bcd1e:\n"
"       movs    r2, #1\n"
"       strd.w  r2, r3, [sp]\n"
"       mov     r3, r2\n"
"       mov     r1, r2\n"
"       mov     r0, r2\n"
"       bl      sub_fc2b8b20\n"
"       movs    r3, #1\n"
"       str     r3, [sp]\n"
"       mov     r2, r3\n"
"       mov     r1, r3\n"
"       mov     r0, r3\n"
"       str     r3, [sp,#4]\n"
" loc_fc2bcd3a:\n"
"       bl      sub_fc2b8c60\n"
" loc_fc2bcd3e:\n"
"       ldr     r0, [sp,#0x28]\n"
"       bl      sub_fc2bd8e0\n"
"       b       loc_fc2bc85c\n"
"locret_fc2bc2d0:\n"
//      POP.W   {R4-R11,PC}
"    pop.w  {r4, r5, r6, r7, r8, r9, r10, r11, pc}\n"
".ltorg\n"
    );
}
//loc_fc2b9a84: -s=0xfc28edd9 -c=  -f=chdk
void __attribute__((naked,noinline)) sub_fc2b9998_my() {
asm volatile (
"       push.w  {r4-r8,lr}\n"
"       ldr     r7, =0xd2f8\n"
"       movs    r1, #0x3e\n"
"       mov     r4, r0\n"
"       ldr     r0, [r7,#0x20]\n"
"       blx     sub_fc3023d4\n"
"       movs    r2, #0\n"
"       ldrsh.w r0, [r4,#4]\n"
"       movs    r3, #1\n"
"       mov     r1, r2\n"
"       bl      sub_fc2b885e\n"
"       mov     r6, r0\n"
"       ldrsh.w r0, [r4,#6]\n"
"       bl      sub_fc2b89e6\n"
"       ldrsh.w r0, [r4,#8]\n"
"       bl      sub_fc2b8a2a\n"
"       ldrsh.w r0, [r4,#0xa]\n"
"       bl      sub_fc2b8a6e\n"
"       ldrsh.w r0, [r4,#0xc]\n"
"       movs    r1, #0\n"
"       bl      sub_fc2b8ab2\n"
"       mov     r5, r0\n"
"       ldr     r0, [r4]\n"
"       ldr.w   r8, =0x66be8\n"
"       cmp     r0, #0xc\n"
"       bne     loc_fc2b99ec\n"
"       movs    r6, #0\n"
"       mov     r5, r6\n"
"       b       loc_fc2b9a04\n"
" loc_fc2b99ec:\n"
"       cmp     r6, #1\n"
"       bne     loc_fc2b9a04\n"
"       ldrsh.w r0, [r4,#4]\n"
"       movs    r2, #2\n"
"       ldr     r1, =0xfc2b87ed\n"
"       bl      sub_fc318c60\n"
"       strh    r0, [r4,#4]\n"
"       movs    r0, #0\n"
"       str     r0, [r7,#0x2c]\n"
"       b       loc_fc2b9a0a\n"
" loc_fc2b9a04:\n"
"       ldrh.w  r0, [r8]\n"
"       strh    r0, [r4,#4]\n"
" loc_fc2b9a0a:\n"
"       cmp     r5, #1\n"
"       bne     loc_fc2b9a1c\n"
"       ldrsh.w r0, [r4,#0xc]\n"
"       movs    r2, #0x20\n"
"       ldr     r1, =0xfc2b8849\n"
"       bl      sub_fc2bd956\n"
"       b       loc_fc2b9a20\n"
" loc_fc2b9a1c:\n"
"       ldrh.w  r0, [r8,#8]\n"
" loc_fc2b9a20:\n"
"       strh    r0, [r4,#0xc]\n"
"       ldrsh.w r0, [r4,#6]\n"
"       bl      sub_fc3604ca_my\n" //__________---------------
"		ldr pc,=0xfc2b9a2b\n" //continue in ROM thumb
".ltorg\n"
 );
}
//loc_fc3604ca:
void __attribute__((naked,noinline)) sub_fc3604ca_my() {
asm volatile (
"       push    {r4-r6,lr}\n"
"       ldr     r5, =0xcd28\n"
"       mov     r4, r0\n"
"       ldr     r0, [r5,#4]\n"
"       cmp     r0, #1\n"
"       beq     loc_fc3604e2\n"
"       movs    r0, #0\n"
"       movw    r2, #0x16b\n"
"       ldr     r1, =0xfc360588\n"
"       blx     sub_fc302434\n"
" loc_fc3604e2:\n"
"       ldr     r0, =0xfffff400\n"
"       cmp     r4, r0\n"
"       bne     loc_fc3604ec\n"
"       ldrsh.w r4, [r5,#2]\n"
" loc_fc3604ec:\n"
"       strh    r4, [r5,#2]\n"
"       cmp     r4, r0\n"
"       bne     loc_fc3604fe\n"
"       movs    r0, #0\n"
"       movw    r2, #0x171\n"
"       ldr     r1, =0xfc360588\n"
"       blx     sub_fc302434\n"
" loc_fc3604fe:\n"
"       mov     r0, r4\n"
"    	bl      apex2us\n"
// "       bl      sub_fc3f454e\n"
// "       mov     r4, r0\n"
// "       bl      sub_fc23f4cc\n"
// "       mov     r0, r4\n"
"       bl      sub_fc15fa32\n"
"       lsls    r0, r0, #0x1f\n"
"       beq     locret_fc360524\n"
"       pop.w   {r4-r6,lr}\n"
"       movs    r0, #0\n"
"       movw    r2, #0x176\n"
"       ldr     r1, =0xfc360588\n"
// "       b.w     sub_fc301918\n"
"		ldr pc, =0xfc301919\n" //replace above with thumb
" locret_fc360524:\n"
"       pop     {r4-r6,pc}\n"
".ltorg\n"
 );
}

