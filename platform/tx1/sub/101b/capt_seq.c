/*
 * capt_seq.c - auto-generated by CHDK code_gen.
 */
#include "lolevel.h"
#include "platform.h"
#include "core.h"

static long *nrflag = (long*)0xD1B4;

#include "../../../generic/capt_seq.c"

/*************************************************************/
//** capt_seq_task @ 0xFFB2B784 - 0xFFB2B958, length=118
void __attribute__((naked,noinline)) capt_seq_task() {
asm volatile (
"    STMFD   SP!, {R4,LR} \n"
"    SUB     SP, SP, #4 \n"
"    MOV     R4, SP \n"
"    B       loc_FFB2B924 \n"

"loc_FFB2B794:\n"
"    LDR     R2, [SP] \n"
"    LDR     R3, [R2] \n"
"    MOV     R0, R2 \n"
"    CMP     R3, #0x17 \n"
"    LDRLS   PC, [PC, R3, LSL#2] \n"
"    B       loc_FFB2B8FC \n"
"    .long   loc_FFB2B80C \n"
"    .long   loc_FFB2B82C \n"
"    .long   loc_FFB2B840 \n"
"    .long   loc_FFB2B854 \n"
"    .long   loc_FFB2B84C \n"
"    .long   loc_FFB2B85C \n"
"    .long   loc_FFB2B864 \n"
"    .long   loc_FFB2B870 \n"
"    .long   loc_FFB2B878 \n"
"    .long   loc_FFB2B884 \n"
"    .long   loc_FFB2B88C \n"
"    .long   loc_FFB2B894 \n"
"    .long   loc_FFB2B89C \n"
"    .long   loc_FFB2B8A4 \n"
"    .long   loc_FFB2B8AC \n"
"    .long   loc_FFB2B8B8 \n"
"    .long   loc_FFB2B8C0 \n"
"    .long   loc_FFB2B8C8 \n"
"    .long   loc_FFB2B8D0 \n"
"    .long   loc_FFB2B8DC \n"
"    .long   loc_FFB2B8E4 \n"
"    .long   loc_FFB2B8EC \n"
"    .long   loc_FFB2B8F4 \n"
"    .long   loc_FFB2B90C \n"

"loc_FFB2B80C:\n"
"    BL      sub_FFB2BE40 \n"
"    BL      shooting_expo_param_override\n"   // +
"    BL      sub_FFB28CF8 \n"
"    LDR     R3, =0xB6FE0 \n"
"    MOV     R2, #0\n"                          // added
"    STR     R2, [R3,#0x24]\n"                  // added, fixes overrides behavior at short shutter press
//"  LDR     R2, [R3, #0x24] \n"  // above patch makes these three lines redundant
//"  CMP     R2, #0 \n"
//"  BEQ     loc_FFB2B908 \n"
//"  BL      _sub_FFB2B3BC \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B82C:\n"
"    BL      sub_FFB2B154_my \n"  // --> Patched. Old value = 0xFFB2B154.

"loc_FFB2B830:\n"
"    LDR     R2, =0xB6FE0 \n"
"    MOV     R3, #0 \n"
"    STR     R3, [R2, #0x24] \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B840:\n"
"    MOV     R0, #1 \n"
"    BL      sub_FFB2C060 \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B84C:\n"
"    BL      sub_FFB2BA10 \n"
"    B       loc_FFB2B830 \n"

"loc_FFB2B854:\n"
"    BL      sub_FFB2BDF8 \n"
"    B       loc_FFB2B830 \n"

"loc_FFB2B85C:\n"
"    BL      sub_FFB2BE08 \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B864:\n"
"    BL      sub_FFB2BF58 \n"
"    BL      sub_FFB28CF8 \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B870:\n"
"    BL      sub_FFB2B494 \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B878:\n"
"    BL      sub_FFB2BFC8 \n"
"    BL      sub_FFB28CF8 \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B884:\n"
"    BL      sub_FFB2BDF8 \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B88C:\n"
"    BL      sub_FFB2D91C \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B894:\n"
"    BL      sub_FFB2DAF0 \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B89C:\n"
"    BL      sub_FFB2DB84 \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B8A4:\n"
"    BL      sub_FFB2DC80 \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B8AC:\n"
"    MOV     R0, #0 \n"
"    BL      sub_FFB2DEEC \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B8B8:\n"
"    BL      sub_FFB2E090 \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B8C0:\n"
"    BL      sub_FFB2E12C \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B8C8:\n"
"    BL      sub_FFB2E1EC \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B8D0:\n"
"    BL      sub_FFB2C1E0 \n"
"    BL      sub_FFB2AF14 \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B8DC:\n"
"    BL      sub_FFB2DDC0 \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B8E4:\n"
"    BL      sub_FFB2DE1C \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B8EC:\n"
"    BL      sub_FFB2B034 \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B8F4:\n"
"    BL      sub_FFB253DC \n"
"    B       loc_FFB2B908 \n"

"loc_FFB2B8FC:\n"
"    LDR     R0, =0xFFB2AC58 /*'SsShootTask.c'*/ \n"
"    MOV     R1, #0x4D0 \n"
"    BL      _DebugAssert \n"

"loc_FFB2B908:\n"
"    LDR     R2, [SP] \n"

"loc_FFB2B90C:\n"
"    LDR     R3, =0x920D8 \n"
"    LDR     R1, [R2, #4] \n"
"    LDR     R0, [R3] \n"
"    BL      sub_FFB4022C /*_SetEventFlag*/ \n"
"    LDR     R0, [SP] \n"
"    BL      sub_FFB2AD48 \n"

"loc_FFB2B924:\n"
"    LDR     R3, =0x920DC \n"
"    MOV     R1, R4 \n"
"    LDR     R0, [R3] \n"
"    MOV     R2, #0 \n"
"    BL      sub_FFB40944 /*_ReceiveMessageQueue*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FFB2B794 \n"
"    MOV     R1, #0x400 \n"
"    LDR     R0, =0xFFB2AC58 /*'SsShootTask.c'*/ \n"
"    ADD     R1, R1, #2 \n"
"    BL      _DebugAssert \n"
"    BL      _ExitTask \n"
"    ADD     SP, SP, #4 \n"
"    LDMFD   SP!, {R4,PC} \n"
);
}

/*************************************************************/
//** sub_FFB2B154_my @ 0xFFB2B154 - 0xFFB2B3AC, length=151
void __attribute__((naked,noinline)) sub_FFB2B154_my() {
asm volatile (
"    STMFD   SP!, {R4,R5,LR} \n"
"    LDR     R1, =0xB6FE0 \n"
"    LDR     R4, [R0, #0xC] \n"
"    LDR     R2, [R1, #0x24] \n"
"    LDR     R3, [R4, #8] \n"
"    CMP     R2, #0 \n"
"    ORR     R3, R3, #1 \n"
"    STR     R3, [R4, #8] \n"
"    BNE     loc_FFB2B1B4 \n"
"    LDR     R3, [R1, #0xC] \n"
"    CMP     R3, #0 \n"
"    BNE     loc_FFB2B1B4 \n"
"    MOV     R0, #0xC \n"
"    BL      sub_FFB360D8 \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FFB2B1B4 \n"
"    LDR     R3, [R4, #8] \n"
"    MOV     R0, #1 \n"
"    ORR     R3, R3, #0x40000000 \n"
"    STR     R3, [R4, #8] \n"

"loc_FFB2B1A4:\n"
"    MOV     R2, R4 \n"
"    MOV     R1, #1 \n"
"    LDMFD   SP!, {R4,R5,LR} \n"
"    B       sub_FFB29314 \n"

"loc_FFB2B1B4:\n"
"    LDR     R1, =0xB6FE0 \n"
"    MOV     R3, #0x8200 \n"
"    LDRH    R2, [R1] \n"
"    ADD     R3, R3, #0xA \n"
"    CMP     R2, R3 \n"
"    BEQ     loc_FFB2B200 \n"
"    LDRH    R3, [R1, #0x88] \n"
"    CMP     R3, #3 \n"
"    BEQ     loc_FFB2B200 \n"
"    LDR     R3, [R4, #0xC] \n"
"    CMP     R3, #1 \n"
"    BLS     loc_FFB2B200 \n"
"    LDRH    R3, [R1, #0x86] \n"
"    CMP     R3, #0 \n"
"    BNE     loc_FFB2B200 \n"
"    LDRH    R3, [R1, #0x82] \n"
"    CMP     R3, #2 \n"
"    BNE     loc_FFB2B200 \n"
"    BL      sub_FFB2C2BC \n"

"loc_FFB2B200:\n"
"    LDR     R1, =0xB6FE0 \n"
"    MOV     R3, #0x8200 \n"
"    LDRH    R2, [R1] \n"
"    ADD     R3, R3, #0xA \n"
"    CMP     R2, R3 \n"
"    BEQ     loc_FFB2B248 \n"
"    LDRH    R3, [R1, #0x88] \n"
"    CMP     R3, #3 \n"
"    BEQ     loc_FFB2B248 \n"
"    LDR     R3, [R4, #0xC] \n"
"    CMP     R3, #1 \n"
"    BLS     loc_FFB2B248 \n"
"    LDRH    R3, [R1, #0x86] \n"
"    CMP     R3, #0 \n"
"    BNE     loc_FFB2B248 \n"
"    LDRH    R3, [R1, #0x82] \n"
"    CMP     R3, #2 \n"
"    BEQ     loc_FFB2B2B0 \n"

"loc_FFB2B248:\n"
"    LDR     R2, =0xB6FE0 \n"
"    LDRH    R3, [R2, #0x88] \n"
"    CMP     R3, #3 \n"
"    BEQ     loc_FFB2B2C8 \n"
"    LDRH    R3, [R2, #0x86] \n"
"    CMP     R3, #0 \n"
"    BNE     loc_FFB2B2C8 \n"
"    LDRH    R1, [R2, #0x82] \n"
"    CMP     R1, #1 \n"
"    BNE     loc_FFB2B2C8 \n"
"    LDRH    R2, [R2] \n"
"    MOV     R3, #0x8200 \n"
"    ADD     R3, R3, #0xA \n"
"    CMP     R2, R3 \n"
"    BEQ     loc_FFB2B2C8 \n"
"    LDR     R3, [R4, #0xC] \n"
"    CMP     R3, #1 \n"
"    BLS     loc_FFB2B2C8 \n"
"    ADD     R3, R1, #0xFF00 \n"
"    ADD     R3, R3, #0xFF \n"
"    MOV     R3, R3, LSL#16 \n"
"    CMP     R3, #0x10000 \n"
"    BHI     loc_FFB2B2C8 \n"
"    LDR     R3, [R4, #0x10] \n"
"    CMP     R3, #1 \n"
"    BNE     loc_FFB2B2C8 \n"

"loc_FFB2B2B0:\n"
"    LDR     R3, =0x920D8 \n"
"    MOV     R2, #0xEA00 \n"
"    LDR     R0, [R3] \n"
"    MOV     R1, #0x40000000 \n"
"    ADD     R2, R2, #0x60 \n"
"    BL      sub_FFB3658C \n"

"loc_FFB2B2C8:\n"
"    LDR     R5, =0xB6FE0 \n"
"    BL      sub_FFB2B034 \n"
"    LDR     R3, [R5, #0x24] \n"
"    CMP     R3, #0 \n"
"    BNE     loc_FFB2B2E4 \n"
"    MOV     R0, #2 \n"
"    BL      sub_FFB05878 \n"

"loc_FFB2B2E4:\n"
"    BL      sub_FFB2BE18 \n"
"    LDR     R3, [R4, #0x18] \n"
"    CMP     R3, #0 \n"
"    BEQ     loc_FFB2B2F8 \n"
"    BL      sub_FFBAD14C \n"

"loc_FFB2B2F8:\n"
"    LDR     R3, [R5, #0x24] \n"
"    CMP     R3, #0 \n"
"    BNE     loc_FFB2B338 \n"
"    MOV     R0, R4 \n"
"    BL      sub_FFB2D100 \n"
"    TST     R0, #1 \n"
"    BNE     loc_FFB2B1A4 \n"
"    BL      sub_FF826F90 \n"
"    BL      sub_FF81BF54 \n"
"    STR     R0, [R4, #0x14] \n"
"    MOV     R0, R4 \n"
"    BL      sub_FFB2E664 \n"
"    BL      sub_FFB2F0AC \n"
"    MOV     R0, R4 \n"
"    BL      sub_FFB2E77C_my \n"  // --> Patched. Old value = 0xFFB2E77C.
"    BL      capt_seq_hook_raw_here\n"   // +
"    B       loc_FFB2B34C \n"

"loc_FFB2B338:\n"
"    LDR     R3, =0xD19C \n"
"    LDR     R2, [R3] \n"
"    CMP     R2, #0 \n"
"    MOVNE   R0, #0x1D \n"
"    MOVEQ   R0, #0 \n"

"loc_FFB2B34C:\n"
"    MOV     R1, #1 \n"
"    MOV     R2, R4 \n"
"    BL      sub_FFB29314 \n"
"    BL      sub_FFB2EB4C \n"
"    CMP     R0, #0 \n"
"    LDRNE   R3, [R4, #8] \n"
"    ORRNE   R3, R3, #0x2000 \n"
"    STRNE   R3, [R4, #8] \n"
"    LDR     R3, [R4, #0x18] \n"
"    CMP     R3, #0 \n"
"    BEQ     loc_FFB2B37C \n"
"    BL      sub_FFBAD178 \n"

"loc_FFB2B37C:\n"
"    LDR     R2, =0xB6FE0 \n"
"    LDRH    R3, [R2, #0x88] \n"
"    CMP     R3, #3 \n"
"    LDMEQFD SP!, {R4,R5,PC} \n"
"    LDRH    R3, [R2, #0x86] \n"
"    CMP     R3, #0 \n"
"    LDMNEFD SP!, {R4,R5,PC} \n"
"    LDRH    R3, [R2, #0x82] \n"
"    CMP     R3, #2 \n"
"    LDMNEFD SP!, {R4,R5,PC} \n"
"    MOV     R0, R4 \n"
"    LDMFD   SP!, {R4,R5,LR} \n"
"    B       sub_FFB2C314 \n"
);
}

/*************************************************************/
//** sub_FFB2E77C_my @ 0xFFB2E77C - 0xFFB2E7D4, length=23
void __attribute__((naked,noinline)) sub_FFB2E77C_my() {
asm volatile (
"    STMFD   SP!, {R4,LR} \n"
"    MOV     R4, R0 \n"
"    SUB     SP, SP, #0xC \n"
"    BL      sub_FFB2F240 \n"
"    MVN     R1, #0 \n"
"    BL      sub_FFB403C8 /*_ClearEventFlag*/ \n"
"    MOV     R0, #0x8A \n"
"    ADD     R1, SP, #4 \n"
"    MOV     R2, #4 \n"
"    BL      _GetPropertyCase \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FFB2E7BC \n"
"    MOV     R1, #0x1D0 \n"
"    LDR     R0, =0xFFB2E600 /*'SsCaptureSeq.c'*/ \n"
"    ADD     R1, R1, #2 \n"
"    BL      _DebugAssert \n"

"loc_FFB2E7BC:\n"
"    LDR     R3, =0xB6FE0 \n"
"    LDR     R2, =0xB70A0 \n"
"    LDR     R0, [R3, #0x7C] \n"
"    LDRSH   R1, [R2, #0xE] \n"
"    BL      sub_FFA4D830 \n"
"    MOV     R0, R4 \n"
"    BL      sub_FFB2E584 \n"
"    BL      wait_until_remote_button_is_released\n"
"    BL      capt_seq_hook_set_nr\n"
"    LDR     PC, =0xFFB2E7D8 \n"  // Continue in firmware
);
}

/*************************************************************/
//** exp_drv_task @ 0xFF97CEFC - 0xFF97D444, length=339
void __attribute__((naked,noinline)) exp_drv_task() {
asm volatile (
"    STMFD   SP!, {R4-R8,LR} \n"
"    SUB     SP, SP, #0x20 \n"
"    ADD     R7, SP, #4 \n"
"    B       loc_FF97D400 \n"

"loc_FF97CF0C:\n"
"    CMP     R2, #0x22 \n"
"    BNE     loc_FF97CF24 \n"
"    LDR     R0, [R12, #0x8C] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R12, #0x88] \n"
"    B       loc_FF97CF88 \n"

"loc_FF97CF24:\n"
"    CMP     R2, #0x1D \n"
"    BNE     loc_FF97CF38 \n"
"    MOV     R0, R12 \n"
"    BL      sub_FF97CDCC \n"
"    B       loc_FF97CF78 \n"

"loc_FF97CF38:\n"
"    CMP     R2, #0x1E \n"
"    BNE     loc_FF97CF4C \n"
"    MOV     R0, R12 \n"
"    BL      sub_FF97CE28 \n"
"    B       loc_FF97CF78 \n"

"loc_FF97CF4C:\n"
"    SUB     R3, R2, #0x1F \n"
"    CMP     R3, #1 \n"
"    BHI     loc_FF97CF64 \n"
"    MOV     R0, R12 \n"
"    BL      sub_FF97CE84 \n"
"    B       loc_FF97CF78 \n"

"loc_FF97CF64:\n"
"    CMP     R2, #0x21 \n"
"    BNE     loc_FF97CF94 \n"
"    BL      sub_FF93BB00 \n"
"    BL      sub_FF93EC38 \n"
"    BL      sub_FF93DE70 \n"

"loc_FF97CF78:\n"
"    LDR     R3, [SP, #4] \n"
"    LDR     R0, [R3, #0x8C] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R3, #0x88] \n"

"loc_FF97CF88:\n"
"    LDR     R0, [SP, #4] \n"
"    BL      sub_FF97861C \n"
"    B       loc_FF97D400 \n"

"loc_FF97CF94:\n"
"    CMP     R2, #0xD \n"
"    MOV     R8, #1 \n"
"    BNE     loc_FF97D004 \n"
"    LDR     R1, [R12, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R1, R12, R1, LSL#2 \n"
"    ADD     R6, SP, #0x14 \n"
"    SUB     R1, R1, #8 \n"
"    MOV     R2, #0xC \n"
"    MOV     R0, R6 \n"
"    BL      _memcpy \n"
"    LDR     R0, [SP, #4] \n"
"    BL      sub_FF97B1E4 \n"
"    LDR     R3, [SP, #4] \n"
"    LDR     R1, [R3, #0x7C] \n"
"    LDR     R2, [R3, #0x8C] \n"
"    ADD     R0, R3, #4 \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R3, #0x88] \n"
"    LDR     R0, [SP, #4] \n"
"    BL      sub_FF97B4B4 \n"
"    LDR     R3, [SP, #4] \n"
"    ADD     R0, R3, #4 \n"
"    LDR     R1, [R3, #0x7C] \n"
"    LDR     R2, [R3, #0x94] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R3, #0x90] \n"
"    B       loc_FF97D354 \n"

"loc_FF97D004:\n"
"    SUB     R3, R2, #0xE \n"
"    CMP     R3, #1 \n"
"    BHI     loc_FF97D0C0 \n"
"    ADD     R6, SP, #0x14 \n"
"    ADD     R5, SP, #8 \n"
"    MOV     R0, R12 \n"
"    MOV     R1, R6 \n"
"    MOV     R2, R5 \n"
"    BL      sub_FF97B5A8 \n"
"    MOV     R4, R0 \n"
"    CMP     R4, #5 \n"
"    CMPNE   R4, #1 \n"
"    BNE     loc_FF97D058 \n"
"    LDR     R12, [SP, #4] \n"
"    MOV     R0, R5 \n"
"    LDR     R1, [R12, #0x7C] \n"
"    MOV     R2, R4 \n"
"    LDR     R3, [R12, #0x8C] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R12, #0x88] \n"
"    B       loc_FF97D090 \n"

"loc_FF97D058:\n"
"    CMP     R4, #6 \n"
"    CMPNE   R4, #2 \n"
"    BNE     loc_FF97D0A0 \n"
"    LDR     R12, [SP, #4] \n"
"    MOV     R0, R5 \n"
"    MOV     R1, R8 \n"
"    MOV     R2, R4 \n"
"    LDR     R3, [R12, #0x8C] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R12, #0x88] \n"
"    MOV     R1, R6 \n"
"    LDR     R0, [SP, #4] \n"
"    MOV     R2, R5 \n"
"    BL      sub_FF97CA2C \n"

"loc_FF97D090:\n"
"    MOV     R1, R4 \n"
"    LDR     R0, [SP, #4] \n"
"    BL      sub_FF97CD60 \n"
"    B       loc_FF97D354 \n"

"loc_FF97D0A0:\n"
"    LDR     R12, [SP, #4] \n"
"    MOV     R2, R4 \n"
"    ADD     R0, R12, #4 \n"
"    LDR     R1, [R12, #0x7C] \n"
"    LDR     R3, [R12, #0x8C] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R12, #0x88] \n"
"    B       loc_FF97D354 \n"

"loc_FF97D0C0:\n"
"    SUB     R3, R2, #0x19 \n"
"    CMP     R3, #1 \n"
"    BHI     loc_FF97D118 \n"
"    LDR     R1, [R12, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R1, R12, R1, LSL#2 \n"
"    ADD     R6, SP, #0x14 \n"
"    SUB     R1, R1, #8 \n"
"    MOV     R2, #0xC \n"
"    MOV     R0, R6 \n"
"    BL      _memcpy \n"
"    LDR     R0, [SP, #4] \n"
"    BL      sub_FF97A5D8 \n"
"    LDR     R3, [SP, #4] \n"
"    ADD     R0, R3, #4 \n"
"    LDR     R1, [R3, #0x7C] \n"
"    LDR     R2, [R3, #0x8C] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R3, #0x88] \n"
"    LDR     R0, [SP, #4] \n"
"    BL      sub_FF97A9B4 \n"
"    B       loc_FF97D354 \n"

"loc_FF97D118:\n"
"    ADD     R6, SP, #0x14 \n"
"    ADD     R1, R12, #4 \n"
"    MOV     R2, #0xC \n"
"    MOV     R0, R6 \n"
"    BL      _memcpy \n"
"    LDR     R12, [SP, #4] \n"
"    LDR     R3, [R12] \n"
"    MOV     R2, R12 \n"
"    CMP     R3, #0x1C \n"
"    LDRLS   PC, [PC, R3, LSL#2] \n"
"    B       loc_FF97D340 \n"
"    .long   loc_FF97D1B8 \n"
"    .long   loc_FF97D1C4 \n"
"    .long   loc_FF97D1D0 \n"
"    .long   loc_FF97D1D0 \n"
"    .long   loc_FF97D1B8 \n"
"    .long   loc_FF97D1C4 \n"
"    .long   loc_FF97D1D0 \n"
"    .long   loc_FF97D1D0 \n"
"    .long   loc_FF97D1F4 \n"
"    .long   loc_FF97D1F4 \n"
"    .long   loc_FF97D314 \n"
"    .long   loc_FF97D320 \n"
"    .long   loc_FF97D330 \n"
"    .long   loc_FF97D340 \n"
"    .long   loc_FF97D340 \n"
"    .long   loc_FF97D340 \n"
"    .long   loc_FF97D1DC \n"
"    .long   loc_FF97D1E8 \n"
"    .long   loc_FF97D204 \n"
"    .long   loc_FF97D210 \n"
"    .long   loc_FF97D248 \n"
"    .long   loc_FF97D280 \n"
"    .long   loc_FF97D2B8 \n"
"    .long   loc_FF97D2F0 \n"
"    .long   loc_FF97D2F0 \n"
"    .long   loc_FF97D340 \n"
"    .long   loc_FF97D340 \n"
"    .long   loc_FF97D2FC \n"
"    .long   loc_FF97D308 \n"

"loc_FF97D1B8:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FF978FB8 \n"
"    B       loc_FF97D33C \n"

"loc_FF97D1C4:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FF979258 \n"
"    B       loc_FF97D33C \n"

"loc_FF97D1D0:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FF9794CC \n"
"    B       loc_FF97D33C \n"

"loc_FF97D1DC:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FF9797C4 \n"
"    B       loc_FF97D33C \n"

"loc_FF97D1E8:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FF979A2C \n"
"    B       loc_FF97D33C \n"

"loc_FF97D1F4:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FF979C30_my \n"  // --> Patched. Old value = 0xFF979C30.
"    MOV     R8, #0 \n"
"    B       loc_FF97D33C \n"

"loc_FF97D204:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FF979D90 \n"
"    B       loc_FF97D33C \n"

"loc_FF97D210:\n"
"    LDRH    R1, [R2, #4] \n"
"    LDR     R3, =0x3A958 \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R3, #6] \n"
"    STRH    R1, [SP, #0x1A] \n"
"    LDRH    R1, [R3, #2] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R3, [R3, #4] \n"
"    STRH    R3, [SP, #0x18] \n"
"    MOV     R0, R2 \n"
"    LDRH    R2, [R2, #0xC] \n"
"    STRH    R2, [SP, #0x1C] \n"
"    BL      sub_FF97A088 \n"
"    B       loc_FF97D33C \n"

"loc_FF97D248:\n"
"    MOV     R0, R2 \n"
"    LDRH    R2, [R2, #4] \n"
"    LDR     R3, =0x3A958 \n"
"    STRH    R2, [SP, #0x14] \n"
"    LDRH    R2, [R3, #8] \n"
"    STRH    R2, [SP, #0x1C] \n"
"    LDRH    R1, [R3, #2] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R2, [R3, #4] \n"
"    STRH    R2, [SP, #0x18] \n"
"    LDRH    R3, [R3, #6] \n"
"    STRH    R3, [SP, #0x1A] \n"
"    BL      sub_FF97A1AC \n"
"    B       loc_FF97D33C \n"

"loc_FF97D280:\n"
"    LDR     R3, =0x3A958 \n"
"    LDRH    R1, [R3] \n"
"    STRH    R1, [SP, #0x14] \n"
"    MOV     R0, R2 \n"
"    LDRH    R2, [R2, #6] \n"
"    STRH    R2, [SP, #0x16] \n"
"    LDRH    R2, [R3, #8] \n"
"    STRH    R2, [SP, #0x1C] \n"
"    LDRH    R1, [R3, #4] \n"
"    STRH    R1, [SP, #0x18] \n"
"    LDRH    R3, [R3, #6] \n"
"    STRH    R3, [SP, #0x1A] \n"
"    BL      sub_FF97A270 \n"
"    B       loc_FF97D33C \n"

"loc_FF97D2B8:\n"
"    LDR     R3, =0x3A958 \n"
"    LDRH    R1, [R3, #6] \n"
"    STRH    R1, [SP, #0x1A] \n"
"    LDRH    R1, [R3] \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R3, #2] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R3, [R3, #4] \n"
"    STRH    R3, [SP, #0x18] \n"
"    MOV     R0, R2 \n"
"    LDRH    R2, [R2, #0xC] \n"
"    STRH    R2, [SP, #0x1C] \n"
"    BL      sub_FF97A328 \n"
"    B       loc_FF97D33C \n"

"loc_FF97D2F0:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FF97A3D4 \n"
"    B       loc_FF97D33C \n"

"loc_FF97D2FC:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FF97AB04 \n"
"    B       loc_FF97D33C \n"

"loc_FF97D308:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FF97AD00 \n"
"    B       loc_FF97D33C \n"

"loc_FF97D314:\n"
"    MOV     R0, R2 \n"
"    BL      sub_FF97AEBC \n"
"    B       loc_FF97D33C \n"

"loc_FF97D320:\n"
"    MOV     R0, R2 \n"
"    MOV     R1, #0 \n"
"    BL      sub_FF97B0A4 \n"
"    B       loc_FF97D33C \n"

"loc_FF97D330:\n"
"    MOV     R0, R2 \n"
"    MOV     R1, #1 \n"
"    BL      sub_FF97B0A4 \n"

"loc_FF97D33C:\n"
"    LDR     R12, [SP, #4] \n"

"loc_FF97D340:\n"
"    ADD     R0, R12, #4 \n"
"    LDR     R1, [R12, #0x7C] \n"
"    LDR     R2, [R12, #0x8C] \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R12, #0x88] \n"

"loc_FF97D354:\n"
"    CMP     R8, #1 \n"
"    BNE     loc_FF97D37C \n"
"    LDR     R1, [SP, #4] \n"
"    LDR     R3, [R1, #0x7C] \n"
"    ADD     R3, R3, R3, LSL#1 \n"
"    ADD     R1, R1, R3, LSL#2 \n"
"    MOV     R0, R6 \n"
"    SUB     R1, R1, #8 \n"
"    BL      sub_FF978C74 \n"
"    B       loc_FF97D3F8 \n"

"loc_FF97D37C:\n"
"    LDR     R3, [SP, #4] \n"
"    LDR     R2, [R3] \n"
"    CMP     R2, #9 \n"
"    BNE     loc_FF97D3C4 \n"
"    MOV     R4, #0 \n"
"    MOV     R1, #1 \n"
"    MOV     R2, R1 \n"
"    MOV     R3, R1 \n"
"    MOV     R0, R4 \n"
"    STR     R4, [SP] \n"
"    BL      sub_FF978BB8 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, R4 \n"
"    MOV     R2, R1 \n"
"    MOV     R3, R1 \n"
"    STR     R4, [SP] \n"
"    BL      sub_FF978E0C \n"
"    B       loc_FF97D3F8 \n"

"loc_FF97D3C4:\n"
"    MOV     R4, #1 \n"
"    MOV     R0, R4 \n"
"    MOV     R1, R4 \n"
"    MOV     R2, R4 \n"
"    MOV     R3, R4 \n"
"    STR     R4, [SP] \n"
"    BL      sub_FF978BB8 \n"
"    MOV     R0, R4 \n"
"    MOV     R1, R0 \n"
"    MOV     R2, R0 \n"
"    MOV     R3, R0 \n"
"    STR     R4, [SP] \n"
"    BL      sub_FF978E0C \n"

"loc_FF97D3F8:\n"
"    LDR     R0, [SP, #4] \n"
"    BL      sub_FF97861C \n"

"loc_FF97D400:\n"
"    LDR     R3, =0x3A94C \n"
"    MOV     R2, #0 \n"
"    LDR     R0, [R3] \n"
"    MOV     R1, R7 \n"
"    BL      sub_FFB40944 /*_ReceiveMessageQueue*/ \n"
"    LDR     R12, [SP, #4] \n"
"    LDR     R2, [R12] \n"
"    CMP     R2, #0x23 \n"
"    BNE     loc_FF97CF0C \n"
"    MOV     R0, R12 \n"
"    BL      sub_FF97861C \n"
"    LDR     R3, =0x3A948 \n"
"    MOV     R1, #1 \n"
"    LDR     R0, [R3] \n"
"    BL      sub_FFB4022C /*_SetEventFlag*/ \n"
"    BL      _ExitTask \n"
"    ADD     SP, SP, #0x20 \n"
"    LDMFD   SP!, {R4-R8,PC} \n"
);
}

/*************************************************************/
//** sub_FF979C30_my @ 0xFF979C30 - 0xFF979D78, length=83
void __attribute__((naked,noinline)) sub_FF979C30_my() {
asm volatile (
"    STMFD   SP!, {R4-R6,LR} \n"
"    LDR     R3, =0x3A948 \n"
"    MOV     R4, R0 \n"
"    MOV     R1, #0x3E \n"
"    LDR     R0, [R3] \n"
"    BL      sub_FFB403C8 /*_ClearEventFlag*/ \n"
"    MOV     R1, #0 \n"
"    LDRSH   R0, [R4, #4] \n"
"    BL      sub_FF97874C \n"
"    MOV     R6, R0 \n"
"    LDRSH   R0, [R4, #6] \n"
"    BL      sub_FF9788F8 \n"
"    LDRSH   R0, [R4, #8] \n"
"    BL      sub_FF978994 \n"
"    LDRSH   R0, [R4, #0xA] \n"
"    BL      sub_FF978A30 \n"
"    LDRSH   R0, [R4, #0xC] \n"
"    BL      sub_FF978ACC \n"
"    LDR     R3, [R4] \n"
"    CMP     R3, #9 \n"
"    MOV     R5, R0 \n"
"    MOVEQ   R5, #0 \n"
"    MOVEQ   R6, R5 \n"
"    CMP     R6, #1 \n"
"    BNE     loc_FF979CB4 \n"
"    MOV     R2, #2 \n"
"    LDRSH   R0, [R4, #4] \n"
"    LDR     R1, =0xFF97866C \n"
"    BL      sub_FFAF0CC4 \n"
"    LDR     R2, =0x3A998 \n"
"    MOV     R3, #0 \n"
"    STR     R3, [R2] \n"
"    B       loc_FF979CB8 \n"

"loc_FF979CB4:\n"
"    BL      sub_FF978B68 \n"

"loc_FF979CB8:\n"
"    STRH    R0, [R4, #4] \n"
"    CMP     R5, #1 \n"
"    BNE     loc_FF979CD8 \n"
"    LDRSH   R0, [R4, #0xC] \n"
"    LDR     R1, =0xFF978730 \n"
"    MOV     R2, #0x20 \n"
"    BL      sub_FF978F58 \n"
"    B       loc_FF979CDC \n"

"loc_FF979CD8:\n"
"    BL      sub_FF978BA8 \n"

"loc_FF979CDC:\n"
"    STRH    R0, [R4, #0xC] \n"
"    LDRSH   R0, [R4, #6] \n"
"    BL      sub_FF93B77C_my \n"  // --> Patched. Old value = 0xFF93B77C.
"    LDRSH   R0, [R4, #8] \n"
"    MOV     R1, #1 \n"
"    BL      sub_FF93DA30 \n"
"    ADD     R0, R4, #8 \n"
"    MOV     R1, #0 \n"
"    BL      sub_FF93DAF0 \n"
"    LDRSH   R0, [R4, #0xE] \n"
"    BL      sub_FF966CE8 \n"
"    CMP     R6, #1 \n"
"    BNE     loc_FF979D40 \n"
"    LDR     R3, =0x3A948 \n"
"    MOV     R2, #0xBB0 \n"
"    LDR     R0, [R3] \n"
"    MOV     R1, #2 \n"
"    ADD     R2, R2, #8 \n"
"    BL      sub_FFB4021C /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF979D40 \n"
"    MOV     R1, #0x4A0 \n"
"    LDR     R0, =0xFF9785C8 /*'ExpDrv.c'*/ \n"
"    ADD     R1, R1, #2 \n"
"    BL      _DebugAssert \n"

"loc_FF979D40:\n"
"    CMP     R5, #1 \n"
"    LDMNEFD SP!, {R4-R6,PC} \n"
"    LDR     R3, =0x3A948 \n"
"    MOV     R2, #0xBB0 \n"
"    LDR     R0, [R3] \n"
"    MOV     R1, #0x20 \n"
"    ADD     R2, R2, #8 \n"
"    BL      sub_FFB4021C /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    LDMEQFD SP!, {R4-R6,PC} \n"
"    MOV     R1, #0x4A0 \n"
"    LDR     R0, =0xFF9785C8 /*'ExpDrv.c'*/ \n"
"    ADD     R1, R1, #7 \n"
"    LDMFD   SP!, {R4-R6,LR} \n"
"    B       _DebugAssert \n"
);
}

/*************************************************************/
//** sub_FF93B77C_my @ 0xFF93B77C - 0xFF93B7D8, length=24
void __attribute__((naked,noinline)) sub_FF93B77C_my() {
asm volatile (
"    STMFD   SP!, {R4,LR} \n"
"    LDR     R3, =0x6144 \n"
"    LDR     R2, [R3] \n"
"    MOV     R1, #0x168 \n"
"    MOV     R3, R0, LSL#16 \n"
"    CMP     R2, #1 \n"
"    ADD     R1, R1, #3 \n"
"    LDR     R0, =0xFF93AF98 /*'Shutter.c'*/ \n"
"    MOV     R4, R3, ASR#16 \n"
"    BEQ     loc_FF93B7A8 \n"
"    BL      _DebugAssert \n"

"loc_FF93B7A8:\n"
"    MOV     R1, #0x170 \n"
"    CMN     R4, #0xC00 \n"
"    LDR     R3, =0x159EE \n"
"    LDR     R0, =0xFF93AF98 /*'Shutter.c'*/ \n"
"    ADD     R1, R1, #1 \n"
"    LDREQSH R4, [R3] \n"
"    LDRNE   R3, =0x159EE \n"
"    CMN     R4, #0xC00 \n"
"    STRH    R4, [R3] \n"
"    BNE     loc_FF93B7D4 \n"
"    BL      _DebugAssert \n"

"loc_FF93B7D4:\n"
"    MOV     R0, R4 \n"
"    BL      apex2us \n"  // --> Patched. Old value = _apex2us.
"    LDR     PC, =0xFF93B7DC \n"  // Continue in firmware
);
}
